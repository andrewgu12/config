"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const cp = require("child_process");
const ls = require("./languageclient");
const rpc = require("vscode-jsonrpc");
const path = require("path");
const logger_1 = require("./logger");
const server_manager_js_1 = require("./server-manager.js");
const convert_js_1 = require("./convert.js");
const atom_1 = require("atom");
const apply_edit_adapter_1 = require("./adapters/apply-edit-adapter");
const autocomplete_adapter_1 = require("./adapters/autocomplete-adapter");
const code_action_adapter_1 = require("./adapters/code-action-adapter");
const code_format_adapter_1 = require("./adapters/code-format-adapter");
const code_highlight_adapter_1 = require("./adapters/code-highlight-adapter");
const datatip_adapter_1 = require("./adapters/datatip-adapter");
const definition_adapter_1 = require("./adapters/definition-adapter");
const document_sync_adapter_1 = require("./adapters/document-sync-adapter");
const find_references_adapter_1 = require("./adapters/find-references-adapter");
const linter_push_v2_adapter_1 = require("./adapters/linter-push-v2-adapter");
const notifications_adapter_1 = require("./adapters/notifications-adapter");
const outline_view_adapter_1 = require("./adapters/outline-view-adapter");
const signature_help_adapter_1 = require("./adapters/signature-help-adapter");
const utils_1 = require("./utils");
// Public: AutoLanguageClient provides a simple way to have all the supported
// Atom-IDE services wired up entirely for you by just subclassing it and
// implementing startServerProcess/getGrammarScopes/getLanguageName and
// getServerName.
class AutoLanguageClient {
    constructor() {
        this._disposable = new atom_1.CompositeDisposable();
        this.processStdErr = '';
    }
    // You must implement these so we know how to deal with your language and server
    // -------------------------------------------------------------------------
    // Return an array of the grammar scopes you handle, e.g. [ 'source.js' ]
    getGrammarScopes() {
        throw Error('Must implement getGrammarScopes when extending AutoLanguageClient');
    }
    // Return the name of the language you support, e.g. 'JavaScript'
    getLanguageName() {
        throw Error('Must implement getLanguageName when extending AutoLanguageClient');
    }
    // Return the name of your server, e.g. 'Eclipse JDT'
    getServerName() {
        throw Error('Must implement getServerName when extending AutoLanguageClient');
    }
    // Start your server process
    startServerProcess(projectPath) {
        throw Error('Must override startServerProcess to start language server process when extending AutoLanguageClient');
    }
    // You might want to override these for different behavior
    // ---------------------------------------------------------------------------
    // Determine whether we should start a server for a given editor if we don't have one yet
    shouldStartForEditor(editor) {
        return this.getGrammarScopes().includes(editor.getGrammar().scopeName);
    }
    // Return the parameters used to initialize a client - you may want to extend capabilities
    getInitializeParams(projectPath, process) {
        return {
            processId: process.pid,
            rootPath: projectPath,
            rootUri: convert_js_1.default.pathToUri(projectPath),
            capabilities: {
                workspace: {
                    applyEdit: true,
                    workspaceEdit: {
                        documentChanges: true,
                    },
                    didChangeConfiguration: {
                        dynamicRegistration: false,
                    },
                    didChangeWatchedFiles: {
                        dynamicRegistration: false,
                    },
                    symbol: {
                        dynamicRegistration: false,
                    },
                    executeCommand: {
                        dynamicRegistration: false,
                    },
                },
                textDocument: {
                    synchronization: {
                        dynamicRegistration: false,
                        willSave: true,
                        willSaveWaitUntil: false,
                        didSave: true,
                    },
                    completion: {
                        dynamicRegistration: false,
                        completionItem: {
                            snippetSupport: true,
                            commitCharactersSupport: false,
                        },
                        contextSupport: true,
                    },
                    hover: {
                        dynamicRegistration: false,
                    },
                    signatureHelp: {
                        dynamicRegistration: false,
                    },
                    references: {
                        dynamicRegistration: false,
                    },
                    documentHighlight: {
                        dynamicRegistration: false,
                    },
                    documentSymbol: {
                        dynamicRegistration: false,
                    },
                    formatting: {
                        dynamicRegistration: false,
                    },
                    rangeFormatting: {
                        dynamicRegistration: false,
                    },
                    onTypeFormatting: {
                        dynamicRegistration: false,
                    },
                    definition: {
                        dynamicRegistration: false,
                    },
                    codeAction: {
                        dynamicRegistration: false,
                    },
                    codeLens: {
                        dynamicRegistration: false,
                    },
                    documentLink: {
                        dynamicRegistration: false,
                    },
                    rename: {
                        dynamicRegistration: false,
                    },
                },
                experimental: {},
            },
        };
    }
    // Early wire-up of listeners before initialize method is sent
    preInitialization(connection) { }
    // Late wire-up of listeners after initialize method has been sent
    postInitialization(server) { }
    // Determine whether to use ipc, stdio or socket to connect to the server
    getConnectionType() {
        return this.socket != null ? 'socket' : 'stdio';
    }
    // Return the name of your root configuration key
    getRootConfigurationKey() {
        return '';
    }
    // Optionally transform the configuration object before it is sent to the server
    mapConfigurationObject(configuration) {
        return configuration;
    }
    // Helper methods that are useful for implementors
    // ---------------------------------------------------------------------------
    // Gets a LanguageClientConnection for a given TextEditor
    getConnectionForEditor(editor) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            return server ? server.connection : null;
        });
    }
    // Restart all active language servers for this language client in the workspace
    restartAllServers() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this._serverManager.restartAllServers();
        });
    }
    // Default implementation of the rest of the AutoLanguageClient
    // ---------------------------------------------------------------------------
    // Activate does very little for perf reasons - hooks in via ServerManager for later 'activation'
    activate() {
        this.name = `${this.getLanguageName()} (${this.getServerName()})`;
        this.logger = this.getLogger();
        this._serverManager = new server_manager_js_1.ServerManager((p) => this.startServer(p), this.logger, (e) => this.shouldStartForEditor(e), (filepath) => this.filterChangeWatchedFiles(filepath), () => this.busySignalService, this.getServerName());
        this._serverManager.startListening();
        process.on('exit', () => this.exitCleanup.bind(this));
    }
    exitCleanup() {
        this._serverManager.terminate();
    }
    // Deactivate disposes the resources we're using
    deactivate() {
        return __awaiter(this, void 0, void 0, function* () {
            this._isDeactivating = true;
            this._disposable.dispose();
            this._serverManager.stopListening();
            yield this._serverManager.stopAllServers();
        });
    }
    spawnChildNode(args, options = {}) {
        this.logger.debug(`starting child Node "${args.join(' ')}"`);
        options.env = options.env || Object.create(process.env);
        options.env.ELECTRON_RUN_AS_NODE = '1';
        options.env.ELECTRON_NO_ATTACH_CONSOLE = '1';
        return cp.spawn(process.execPath, args, options);
    }
    // By default LSP logging is switched off but you can switch it on via the core.debugLSP setting
    getLogger() {
        return atom.config.get('core.debugLSP') ? new logger_1.ConsoleLogger(this.name) : new logger_1.NullLogger();
    }
    // Starts the server by starting the process, then initializing the language server and starting adapters
    startServer(projectPath) {
        return __awaiter(this, void 0, void 0, function* () {
            const startingSignal = this.busySignalService && this.busySignalService.reportBusy(`Starting ${this.getServerName()} for ${path.basename(projectPath)}`);
            let process;
            try {
                process = yield this.startServerProcess(projectPath);
            }
            finally {
                startingSignal && startingSignal.dispose();
            }
            this.captureServerErrors(process, projectPath);
            const connection = new ls.LanguageClientConnection(this.createRpcConnection(process), this.logger);
            this.preInitialization(connection);
            const initializeParams = this.getInitializeParams(projectPath, process);
            const initialization = connection.initialize(initializeParams);
            this.busySignalService && this.busySignalService.reportBusyWhile(`${this.getServerName()} initializing for ${path.basename(projectPath)}`, () => initialization);
            const initializeResponse = yield initialization;
            const newServer = {
                projectPath,
                process,
                connection,
                capabilities: initializeResponse.capabilities,
                disposable: new atom_1.CompositeDisposable(),
            };
            this.postInitialization(newServer);
            connection.initialized();
            connection.on('close', () => {
                if (!this._isDeactivating) {
                    this._serverManager.stopServer(newServer);
                    if (!this._serverManager.hasServerReachedRestartLimit(newServer)) {
                        this.logger.debug(`Restarting language server for project '${newServer.projectPath}'`);
                        this._serverManager.startServer(projectPath);
                    }
                    else {
                        this.logger.warn(`Language server has exceeded auto-restart limit for project '${newServer.projectPath}'`);
                        atom.notifications.addError(
                        // tslint:disable-next-line:max-line-length
                        `The ${this.name} language server has exited and exceeded the restart limit for project '${newServer.projectPath}'`);
                    }
                }
            });
            const configurationKey = this.getRootConfigurationKey();
            if (configurationKey) {
                this._disposable.add(atom.config.observe(configurationKey, (config) => {
                    const mappedConfig = this.mapConfigurationObject(config || {});
                    if (mappedConfig) {
                        connection.didChangeConfiguration({
                            settings: mappedConfig,
                        });
                    }
                }));
            }
            this.startExclusiveAdapters(newServer);
            return newServer;
        });
    }
    captureServerErrors(childProcess, projectPath) {
        childProcess.on('error', (err) => this.handleSpawnFailure(err));
        childProcess.on('exit', (code, signal) => this.logger.debug(`exit: code ${code} signal ${signal}`));
        childProcess.stderr.setEncoding('utf8');
        childProcess.stderr.on('data', (chunk) => {
            const errorString = chunk.toString();
            this.handleServerStderr(errorString, projectPath);
            // Keep the last 5 lines for packages to use in messages
            this.processStdErr = (this.processStdErr + errorString)
                .split('\n')
                .slice(-5)
                .join('\n');
        });
    }
    handleSpawnFailure(err) {
        atom.notifications.addError(`${this.getServerName()} language server for ${this.getLanguageName()} unable to start`, {
            dismissable: true,
            description: err.toString(),
        });
    }
    // Creates the RPC connection which can be ipc, socket or stdio
    createRpcConnection(process) {
        let reader;
        let writer;
        const connectionType = this.getConnectionType();
        switch (connectionType) {
            case 'ipc':
                reader = new rpc.IPCMessageReader(process);
                writer = new rpc.IPCMessageWriter(process);
                break;
            case 'socket':
                reader = new rpc.SocketMessageReader(this.socket);
                writer = new rpc.SocketMessageWriter(this.socket);
                break;
            case 'stdio':
                reader = new rpc.StreamMessageReader(process.stdout);
                writer = new rpc.StreamMessageWriter(process.stdin);
                break;
            default:
                return utils_1.default.assertUnreachable(connectionType);
        }
        return rpc.createMessageConnection(reader, writer, {
            log: (...args) => { },
            warn: (...args) => { },
            info: (...args) => { },
            error: (...args) => {
                this.logger.error(args);
            },
        });
    }
    // Start adapters that are not shared between servers
    startExclusiveAdapters(server) {
        apply_edit_adapter_1.default.attach(server.connection);
        notifications_adapter_1.default.attach(server.connection, this.name, server.projectPath);
        if (document_sync_adapter_1.default.canAdapt(server.capabilities)) {
            server.docSyncAdapter =
                new document_sync_adapter_1.default(server.connection, server.capabilities.textDocumentSync, (editor) => this.shouldSyncForEditor(editor, server.projectPath));
            server.disposable.add(server.docSyncAdapter);
        }
        server.linterPushV2 = new linter_push_v2_adapter_1.default(server.connection);
        if (this._linterDelegate != null) {
            server.linterPushV2.attach(this._linterDelegate);
        }
        server.disposable.add(server.linterPushV2);
        if (signature_help_adapter_1.default.canAdapt(server.capabilities)) {
            server.signatureHelpAdapter = new signature_help_adapter_1.default(server, this.getGrammarScopes());
            if (this._signatureHelpRegistry != null) {
                server.signatureHelpAdapter.attach(this._signatureHelpRegistry);
            }
            server.disposable.add(server.signatureHelpAdapter);
        }
    }
    shouldSyncForEditor(editor, projectPath) {
        return this.isFileInProject(editor, projectPath) && this.shouldStartForEditor(editor);
    }
    isFileInProject(editor, projectPath) {
        return (editor.getURI() || '').startsWith(projectPath);
    }
    // Autocomplete+ via LS completion---------------------------------------
    provideAutocomplete() {
        return {
            selector: this.getGrammarScopes()
                .map((g) => '.' + g)
                .join(', '),
            inclusionPriority: 1,
            suggestionPriority: 2,
            excludeLowerPriority: false,
            getSuggestions: this.getSuggestions.bind(this),
            onDidInsertSuggestion: this.onDidInsertSuggestion.bind(this),
            getSuggestionDetailsOnSelect: this.getSuggestionDetailsOnSelect.bind(this),
        };
    }
    getSuggestions(request) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(request.editor);
            if (server == null || !autocomplete_adapter_1.default.canAdapt(server.capabilities)) {
                return [];
            }
            this.autoComplete = this.autoComplete || new autocomplete_adapter_1.default();
            this._lastAutocompleteRequest = request;
            return this.autoComplete.getSuggestions(server, request, this.onDidConvertAutocomplete, atom.config.get('autocomplete-plus.minimumWordLength'));
        });
    }
    getSuggestionDetailsOnSelect(suggestion) {
        return __awaiter(this, void 0, void 0, function* () {
            const request = this._lastAutocompleteRequest;
            if (request == null) {
                return null;
            }
            const server = yield this._serverManager.getServer(request.editor);
            if (server == null || !autocomplete_adapter_1.default.canResolve(server.capabilities) || this.autoComplete == null) {
                return null;
            }
            return this.autoComplete.completeSuggestion(server, suggestion, request, this.onDidConvertAutocomplete);
        });
    }
    onDidConvertAutocomplete(completionItem, suggestion, request) {
    }
    onDidInsertSuggestion(arg) { }
    // Definitions via LS documentHighlight and gotoDefinition------------
    provideDefinitions() {
        return {
            name: this.name,
            priority: 20,
            grammarScopes: this.getGrammarScopes(),
            getDefinition: this.getDefinition.bind(this),
        };
    }
    getDefinition(editor, point) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !definition_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            this.definitions = this.definitions || new definition_adapter_1.default();
            return this.definitions.getDefinition(server.connection, server.capabilities, this.getLanguageName(), editor, point);
        });
    }
    // Outline View via LS documentSymbol---------------------------------
    provideOutlines() {
        return {
            name: this.name,
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            getOutline: this.getOutline.bind(this),
        };
    }
    getOutline(editor) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !outline_view_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            this.outlineView = this.outlineView || new outline_view_adapter_1.default();
            return this.outlineView.getOutline(server.connection, editor);
        });
    }
    // Linter push v2 API via LS publishDiagnostics
    consumeLinterV2(registerIndie) {
        this._linterDelegate = registerIndie({ name: this.name });
        if (this._linterDelegate == null) {
            return;
        }
        for (const server of this._serverManager.getActiveServers()) {
            if (server.linterPushV2 != null) {
                server.linterPushV2.attach(this._linterDelegate);
            }
        }
    }
    // Find References via LS findReferences------------------------------
    provideFindReferences() {
        return {
            isEditorSupported: (editor) => this.getGrammarScopes().includes(editor.getGrammar().scopeName),
            findReferences: this.getReferences.bind(this),
        };
    }
    getReferences(editor, point) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !find_references_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            this.findReferences = this.findReferences || new find_references_adapter_1.default();
            return this.findReferences.getReferences(server.connection, editor, point, server.projectPath);
        });
    }
    // Datatip via LS textDocument/hover----------------------------------
    consumeDatatip(service) {
        this._disposable.add(service.addProvider({
            providerName: this.name,
            priority: 1,
            grammarScopes: this.getGrammarScopes(),
            validForScope: (scopeName) => {
                return this.getGrammarScopes().includes(scopeName);
            },
            datatip: this.getDatatip.bind(this),
        }));
    }
    getDatatip(editor, point) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !datatip_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            this.datatip = this.datatip || new datatip_adapter_1.default();
            return this.datatip.getDatatip(server.connection, editor, point);
        });
    }
    // Code Format via LS formatDocument & formatDocumentRange------------
    provideCodeFormat() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            formatCode: this.getCodeFormat.bind(this),
        };
    }
    getCodeFormat(editor, range) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !code_format_adapter_1.default.canAdapt(server.capabilities)) {
                return [];
            }
            return code_format_adapter_1.default.format(server.connection, server.capabilities, editor, range);
        });
    }
    provideCodeHighlight() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            highlight: (editor, position) => {
                return this.getCodeHighlight(editor, position);
            },
        };
    }
    getCodeHighlight(editor, position) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !code_highlight_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            return code_highlight_adapter_1.default.highlight(server.connection, server.capabilities, editor, position);
        });
    }
    provideCodeActions() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            getCodeActions: (editor, range, diagnostics) => {
                return this.getCodeActions(editor, range, diagnostics);
            },
        };
    }
    getCodeActions(editor, range, diagnostics) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !code_action_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            return code_action_adapter_1.default.getCodeActions(server.connection, server.capabilities, server.linterPushV2, editor, range, diagnostics);
        });
    }
    consumeSignatureHelp(registry) {
        this._signatureHelpRegistry = registry;
        for (const server of this._serverManager.getActiveServers()) {
            if (server.signatureHelpAdapter != null) {
                server.signatureHelpAdapter.attach(registry);
            }
        }
        return new atom_1.Disposable(() => {
            this._signatureHelpRegistry = null;
        });
    }
    consumeBusySignal(service) {
        this.busySignalService = service;
        return new atom_1.Disposable(() => delete this.busySignalService);
    }
    /**
     * `didChangeWatchedFiles` message filtering, override for custom logic.
     * @param filePath path of a file that has changed in the project path
     * @return false => message will not be sent to the language server
     */
    filterChangeWatchedFiles(filePath) {
        return true;
    }
    /**
     * Called on language server stderr output.
     * @param stderr a chunk of stderr from a language server instance
     */
    handleServerStderr(stderr, projectPath) {
        stderr.split('\n').filter((l) => l).forEach((line) => this.logger.warn(`stderr ${line}`));
    }
}
exports.default = AutoLanguageClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1sYW5ndWFnZWNsaWVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9hdXRvLWxhbmd1YWdlY2xpZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxvQ0FBb0M7QUFDcEMsdUNBQXVDO0FBQ3ZDLHNDQUFzQztBQUN0Qyw2QkFBNkI7QUFJN0IscUNBQTZEO0FBQzdELDJEQUF5RjtBQUN6Riw2Q0FBbUM7QUFJbkMsK0JBVWM7QUFFZCxzRUFBNkQ7QUFDN0QsMEVBQWtFO0FBQ2xFLHdFQUErRDtBQUMvRCx3RUFBK0Q7QUFDL0QsOEVBQXFFO0FBQ3JFLGdFQUF3RDtBQUN4RCxzRUFBOEQ7QUFDOUQsNEVBQW1FO0FBQ25FLGdGQUF1RTtBQUN2RSw4RUFBb0U7QUFDcEUsNEVBQW9FO0FBQ3BFLDBFQUFpRTtBQUNqRSw4RUFBcUU7QUFDckUsbUNBQTRCO0FBSTVCLDZFQUE2RTtBQUM3RSx5RUFBeUU7QUFDekUsdUVBQXVFO0FBQ3ZFLGlCQUFpQjtBQUNqQjtJQUFBO1FBQ1UsZ0JBQVcsR0FBRyxJQUFJLDBCQUFtQixFQUFFLENBQUM7UUFVdEMsa0JBQWEsR0FBVyxFQUFFLENBQUM7SUFvbUJ2QyxDQUFDO0lBeGxCQyxnRkFBZ0Y7SUFDaEYsNEVBQTRFO0lBRTVFLHlFQUF5RTtJQUMvRCxnQkFBZ0I7UUFDeEIsTUFBTSxLQUFLLENBQUMsbUVBQW1FLENBQUMsQ0FBQztJQUNuRixDQUFDO0lBRUQsaUVBQWlFO0lBQ3ZELGVBQWU7UUFDdkIsTUFBTSxLQUFLLENBQUMsa0VBQWtFLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBRUQscURBQXFEO0lBQzNDLGFBQWE7UUFDckIsTUFBTSxLQUFLLENBQUMsZ0VBQWdFLENBQUMsQ0FBQztJQUNoRixDQUFDO0lBRUQsNEJBQTRCO0lBQ2xCLGtCQUFrQixDQUFDLFdBQW1CO1FBQzlDLE1BQU0sS0FBSyxDQUFDLHFHQUFxRyxDQUFDLENBQUM7SUFDckgsQ0FBQztJQUVELDBEQUEwRDtJQUMxRCw4RUFBOEU7SUFFOUUseUZBQXlGO0lBQy9FLG9CQUFvQixDQUFDLE1BQWtCO1FBQy9DLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRCwwRkFBMEY7SUFDaEYsbUJBQW1CLENBQUMsV0FBbUIsRUFBRSxPQUE4QjtRQUMvRSxNQUFNLENBQUM7WUFDTCxTQUFTLEVBQUUsT0FBTyxDQUFDLEdBQUc7WUFDdEIsUUFBUSxFQUFFLFdBQVc7WUFDckIsT0FBTyxFQUFFLG9CQUFPLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQztZQUN2QyxZQUFZLEVBQUU7Z0JBQ1osU0FBUyxFQUFFO29CQUNULFNBQVMsRUFBRSxJQUFJO29CQUNmLGFBQWEsRUFBRTt3QkFDYixlQUFlLEVBQUUsSUFBSTtxQkFDdEI7b0JBQ0Qsc0JBQXNCLEVBQUU7d0JBQ3RCLG1CQUFtQixFQUFFLEtBQUs7cUJBQzNCO29CQUNELHFCQUFxQixFQUFFO3dCQUNyQixtQkFBbUIsRUFBRSxLQUFLO3FCQUMzQjtvQkFDRCxNQUFNLEVBQUU7d0JBQ04sbUJBQW1CLEVBQUUsS0FBSztxQkFDM0I7b0JBQ0QsY0FBYyxFQUFFO3dCQUNkLG1CQUFtQixFQUFFLEtBQUs7cUJBQzNCO2lCQUNGO2dCQUNELFlBQVksRUFBRTtvQkFDWixlQUFlLEVBQUU7d0JBQ2YsbUJBQW1CLEVBQUUsS0FBSzt3QkFDMUIsUUFBUSxFQUFFLElBQUk7d0JBQ2QsaUJBQWlCLEVBQUUsS0FBSzt3QkFDeEIsT0FBTyxFQUFFLElBQUk7cUJBQ2Q7b0JBQ0QsVUFBVSxFQUFFO3dCQUNWLG1CQUFtQixFQUFFLEtBQUs7d0JBQzFCLGNBQWMsRUFBRTs0QkFDZCxjQUFjLEVBQUUsSUFBSTs0QkFDcEIsdUJBQXVCLEVBQUUsS0FBSzt5QkFDL0I7d0JBQ0QsY0FBYyxFQUFFLElBQUk7cUJBQ3JCO29CQUNELEtBQUssRUFBRTt3QkFDTCxtQkFBbUIsRUFBRSxLQUFLO3FCQUMzQjtvQkFDRCxhQUFhLEVBQUU7d0JBQ2IsbUJBQW1CLEVBQUUsS0FBSztxQkFDM0I7b0JBQ0QsVUFBVSxFQUFFO3dCQUNWLG1CQUFtQixFQUFFLEtBQUs7cUJBQzNCO29CQUNELGlCQUFpQixFQUFFO3dCQUNqQixtQkFBbUIsRUFBRSxLQUFLO3FCQUMzQjtvQkFDRCxjQUFjLEVBQUU7d0JBQ2QsbUJBQW1CLEVBQUUsS0FBSztxQkFDM0I7b0JBQ0QsVUFBVSxFQUFFO3dCQUNWLG1CQUFtQixFQUFFLEtBQUs7cUJBQzNCO29CQUNELGVBQWUsRUFBRTt3QkFDZixtQkFBbUIsRUFBRSxLQUFLO3FCQUMzQjtvQkFDRCxnQkFBZ0IsRUFBRTt3QkFDaEIsbUJBQW1CLEVBQUUsS0FBSztxQkFDM0I7b0JBQ0QsVUFBVSxFQUFFO3dCQUNWLG1CQUFtQixFQUFFLEtBQUs7cUJBQzNCO29CQUNELFVBQVUsRUFBRTt3QkFDVixtQkFBbUIsRUFBRSxLQUFLO3FCQUMzQjtvQkFDRCxRQUFRLEVBQUU7d0JBQ1IsbUJBQW1CLEVBQUUsS0FBSztxQkFDM0I7b0JBQ0QsWUFBWSxFQUFFO3dCQUNaLG1CQUFtQixFQUFFLEtBQUs7cUJBQzNCO29CQUNELE1BQU0sRUFBRTt3QkFDTixtQkFBbUIsRUFBRSxLQUFLO3FCQUMzQjtpQkFDRjtnQkFDRCxZQUFZLEVBQUUsRUFBRTthQUNqQjtTQUNGLENBQUM7SUFDSixDQUFDO0lBRUQsOERBQThEO0lBQ3BELGlCQUFpQixDQUFDLFVBQXVDLElBQVMsQ0FBQztJQUU3RSxrRUFBa0U7SUFDeEQsa0JBQWtCLENBQUMsTUFBb0IsSUFBUyxDQUFDO0lBRTNELHlFQUF5RTtJQUMvRCxpQkFBaUI7UUFDekIsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUNsRCxDQUFDO0lBRUQsaURBQWlEO0lBQ3ZDLHVCQUF1QjtRQUMvQixNQUFNLENBQUMsRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVELGdGQUFnRjtJQUN0RSxzQkFBc0IsQ0FBQyxhQUFrQjtRQUNqRCxNQUFNLENBQUMsYUFBYSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxrREFBa0Q7SUFDbEQsOEVBQThFO0lBRTlFLHlEQUF5RDtJQUN6QyxzQkFBc0IsQ0FBQyxNQUFrQjs7WUFDdkQsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDM0MsQ0FBQztLQUFBO0lBRUQsZ0ZBQWdGO0lBQ2hFLGlCQUFpQjs7WUFDL0IsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDaEQsQ0FBQztLQUFBO0lBRUQsK0RBQStEO0lBQy9ELDhFQUE4RTtJQUU5RSxpR0FBaUc7SUFDMUYsUUFBUTtRQUNiLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsZUFBZSxFQUFFLEtBQUssSUFBSSxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUM7UUFDbEUsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDL0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLGlDQUFhLENBQ3JDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUMxQixJQUFJLENBQUMsTUFBTSxFQUNYLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLEVBQ25DLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsUUFBUSxDQUFDLEVBQ3JELEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFDNUIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUNyQixDQUFDO1FBQ0YsSUFBSSxDQUFDLGNBQWMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUNyQyxPQUFPLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFTyxXQUFXO1FBQ2pCLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbEMsQ0FBQztJQUVELGdEQUFnRDtJQUNuQyxVQUFVOztZQUNyQixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztZQUM1QixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDcEMsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQzdDLENBQUM7S0FBQTtJQUVTLGNBQWMsQ0FBQyxJQUFjLEVBQUUsVUFBMkIsRUFBRTtRQUNwRSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0QsT0FBTyxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3hELE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEdBQUcsR0FBRyxDQUFDO1FBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLEdBQUcsR0FBRyxDQUFDO1FBQzdDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFFRCxnR0FBZ0c7SUFDdEYsU0FBUztRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksc0JBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksbUJBQVUsRUFBRSxDQUFDO0lBQzVGLENBQUM7SUFFRCx5R0FBeUc7SUFDM0YsV0FBVyxDQUFDLFdBQW1COztZQUMzQyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FDaEYsWUFBWSxJQUFJLENBQUMsYUFBYSxFQUFFLFFBQVEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUNyRSxDQUFDO1lBQ0YsSUFBSSxPQUFPLENBQUM7WUFDWixJQUFJLENBQUM7Z0JBQ0gsT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3ZELENBQUM7b0JBQVMsQ0FBQztnQkFDVCxjQUFjLElBQUksY0FBYyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQzdDLENBQUM7WUFDRCxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQy9DLE1BQU0sVUFBVSxHQUFHLElBQUksRUFBRSxDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbkcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ25DLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUN4RSxNQUFNLGNBQWMsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDL0QsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxlQUFlLENBQzlELEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxxQkFBcUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxFQUN4RSxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQ3JCLENBQUM7WUFDRixNQUFNLGtCQUFrQixHQUFHLE1BQU0sY0FBYyxDQUFDO1lBQ2hELE1BQU0sU0FBUyxHQUFHO2dCQUNoQixXQUFXO2dCQUNYLE9BQU87Z0JBQ1AsVUFBVTtnQkFDVixZQUFZLEVBQUUsa0JBQWtCLENBQUMsWUFBWTtnQkFDN0MsVUFBVSxFQUFFLElBQUksMEJBQW1CLEVBQUU7YUFDdEMsQ0FBQztZQUNGLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNuQyxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDekIsVUFBVSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFO2dCQUMxQixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO29CQUMxQixJQUFJLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDMUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLDRCQUE0QixDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDakUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsMkNBQTJDLFNBQVMsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO3dCQUN2RixJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFDL0MsQ0FBQztvQkFBQyxJQUFJLENBQUMsQ0FBQzt3QkFDTixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxnRUFBZ0UsU0FBUyxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUM7d0JBQzNHLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUTt3QkFDekIsMkNBQTJDO3dCQUMzQyxPQUFPLElBQUksQ0FBQyxJQUFJLDJFQUEyRSxTQUFTLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztvQkFDekgsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO1lBQ3hELEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztnQkFDckIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQ2xCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUU7b0JBQy9DLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLENBQUM7b0JBQy9ELEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7d0JBQ2pCLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQzs0QkFDaEMsUUFBUSxFQUFFLFlBQVk7eUJBQ3ZCLENBQUMsQ0FBQztvQkFDTCxDQUFDO2dCQUNILENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDUixDQUFDO1lBRUQsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sQ0FBQyxTQUFTLENBQUM7UUFDbkIsQ0FBQztLQUFBO0lBRU8sbUJBQW1CLENBQUMsWUFBbUMsRUFBRSxXQUFtQjtRQUNsRixZQUFZLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDaEUsWUFBWSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLElBQUksV0FBVyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDcEcsWUFBWSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsS0FBYSxFQUFFLEVBQUU7WUFDL0MsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3JDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDbEQsd0RBQXdEO1lBQ3hELElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQztpQkFDcEQsS0FBSyxDQUFDLElBQUksQ0FBQztpQkFDWCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ1QsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVPLGtCQUFrQixDQUFDLEdBQVE7UUFDakMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQ3pCLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSx3QkFBd0IsSUFBSSxDQUFDLGVBQWUsRUFBRSxrQkFBa0IsRUFDdkY7WUFDRSxXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsR0FBRyxDQUFDLFFBQVEsRUFBRTtTQUM1QixDQUNGLENBQUM7SUFDSixDQUFDO0lBRUQsK0RBQStEO0lBQ3ZELG1CQUFtQixDQUFDLE9BQThCO1FBQ3hELElBQUksTUFBeUIsQ0FBQztRQUM5QixJQUFJLE1BQXlCLENBQUM7UUFDOUIsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDaEQsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUN2QixLQUFLLEtBQUs7Z0JBQ1IsTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLGdCQUFnQixDQUFDLE9BQTBCLENBQUMsQ0FBQztnQkFDOUQsTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLGdCQUFnQixDQUFDLE9BQTBCLENBQUMsQ0FBQztnQkFDOUQsS0FBSyxDQUFDO1lBQ1IsS0FBSyxRQUFRO2dCQUNYLE1BQU0sR0FBRyxJQUFJLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ2xELE1BQU0sR0FBRyxJQUFJLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ2xELEtBQUssQ0FBQztZQUNSLEtBQUssT0FBTztnQkFDVixNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNyRCxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNwRCxLQUFLLENBQUM7WUFDUjtnQkFDRSxNQUFNLENBQUMsZUFBSyxDQUFDLGlCQUFpQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ25ELENBQUM7UUFFRCxNQUFNLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUU7WUFDakQsR0FBRyxFQUFFLENBQUMsR0FBRyxJQUFXLEVBQUUsRUFBRSxHQUFFLENBQUM7WUFDM0IsSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFXLEVBQUUsRUFBRSxHQUFFLENBQUM7WUFDNUIsSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFXLEVBQUUsRUFBRSxHQUFFLENBQUM7WUFDNUIsS0FBSyxFQUFFLENBQUMsR0FBRyxJQUFXLEVBQUUsRUFBRTtnQkFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUIsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxxREFBcUQ7SUFDN0Msc0JBQXNCLENBQUMsTUFBb0I7UUFDakQsNEJBQWdCLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMzQywrQkFBb0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUU5RSxFQUFFLENBQUMsQ0FBQywrQkFBbUIsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsY0FBYztnQkFDbkIsSUFBSSwrQkFBbUIsQ0FDckIsTUFBTSxDQUFDLFVBQVUsRUFDakIsTUFBTSxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsRUFDcEMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDdEUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQy9DLENBQUM7UUFFRCxNQUFNLENBQUMsWUFBWSxHQUFHLElBQUksZ0NBQW1CLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2pFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDbkQsQ0FBQztRQUNELE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUUzQyxFQUFFLENBQUMsQ0FBQyxnQ0FBb0IsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2RCxNQUFNLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxnQ0FBb0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQztZQUN4RixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDeEMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUNsRSxDQUFDO1lBQ0QsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDckQsQ0FBQztJQUNILENBQUM7SUFFTSxtQkFBbUIsQ0FBQyxNQUFrQixFQUFFLFdBQW1CO1FBQ2hFLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsSUFBSSxJQUFJLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDeEYsQ0FBQztJQUVTLGVBQWUsQ0FBQyxNQUFrQixFQUFFLFdBQW1CO1FBQy9ELE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDekQsQ0FBQztJQUVELHlFQUF5RTtJQUNsRSxtQkFBbUI7UUFDeEIsTUFBTSxDQUFDO1lBQ0wsUUFBUSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtpQkFDOUIsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO2lCQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ2IsaUJBQWlCLEVBQUUsQ0FBQztZQUNwQixrQkFBa0IsRUFBRSxDQUFDO1lBQ3JCLG9CQUFvQixFQUFFLEtBQUs7WUFDM0IsY0FBYyxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUM5QyxxQkFBcUIsRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUM1RCw0QkFBNEIsRUFBRSxJQUFJLENBQUMsNEJBQTRCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztTQUMzRSxDQUFDO0lBQ0osQ0FBQztJQUVlLGNBQWMsQ0FDNUIsT0FBNEI7O1lBRTVCLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ25FLEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJLElBQUksQ0FBQyw4QkFBbUIsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDekUsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUNaLENBQUM7WUFFRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSw4QkFBbUIsRUFBRSxDQUFDO1lBQ25FLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxPQUFPLENBQUM7WUFDeEMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLHdCQUF3QixFQUNwRixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDLENBQUM7UUFDNUQsQ0FBQztLQUFBO0lBRWUsNEJBQTRCLENBQzFDLFVBQWtDOztZQUNsQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUM7WUFDOUMsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztZQUFDLENBQUM7WUFDckMsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbkUsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLDhCQUFtQixDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUN4RyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ2QsQ0FBQztZQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQzFHLENBQUM7S0FBQTtJQUVTLHdCQUF3QixDQUNoQyxjQUFpQyxFQUNqQyxVQUFrQyxFQUNsQyxPQUE0QjtJQUU5QixDQUFDO0lBRVMscUJBQXFCLENBQUMsR0FBMEIsSUFBUyxDQUFDO0lBRXBFLHNFQUFzRTtJQUMvRCxrQkFBa0I7UUFDdkIsTUFBTSxDQUFDO1lBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsUUFBUSxFQUFFLEVBQUU7WUFDWixhQUFhLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3RDLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDN0MsQ0FBQztJQUNKLENBQUM7SUFFZSxhQUFhLENBQUMsTUFBa0IsRUFBRSxLQUFZOztZQUM1RCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNELEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJLElBQUksQ0FBQyw0QkFBaUIsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdkUsTUFBTSxDQUFDLElBQUksQ0FBQztZQUNkLENBQUM7WUFFRCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSw0QkFBaUIsRUFBRSxDQUFDO1lBQy9ELE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FDbkMsTUFBTSxDQUFDLFVBQVUsRUFDakIsTUFBTSxDQUFDLFlBQVksRUFDbkIsSUFBSSxDQUFDLGVBQWUsRUFBRSxFQUN0QixNQUFNLEVBQ04sS0FBSyxDQUNOLENBQUM7UUFDSixDQUFDO0tBQUE7SUFFRCxzRUFBc0U7SUFDL0QsZUFBZTtRQUNwQixNQUFNLENBQUM7WUFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixhQUFhLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3RDLFFBQVEsRUFBRSxDQUFDO1lBQ1gsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztTQUN2QyxDQUFDO0lBQ0osQ0FBQztJQUVlLFVBQVUsQ0FBQyxNQUFrQjs7WUFDM0MsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzRCxFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSSxJQUFJLENBQUMsOEJBQWtCLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hFLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDZCxDQUFDO1lBRUQsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksOEJBQWtCLEVBQUUsQ0FBQztZQUNoRSxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNoRSxDQUFDO0tBQUE7SUFFRCwrQ0FBK0M7SUFDeEMsZUFBZSxDQUFDLGFBQStEO1FBQ3BGLElBQUksQ0FBQyxlQUFlLEdBQUcsYUFBYSxDQUFDLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBQ3hELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUM7UUFDVCxDQUFDO1FBRUQsR0FBRyxDQUFDLENBQUMsTUFBTSxNQUFNLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM1RCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2hDLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNuRCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxzRUFBc0U7SUFDL0QscUJBQXFCO1FBQzFCLE1BQU0sQ0FBQztZQUNMLGlCQUFpQixFQUFFLENBQUMsTUFBa0IsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDMUcsY0FBYyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztTQUM5QyxDQUFDO0lBQ0osQ0FBQztJQUVlLGFBQWEsQ0FBQyxNQUFrQixFQUFFLEtBQVk7O1lBQzVELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0QsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLGlDQUFxQixDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMzRSxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ2QsQ0FBQztZQUVELElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJLGlDQUFxQixFQUFFLENBQUM7WUFDekUsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDakcsQ0FBQztLQUFBO0lBRUQsc0VBQXNFO0lBQy9ELGNBQWMsQ0FBQyxPQUErQjtRQUNuRCxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FDbEIsT0FBTyxDQUFDLFdBQVcsQ0FBQztZQUNsQixZQUFZLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDdkIsUUFBUSxFQUFFLENBQUM7WUFDWCxhQUFhLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3RDLGFBQWEsRUFBRSxDQUFDLFNBQWlCLEVBQUUsRUFBRTtnQkFDbkMsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNyRCxDQUFDO1lBQ0QsT0FBTyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztTQUNwQyxDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7SUFFZSxVQUFVLENBQUMsTUFBa0IsRUFBRSxLQUFZOztZQUN6RCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNELEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJLElBQUksQ0FBQyx5QkFBYyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNwRSxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ2QsQ0FBQztZQUVELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLHlCQUFjLEVBQUUsQ0FBQztZQUNwRCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbkUsQ0FBQztLQUFBO0lBRUQsc0VBQXNFO0lBQy9ELGlCQUFpQjtRQUN0QixNQUFNLENBQUM7WUFDTCxhQUFhLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3RDLFFBQVEsRUFBRSxDQUFDO1lBQ1gsVUFBVSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztTQUMxQyxDQUFDO0lBQ0osQ0FBQztJQUVlLGFBQWEsQ0FBQyxNQUFrQixFQUFFLEtBQVk7O1lBQzVELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0QsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLDZCQUFpQixDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN2RSxNQUFNLENBQUMsRUFBRSxDQUFDO1lBQ1osQ0FBQztZQUVELE1BQU0sQ0FBQyw2QkFBaUIsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsWUFBWSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN6RixDQUFDO0tBQUE7SUFFTSxvQkFBb0I7UUFDekIsTUFBTSxDQUFDO1lBQ0wsYUFBYSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUN0QyxRQUFRLEVBQUUsQ0FBQztZQUNYLFNBQVMsRUFBRSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRTtnQkFDOUIsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDakQsQ0FBQztTQUNGLENBQUM7SUFDSixDQUFDO0lBRWUsZ0JBQWdCLENBQUMsTUFBa0IsRUFBRSxRQUFlOztZQUNsRSxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNELEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJLElBQUksQ0FBQyxnQ0FBb0IsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUUsTUFBTSxDQUFDLElBQUksQ0FBQztZQUNkLENBQUM7WUFFRCxNQUFNLENBQUMsZ0NBQW9CLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLFlBQVksRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDbEcsQ0FBQztLQUFBO0lBRU0sa0JBQWtCO1FBQ3ZCLE1BQU0sQ0FBQztZQUNMLGFBQWEsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDdEMsUUFBUSxFQUFFLENBQUM7WUFDWCxjQUFjLEVBQUUsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxFQUFFO2dCQUM3QyxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ3pELENBQUM7U0FDRixDQUFDO0lBQ0osQ0FBQztJQUVlLGNBQWMsQ0FBQyxNQUFrQixFQUFFLEtBQVksRUFBRSxXQUFpQzs7WUFDaEcsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzRCxFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSSxJQUFJLENBQUMsNkJBQWlCLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZFLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDZCxDQUFDO1lBRUQsTUFBTSxDQUFDLDZCQUFpQixDQUFDLGNBQWMsQ0FDckMsTUFBTSxDQUFDLFVBQVUsRUFDakIsTUFBTSxDQUFDLFlBQVksRUFDbkIsTUFBTSxDQUFDLFlBQVksRUFDbkIsTUFBTSxFQUNOLEtBQUssRUFDTCxXQUFXLENBQ1osQ0FBQztRQUNKLENBQUM7S0FBQTtJQUVNLG9CQUFvQixDQUFDLFFBQXVDO1FBQ2pFLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxRQUFRLENBQUM7UUFDdkMsR0FBRyxDQUFDLENBQUMsTUFBTSxNQUFNLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM1RCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsb0JBQW9CLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDeEMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvQyxDQUFDO1FBQ0gsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLGlCQUFVLENBQUMsR0FBRyxFQUFFO1lBQ3pCLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0saUJBQWlCLENBQUMsT0FBa0M7UUFDekQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQztRQUNqQyxNQUFNLENBQUMsSUFBSSxpQkFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVEOzs7O09BSUc7SUFDTyx3QkFBd0IsQ0FBQyxRQUFnQjtRQUNqRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOzs7T0FHRztJQUNLLGtCQUFrQixDQUFDLE1BQWMsRUFBRSxXQUFtQjtRQUM1RCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM1RixDQUFDO0NBQ0Y7QUEvbUJELHFDQSttQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjcCBmcm9tICdjaGlsZF9wcm9jZXNzJztcclxuaW1wb3J0ICogYXMgbHMgZnJvbSAnLi9sYW5ndWFnZWNsaWVudCc7XHJcbmltcG9ydCAqIGFzIHJwYyBmcm9tICd2c2NvZGUtanNvbnJwYyc7XHJcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCAqIGFzIGF0b21JZGUgZnJvbSAnYXRvbS1pZGUnO1xyXG5pbXBvcnQgKiBhcyBsaW50ZXIgZnJvbSAnYXRvbS9saW50ZXInO1xyXG5pbXBvcnQgeyBTb2NrZXQgfSBmcm9tICduZXQnO1xyXG5pbXBvcnQgeyBDb25zb2xlTG9nZ2VyLCBOdWxsTG9nZ2VyLCBMb2dnZXIgfSBmcm9tICcuL2xvZ2dlcic7XHJcbmltcG9ydCB7IExhbmd1YWdlU2VydmVyUHJvY2VzcywgU2VydmVyTWFuYWdlciwgQWN0aXZlU2VydmVyIH0gZnJvbSAnLi9zZXJ2ZXItbWFuYWdlci5qcyc7XHJcbmltcG9ydCBDb252ZXJ0IGZyb20gJy4vY29udmVydC5qcyc7XHJcblxyXG5leHBvcnQgeyBMYW5ndWFnZVNlcnZlclByb2Nlc3MgfTtcclxuXHJcbmltcG9ydCB7XHJcbiAgQXV0b2NvbXBsZXRlRGlkSW5zZXJ0LFxyXG4gIEF1dG9jb21wbGV0ZVByb3ZpZGVyLFxyXG4gIEF1dG9jb21wbGV0ZVJlcXVlc3QsXHJcbiAgQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbixcclxuICBDb21wb3NpdGVEaXNwb3NhYmxlLFxyXG4gIERpc3Bvc2FibGUsXHJcbiAgUG9pbnQsXHJcbiAgUmFuZ2UsXHJcbiAgVGV4dEVkaXRvcixcclxufSBmcm9tICdhdG9tJztcclxuXHJcbmltcG9ydCBBcHBseUVkaXRBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvYXBwbHktZWRpdC1hZGFwdGVyJztcclxuaW1wb3J0IEF1dG9jb21wbGV0ZUFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9hdXRvY29tcGxldGUtYWRhcHRlcic7XHJcbmltcG9ydCBDb2RlQWN0aW9uQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2NvZGUtYWN0aW9uLWFkYXB0ZXInO1xyXG5pbXBvcnQgQ29kZUZvcm1hdEFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9jb2RlLWZvcm1hdC1hZGFwdGVyJztcclxuaW1wb3J0IENvZGVIaWdobGlnaHRBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvY29kZS1oaWdobGlnaHQtYWRhcHRlcic7XHJcbmltcG9ydCBEYXRhdGlwQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2RhdGF0aXAtYWRhcHRlcic7XHJcbmltcG9ydCBEZWZpbml0aW9uQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2RlZmluaXRpb24tYWRhcHRlcic7XHJcbmltcG9ydCBEb2N1bWVudFN5bmNBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZG9jdW1lbnQtc3luYy1hZGFwdGVyJztcclxuaW1wb3J0IEZpbmRSZWZlcmVuY2VzQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2ZpbmQtcmVmZXJlbmNlcy1hZGFwdGVyJztcclxuaW1wb3J0IExpbnRlclB1c2hWMkFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9saW50ZXItcHVzaC12Mi1hZGFwdGVyJztcclxuaW1wb3J0IE5vdGlmaWNhdGlvbnNBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvbm90aWZpY2F0aW9ucy1hZGFwdGVyJztcclxuaW1wb3J0IE91dGxpbmVWaWV3QWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL291dGxpbmUtdmlldy1hZGFwdGVyJztcclxuaW1wb3J0IFNpZ25hdHVyZUhlbHBBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvc2lnbmF0dXJlLWhlbHAtYWRhcHRlcic7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuL3V0aWxzJztcclxuXHJcbmV4cG9ydCB0eXBlIENvbm5lY3Rpb25UeXBlID0gJ3N0ZGlvJyB8ICdzb2NrZXQnIHwgJ2lwYyc7XHJcblxyXG4vLyBQdWJsaWM6IEF1dG9MYW5ndWFnZUNsaWVudCBwcm92aWRlcyBhIHNpbXBsZSB3YXkgdG8gaGF2ZSBhbGwgdGhlIHN1cHBvcnRlZFxyXG4vLyBBdG9tLUlERSBzZXJ2aWNlcyB3aXJlZCB1cCBlbnRpcmVseSBmb3IgeW91IGJ5IGp1c3Qgc3ViY2xhc3NpbmcgaXQgYW5kXHJcbi8vIGltcGxlbWVudGluZyBzdGFydFNlcnZlclByb2Nlc3MvZ2V0R3JhbW1hclNjb3Blcy9nZXRMYW5ndWFnZU5hbWUgYW5kXHJcbi8vIGdldFNlcnZlck5hbWUuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1dG9MYW5ndWFnZUNsaWVudCB7XHJcbiAgcHJpdmF0ZSBfZGlzcG9zYWJsZSA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XHJcbiAgcHJpdmF0ZSBfc2VydmVyTWFuYWdlcjogU2VydmVyTWFuYWdlcjtcclxuICBwcml2YXRlIF9saW50ZXJEZWxlZ2F0ZTogbGludGVyLkluZGllRGVsZWdhdGU7XHJcbiAgcHJpdmF0ZSBfc2lnbmF0dXJlSGVscFJlZ2lzdHJ5OiBhdG9tSWRlLlNpZ25hdHVyZUhlbHBSZWdpc3RyeSB8IG51bGw7XHJcbiAgcHJpdmF0ZSBfbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3Q6IEF1dG9jb21wbGV0ZVJlcXVlc3Q7XHJcbiAgcHJpdmF0ZSBfaXNEZWFjdGl2YXRpbmc6IGJvb2xlYW47XHJcblxyXG4gIC8vIEF2YWlsYWJsZSBpZiBjb25zdW1lQnVzeVNpZ25hbCBpcyBzZXR1cFxyXG4gIHByb3RlY3RlZCBidXN5U2lnbmFsU2VydmljZTogYXRvbUlkZS5CdXN5U2lnbmFsU2VydmljZTtcclxuXHJcbiAgcHJvdGVjdGVkIHByb2Nlc3NTdGRFcnI6IHN0cmluZyA9ICcnO1xyXG4gIHByb3RlY3RlZCBsb2dnZXI6IExvZ2dlcjtcclxuICBwcm90ZWN0ZWQgbmFtZTogc3RyaW5nO1xyXG4gIHByb3RlY3RlZCBzb2NrZXQ6IFNvY2tldDtcclxuXHJcbiAgLy8gU2hhcmVkIGFkYXB0ZXJzIHRoYXQgY2FuIHRha2UgdGhlIFJQQyBjb25uZWN0aW9uIGFzIHJlcXVpcmVkXHJcbiAgcHJvdGVjdGVkIGF1dG9Db21wbGV0ZTogQXV0b2NvbXBsZXRlQWRhcHRlcjtcclxuICBwcm90ZWN0ZWQgZGF0YXRpcDogRGF0YXRpcEFkYXB0ZXI7XHJcbiAgcHJvdGVjdGVkIGRlZmluaXRpb25zOiBEZWZpbml0aW9uQWRhcHRlcjtcclxuICBwcm90ZWN0ZWQgZmluZFJlZmVyZW5jZXM6IEZpbmRSZWZlcmVuY2VzQWRhcHRlcjtcclxuICBwcm90ZWN0ZWQgb3V0bGluZVZpZXc6IE91dGxpbmVWaWV3QWRhcHRlcjtcclxuXHJcbiAgLy8gWW91IG11c3QgaW1wbGVtZW50IHRoZXNlIHNvIHdlIGtub3cgaG93IHRvIGRlYWwgd2l0aCB5b3VyIGxhbmd1YWdlIGFuZCBzZXJ2ZXJcclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8vIFJldHVybiBhbiBhcnJheSBvZiB0aGUgZ3JhbW1hciBzY29wZXMgeW91IGhhbmRsZSwgZS5nLiBbICdzb3VyY2UuanMnIF1cclxuICBwcm90ZWN0ZWQgZ2V0R3JhbW1hclNjb3BlcygpOiBzdHJpbmdbXSB7XHJcbiAgICB0aHJvdyBFcnJvcignTXVzdCBpbXBsZW1lbnQgZ2V0R3JhbW1hclNjb3BlcyB3aGVuIGV4dGVuZGluZyBBdXRvTGFuZ3VhZ2VDbGllbnQnKTtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybiB0aGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2UgeW91IHN1cHBvcnQsIGUuZy4gJ0phdmFTY3JpcHQnXHJcbiAgcHJvdGVjdGVkIGdldExhbmd1YWdlTmFtZSgpOiBzdHJpbmcge1xyXG4gICAgdGhyb3cgRXJyb3IoJ011c3QgaW1wbGVtZW50IGdldExhbmd1YWdlTmFtZSB3aGVuIGV4dGVuZGluZyBBdXRvTGFuZ3VhZ2VDbGllbnQnKTtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybiB0aGUgbmFtZSBvZiB5b3VyIHNlcnZlciwgZS5nLiAnRWNsaXBzZSBKRFQnXHJcbiAgcHJvdGVjdGVkIGdldFNlcnZlck5hbWUoKTogc3RyaW5nIHtcclxuICAgIHRocm93IEVycm9yKCdNdXN0IGltcGxlbWVudCBnZXRTZXJ2ZXJOYW1lIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnQgeW91ciBzZXJ2ZXIgcHJvY2Vzc1xyXG4gIHByb3RlY3RlZCBzdGFydFNlcnZlclByb2Nlc3MocHJvamVjdFBhdGg6IHN0cmluZyk6IExhbmd1YWdlU2VydmVyUHJvY2VzcyB8IFByb21pc2U8TGFuZ3VhZ2VTZXJ2ZXJQcm9jZXNzPiB7XHJcbiAgICB0aHJvdyBFcnJvcignTXVzdCBvdmVycmlkZSBzdGFydFNlcnZlclByb2Nlc3MgdG8gc3RhcnQgbGFuZ3VhZ2Ugc2VydmVyIHByb2Nlc3Mgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50Jyk7XHJcbiAgfVxyXG5cclxuICAvLyBZb3UgbWlnaHQgd2FudCB0byBvdmVycmlkZSB0aGVzZSBmb3IgZGlmZmVyZW50IGJlaGF2aW9yXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8vIERldGVybWluZSB3aGV0aGVyIHdlIHNob3VsZCBzdGFydCBhIHNlcnZlciBmb3IgYSBnaXZlbiBlZGl0b3IgaWYgd2UgZG9uJ3QgaGF2ZSBvbmUgeWV0XHJcbiAgcHJvdGVjdGVkIHNob3VsZFN0YXJ0Rm9yRWRpdG9yKGVkaXRvcjogVGV4dEVkaXRvcik6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLmluY2x1ZGVzKGVkaXRvci5nZXRHcmFtbWFyKCkuc2NvcGVOYW1lKTtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybiB0aGUgcGFyYW1ldGVycyB1c2VkIHRvIGluaXRpYWxpemUgYSBjbGllbnQgLSB5b3UgbWF5IHdhbnQgdG8gZXh0ZW5kIGNhcGFiaWxpdGllc1xyXG4gIHByb3RlY3RlZCBnZXRJbml0aWFsaXplUGFyYW1zKHByb2plY3RQYXRoOiBzdHJpbmcsIHByb2Nlc3M6IExhbmd1YWdlU2VydmVyUHJvY2Vzcyk6IGxzLkluaXRpYWxpemVQYXJhbXMge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcHJvY2Vzc0lkOiBwcm9jZXNzLnBpZCxcclxuICAgICAgcm9vdFBhdGg6IHByb2plY3RQYXRoLFxyXG4gICAgICByb290VXJpOiBDb252ZXJ0LnBhdGhUb1VyaShwcm9qZWN0UGF0aCksXHJcbiAgICAgIGNhcGFiaWxpdGllczoge1xyXG4gICAgICAgIHdvcmtzcGFjZToge1xyXG4gICAgICAgICAgYXBwbHlFZGl0OiB0cnVlLFxyXG4gICAgICAgICAgd29ya3NwYWNlRWRpdDoge1xyXG4gICAgICAgICAgICBkb2N1bWVudENoYW5nZXM6IHRydWUsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZGlkQ2hhbmdlQ29uZmlndXJhdGlvbjoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBkaWRDaGFuZ2VXYXRjaGVkRmlsZXM6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc3ltYm9sOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGV4ZWN1dGVDb21tYW5kOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRleHREb2N1bWVudDoge1xyXG4gICAgICAgICAgc3luY2hyb25pemF0aW9uOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgICB3aWxsU2F2ZTogdHJ1ZSxcclxuICAgICAgICAgICAgd2lsbFNhdmVXYWl0VW50aWw6IGZhbHNlLFxyXG4gICAgICAgICAgICBkaWRTYXZlOiB0cnVlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNvbXBsZXRpb246IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICAgIGNvbXBsZXRpb25JdGVtOiB7XHJcbiAgICAgICAgICAgICAgc25pcHBldFN1cHBvcnQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgY29tbWl0Q2hhcmFjdGVyc1N1cHBvcnQ6IGZhbHNlLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250ZXh0U3VwcG9ydDogdHJ1ZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBob3Zlcjoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzaWduYXR1cmVIZWxwOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHJlZmVyZW5jZXM6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZG9jdW1lbnRIaWdobGlnaHQ6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZG9jdW1lbnRTeW1ib2w6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZm9ybWF0dGluZzoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICByYW5nZUZvcm1hdHRpbmc6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgb25UeXBlRm9ybWF0dGluZzoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBkZWZpbml0aW9uOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNvZGVBY3Rpb246IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgY29kZUxlbnM6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZG9jdW1lbnRMaW5rOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHJlbmFtZToge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBleHBlcmltZW50YWw6IHt9LFxyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIEVhcmx5IHdpcmUtdXAgb2YgbGlzdGVuZXJzIGJlZm9yZSBpbml0aWFsaXplIG1ldGhvZCBpcyBzZW50XHJcbiAgcHJvdGVjdGVkIHByZUluaXRpYWxpemF0aW9uKGNvbm5lY3Rpb246IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbik6IHZvaWQge31cclxuXHJcbiAgLy8gTGF0ZSB3aXJlLXVwIG9mIGxpc3RlbmVycyBhZnRlciBpbml0aWFsaXplIG1ldGhvZCBoYXMgYmVlbiBzZW50XHJcbiAgcHJvdGVjdGVkIHBvc3RJbml0aWFsaXphdGlvbihzZXJ2ZXI6IEFjdGl2ZVNlcnZlcik6IHZvaWQge31cclxuXHJcbiAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdG8gdXNlIGlwYywgc3RkaW8gb3Igc29ja2V0IHRvIGNvbm5lY3QgdG8gdGhlIHNlcnZlclxyXG4gIHByb3RlY3RlZCBnZXRDb25uZWN0aW9uVHlwZSgpOiBDb25uZWN0aW9uVHlwZSB7XHJcbiAgICByZXR1cm4gdGhpcy5zb2NrZXQgIT0gbnVsbCA/ICdzb2NrZXQnIDogJ3N0ZGlvJztcclxuICB9XHJcblxyXG4gIC8vIFJldHVybiB0aGUgbmFtZSBvZiB5b3VyIHJvb3QgY29uZmlndXJhdGlvbiBrZXlcclxuICBwcm90ZWN0ZWQgZ2V0Um9vdENvbmZpZ3VyYXRpb25LZXkoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiAnJztcclxuICB9XHJcblxyXG4gIC8vIE9wdGlvbmFsbHkgdHJhbnNmb3JtIHRoZSBjb25maWd1cmF0aW9uIG9iamVjdCBiZWZvcmUgaXQgaXMgc2VudCB0byB0aGUgc2VydmVyXHJcbiAgcHJvdGVjdGVkIG1hcENvbmZpZ3VyYXRpb25PYmplY3QoY29uZmlndXJhdGlvbjogYW55KTogYW55IHtcclxuICAgIHJldHVybiBjb25maWd1cmF0aW9uO1xyXG4gIH1cclxuXHJcbiAgLy8gSGVscGVyIG1ldGhvZHMgdGhhdCBhcmUgdXNlZnVsIGZvciBpbXBsZW1lbnRvcnNcclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgLy8gR2V0cyBhIExhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiBmb3IgYSBnaXZlbiBUZXh0RWRpdG9yXHJcbiAgcHJvdGVjdGVkIGFzeW5jIGdldENvbm5lY3Rpb25Gb3JFZGl0b3IoZWRpdG9yOiBUZXh0RWRpdG9yKTogUHJvbWlzZTxscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24gfCBudWxsPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgcmV0dXJuIHNlcnZlciA/IHNlcnZlci5jb25uZWN0aW9uIDogbnVsbDtcclxuICB9XHJcblxyXG4gIC8vIFJlc3RhcnQgYWxsIGFjdGl2ZSBsYW5ndWFnZSBzZXJ2ZXJzIGZvciB0aGlzIGxhbmd1YWdlIGNsaWVudCBpbiB0aGUgd29ya3NwYWNlXHJcbiAgcHJvdGVjdGVkIGFzeW5jIHJlc3RhcnRBbGxTZXJ2ZXJzKCkge1xyXG4gICAgYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5yZXN0YXJ0QWxsU2VydmVycygpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgcmVzdCBvZiB0aGUgQXV0b0xhbmd1YWdlQ2xpZW50XHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8vIEFjdGl2YXRlIGRvZXMgdmVyeSBsaXR0bGUgZm9yIHBlcmYgcmVhc29ucyAtIGhvb2tzIGluIHZpYSBTZXJ2ZXJNYW5hZ2VyIGZvciBsYXRlciAnYWN0aXZhdGlvbidcclxuICBwdWJsaWMgYWN0aXZhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLm5hbWUgPSBgJHt0aGlzLmdldExhbmd1YWdlTmFtZSgpfSAoJHt0aGlzLmdldFNlcnZlck5hbWUoKX0pYDtcclxuICAgIHRoaXMubG9nZ2VyID0gdGhpcy5nZXRMb2dnZXIoKTtcclxuICAgIHRoaXMuX3NlcnZlck1hbmFnZXIgPSBuZXcgU2VydmVyTWFuYWdlcihcclxuICAgICAgKHApID0+IHRoaXMuc3RhcnRTZXJ2ZXIocCksXHJcbiAgICAgIHRoaXMubG9nZ2VyLFxyXG4gICAgICAoZSkgPT4gdGhpcy5zaG91bGRTdGFydEZvckVkaXRvcihlKSxcclxuICAgICAgKGZpbGVwYXRoKSA9PiB0aGlzLmZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyhmaWxlcGF0aCksXHJcbiAgICAgICgpID0+IHRoaXMuYnVzeVNpZ25hbFNlcnZpY2UsXHJcbiAgICAgIHRoaXMuZ2V0U2VydmVyTmFtZSgpLFxyXG4gICAgKTtcclxuICAgIHRoaXMuX3NlcnZlck1hbmFnZXIuc3RhcnRMaXN0ZW5pbmcoKTtcclxuICAgIHByb2Nlc3Mub24oJ2V4aXQnLCAoKSA9PiB0aGlzLmV4aXRDbGVhbnVwLmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBleGl0Q2xlYW51cCgpOiB2b2lkIHtcclxuICAgIHRoaXMuX3NlcnZlck1hbmFnZXIudGVybWluYXRlKCk7XHJcbiAgfVxyXG5cclxuICAvLyBEZWFjdGl2YXRlIGRpc3Bvc2VzIHRoZSByZXNvdXJjZXMgd2UncmUgdXNpbmdcclxuICBwdWJsaWMgYXN5bmMgZGVhY3RpdmF0ZSgpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdGhpcy5faXNEZWFjdGl2YXRpbmcgPSB0cnVlO1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0b3BMaXN0ZW5pbmcoKTtcclxuICAgIGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuc3RvcEFsbFNlcnZlcnMoKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBzcGF3bkNoaWxkTm9kZShhcmdzOiBzdHJpbmdbXSwgb3B0aW9uczogY3AuU3Bhd25PcHRpb25zID0ge30pOiBjcC5DaGlsZFByb2Nlc3Mge1xyXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYHN0YXJ0aW5nIGNoaWxkIE5vZGUgXCIke2FyZ3Muam9pbignICcpfVwiYCk7XHJcbiAgICBvcHRpb25zLmVudiA9IG9wdGlvbnMuZW52IHx8IE9iamVjdC5jcmVhdGUocHJvY2Vzcy5lbnYpO1xyXG4gICAgb3B0aW9ucy5lbnYuRUxFQ1RST05fUlVOX0FTX05PREUgPSAnMSc7XHJcbiAgICBvcHRpb25zLmVudi5FTEVDVFJPTl9OT19BVFRBQ0hfQ09OU09MRSA9ICcxJztcclxuICAgIHJldHVybiBjcC5zcGF3bihwcm9jZXNzLmV4ZWNQYXRoLCBhcmdzLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8vIEJ5IGRlZmF1bHQgTFNQIGxvZ2dpbmcgaXMgc3dpdGNoZWQgb2ZmIGJ1dCB5b3UgY2FuIHN3aXRjaCBpdCBvbiB2aWEgdGhlIGNvcmUuZGVidWdMU1Agc2V0dGluZ1xyXG4gIHByb3RlY3RlZCBnZXRMb2dnZXIoKTogTG9nZ2VyIHtcclxuICAgIHJldHVybiBhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuZGVidWdMU1AnKSA/IG5ldyBDb25zb2xlTG9nZ2VyKHRoaXMubmFtZSkgOiBuZXcgTnVsbExvZ2dlcigpO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnRzIHRoZSBzZXJ2ZXIgYnkgc3RhcnRpbmcgdGhlIHByb2Nlc3MsIHRoZW4gaW5pdGlhbGl6aW5nIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgYW5kIHN0YXJ0aW5nIGFkYXB0ZXJzXHJcbiAgcHJpdmF0ZSBhc3luYyBzdGFydFNlcnZlcihwcm9qZWN0UGF0aDogc3RyaW5nKTogUHJvbWlzZTxBY3RpdmVTZXJ2ZXI+IHtcclxuICAgIGNvbnN0IHN0YXJ0aW5nU2lnbmFsID0gdGhpcy5idXN5U2lnbmFsU2VydmljZSAmJiB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlLnJlcG9ydEJ1c3koXHJcbiAgICAgIGBTdGFydGluZyAke3RoaXMuZ2V0U2VydmVyTmFtZSgpfSBmb3IgJHtwYXRoLmJhc2VuYW1lKHByb2plY3RQYXRoKX1gLFxyXG4gICAgKTtcclxuICAgIGxldCBwcm9jZXNzO1xyXG4gICAgdHJ5IHtcclxuICAgICAgcHJvY2VzcyA9IGF3YWl0IHRoaXMuc3RhcnRTZXJ2ZXJQcm9jZXNzKHByb2plY3RQYXRoKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHN0YXJ0aW5nU2lnbmFsICYmIHN0YXJ0aW5nU2lnbmFsLmRpc3Bvc2UoKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2FwdHVyZVNlcnZlckVycm9ycyhwcm9jZXNzLCBwcm9qZWN0UGF0aCk7XHJcbiAgICBjb25zdCBjb25uZWN0aW9uID0gbmV3IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbih0aGlzLmNyZWF0ZVJwY0Nvbm5lY3Rpb24ocHJvY2VzcyksIHRoaXMubG9nZ2VyKTtcclxuICAgIHRoaXMucHJlSW5pdGlhbGl6YXRpb24oY29ubmVjdGlvbik7XHJcbiAgICBjb25zdCBpbml0aWFsaXplUGFyYW1zID0gdGhpcy5nZXRJbml0aWFsaXplUGFyYW1zKHByb2plY3RQYXRoLCBwcm9jZXNzKTtcclxuICAgIGNvbnN0IGluaXRpYWxpemF0aW9uID0gY29ubmVjdGlvbi5pbml0aWFsaXplKGluaXRpYWxpemVQYXJhbXMpO1xyXG4gICAgdGhpcy5idXN5U2lnbmFsU2VydmljZSAmJiB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlLnJlcG9ydEJ1c3lXaGlsZShcclxuICAgICAgYCR7dGhpcy5nZXRTZXJ2ZXJOYW1lKCl9IGluaXRpYWxpemluZyBmb3IgJHtwYXRoLmJhc2VuYW1lKHByb2plY3RQYXRoKX1gLFxyXG4gICAgICAoKSA9PiBpbml0aWFsaXphdGlvbixcclxuICAgICk7XHJcbiAgICBjb25zdCBpbml0aWFsaXplUmVzcG9uc2UgPSBhd2FpdCBpbml0aWFsaXphdGlvbjtcclxuICAgIGNvbnN0IG5ld1NlcnZlciA9IHtcclxuICAgICAgcHJvamVjdFBhdGgsXHJcbiAgICAgIHByb2Nlc3MsXHJcbiAgICAgIGNvbm5lY3Rpb24sXHJcbiAgICAgIGNhcGFiaWxpdGllczogaW5pdGlhbGl6ZVJlc3BvbnNlLmNhcGFiaWxpdGllcyxcclxuICAgICAgZGlzcG9zYWJsZTogbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKSxcclxuICAgIH07XHJcbiAgICB0aGlzLnBvc3RJbml0aWFsaXphdGlvbihuZXdTZXJ2ZXIpO1xyXG4gICAgY29ubmVjdGlvbi5pbml0aWFsaXplZCgpO1xyXG4gICAgY29ubmVjdGlvbi5vbignY2xvc2UnLCAoKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5faXNEZWFjdGl2YXRpbmcpIHtcclxuICAgICAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0b3BTZXJ2ZXIobmV3U2VydmVyKTtcclxuICAgICAgICBpZiAoIXRoaXMuX3NlcnZlck1hbmFnZXIuaGFzU2VydmVyUmVhY2hlZFJlc3RhcnRMaW1pdChuZXdTZXJ2ZXIpKSB7XHJcbiAgICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgUmVzdGFydGluZyBsYW5ndWFnZSBzZXJ2ZXIgZm9yIHByb2plY3QgJyR7bmV3U2VydmVyLnByb2plY3RQYXRofSdgKTtcclxuICAgICAgICAgIHRoaXMuX3NlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIocHJvamVjdFBhdGgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKGBMYW5ndWFnZSBzZXJ2ZXIgaGFzIGV4Y2VlZGVkIGF1dG8tcmVzdGFydCBsaW1pdCBmb3IgcHJvamVjdCAnJHtuZXdTZXJ2ZXIucHJvamVjdFBhdGh9J2ApO1xyXG4gICAgICAgICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKFxyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICAgICAgICAgIGBUaGUgJHt0aGlzLm5hbWV9IGxhbmd1YWdlIHNlcnZlciBoYXMgZXhpdGVkIGFuZCBleGNlZWRlZCB0aGUgcmVzdGFydCBsaW1pdCBmb3IgcHJvamVjdCAnJHtuZXdTZXJ2ZXIucHJvamVjdFBhdGh9J2ApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgY29uZmlndXJhdGlvbktleSA9IHRoaXMuZ2V0Um9vdENvbmZpZ3VyYXRpb25LZXkoKTtcclxuICAgIGlmIChjb25maWd1cmF0aW9uS2V5KSB7XHJcbiAgICAgIHRoaXMuX2Rpc3Bvc2FibGUuYWRkKFxyXG4gICAgICAgIGF0b20uY29uZmlnLm9ic2VydmUoY29uZmlndXJhdGlvbktleSwgKGNvbmZpZykgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbWFwcGVkQ29uZmlnID0gdGhpcy5tYXBDb25maWd1cmF0aW9uT2JqZWN0KGNvbmZpZyB8fCB7fSk7XHJcbiAgICAgICAgICBpZiAobWFwcGVkQ29uZmlnKSB7XHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24uZGlkQ2hhbmdlQ29uZmlndXJhdGlvbih7XHJcbiAgICAgICAgICAgICAgc2V0dGluZ3M6IG1hcHBlZENvbmZpZyxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc3RhcnRFeGNsdXNpdmVBZGFwdGVycyhuZXdTZXJ2ZXIpO1xyXG4gICAgcmV0dXJuIG5ld1NlcnZlcjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FwdHVyZVNlcnZlckVycm9ycyhjaGlsZFByb2Nlc3M6IExhbmd1YWdlU2VydmVyUHJvY2VzcywgcHJvamVjdFBhdGg6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY2hpbGRQcm9jZXNzLm9uKCdlcnJvcicsIChlcnIpID0+IHRoaXMuaGFuZGxlU3Bhd25GYWlsdXJlKGVycikpO1xyXG4gICAgY2hpbGRQcm9jZXNzLm9uKCdleGl0JywgKGNvZGUsIHNpZ25hbCkgPT4gdGhpcy5sb2dnZXIuZGVidWcoYGV4aXQ6IGNvZGUgJHtjb2RlfSBzaWduYWwgJHtzaWduYWx9YCkpO1xyXG4gICAgY2hpbGRQcm9jZXNzLnN0ZGVyci5zZXRFbmNvZGluZygndXRmOCcpO1xyXG4gICAgY2hpbGRQcm9jZXNzLnN0ZGVyci5vbignZGF0YScsIChjaHVuazogQnVmZmVyKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVycm9yU3RyaW5nID0gY2h1bmsudG9TdHJpbmcoKTtcclxuICAgICAgdGhpcy5oYW5kbGVTZXJ2ZXJTdGRlcnIoZXJyb3JTdHJpbmcsIHByb2plY3RQYXRoKTtcclxuICAgICAgLy8gS2VlcCB0aGUgbGFzdCA1IGxpbmVzIGZvciBwYWNrYWdlcyB0byB1c2UgaW4gbWVzc2FnZXNcclxuICAgICAgdGhpcy5wcm9jZXNzU3RkRXJyID0gKHRoaXMucHJvY2Vzc1N0ZEVyciArIGVycm9yU3RyaW5nKVxyXG4gICAgICAgIC5zcGxpdCgnXFxuJylcclxuICAgICAgICAuc2xpY2UoLTUpXHJcbiAgICAgICAgLmpvaW4oJ1xcbicpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZVNwYXduRmFpbHVyZShlcnI6IGFueSk6IHZvaWQge1xyXG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKFxyXG4gICAgICBgJHt0aGlzLmdldFNlcnZlck5hbWUoKX0gbGFuZ3VhZ2Ugc2VydmVyIGZvciAke3RoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCl9IHVuYWJsZSB0byBzdGFydGAsXHJcbiAgICAgIHtcclxuICAgICAgICBkaXNtaXNzYWJsZTogdHJ1ZSxcclxuICAgICAgICBkZXNjcmlwdGlvbjogZXJyLnRvU3RyaW5nKCksXHJcbiAgICAgIH0sXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gQ3JlYXRlcyB0aGUgUlBDIGNvbm5lY3Rpb24gd2hpY2ggY2FuIGJlIGlwYywgc29ja2V0IG9yIHN0ZGlvXHJcbiAgcHJpdmF0ZSBjcmVhdGVScGNDb25uZWN0aW9uKHByb2Nlc3M6IExhbmd1YWdlU2VydmVyUHJvY2Vzcyk6IHJwYy5NZXNzYWdlQ29ubmVjdGlvbiB7XHJcbiAgICBsZXQgcmVhZGVyOiBycGMuTWVzc2FnZVJlYWRlcjtcclxuICAgIGxldCB3cml0ZXI6IHJwYy5NZXNzYWdlV3JpdGVyO1xyXG4gICAgY29uc3QgY29ubmVjdGlvblR5cGUgPSB0aGlzLmdldENvbm5lY3Rpb25UeXBlKCk7XHJcbiAgICBzd2l0Y2ggKGNvbm5lY3Rpb25UeXBlKSB7XHJcbiAgICAgIGNhc2UgJ2lwYyc6XHJcbiAgICAgICAgcmVhZGVyID0gbmV3IHJwYy5JUENNZXNzYWdlUmVhZGVyKHByb2Nlc3MgYXMgY3AuQ2hpbGRQcm9jZXNzKTtcclxuICAgICAgICB3cml0ZXIgPSBuZXcgcnBjLklQQ01lc3NhZ2VXcml0ZXIocHJvY2VzcyBhcyBjcC5DaGlsZFByb2Nlc3MpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdzb2NrZXQnOlxyXG4gICAgICAgIHJlYWRlciA9IG5ldyBycGMuU29ja2V0TWVzc2FnZVJlYWRlcih0aGlzLnNvY2tldCk7XHJcbiAgICAgICAgd3JpdGVyID0gbmV3IHJwYy5Tb2NrZXRNZXNzYWdlV3JpdGVyKHRoaXMuc29ja2V0KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnc3RkaW8nOlxyXG4gICAgICAgIHJlYWRlciA9IG5ldyBycGMuU3RyZWFtTWVzc2FnZVJlYWRlcihwcm9jZXNzLnN0ZG91dCk7XHJcbiAgICAgICAgd3JpdGVyID0gbmV3IHJwYy5TdHJlYW1NZXNzYWdlV3JpdGVyKHByb2Nlc3Muc3RkaW4pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiBVdGlscy5hc3NlcnRVbnJlYWNoYWJsZShjb25uZWN0aW9uVHlwZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJwYy5jcmVhdGVNZXNzYWdlQ29ubmVjdGlvbihyZWFkZXIsIHdyaXRlciwge1xyXG4gICAgICBsb2c6ICguLi5hcmdzOiBhbnlbXSkgPT4ge30sXHJcbiAgICAgIHdhcm46ICguLi5hcmdzOiBhbnlbXSkgPT4ge30sXHJcbiAgICAgIGluZm86ICguLi5hcmdzOiBhbnlbXSkgPT4ge30sXHJcbiAgICAgIGVycm9yOiAoLi4uYXJnczogYW55W10pID0+IHtcclxuICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihhcmdzKTtcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnQgYWRhcHRlcnMgdGhhdCBhcmUgbm90IHNoYXJlZCBiZXR3ZWVuIHNlcnZlcnNcclxuICBwcml2YXRlIHN0YXJ0RXhjbHVzaXZlQWRhcHRlcnMoc2VydmVyOiBBY3RpdmVTZXJ2ZXIpOiB2b2lkIHtcclxuICAgIEFwcGx5RWRpdEFkYXB0ZXIuYXR0YWNoKHNlcnZlci5jb25uZWN0aW9uKTtcclxuICAgIE5vdGlmaWNhdGlvbnNBZGFwdGVyLmF0dGFjaChzZXJ2ZXIuY29ubmVjdGlvbiwgdGhpcy5uYW1lLCBzZXJ2ZXIucHJvamVjdFBhdGgpO1xyXG5cclxuICAgIGlmIChEb2N1bWVudFN5bmNBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHNlcnZlci5kb2NTeW5jQWRhcHRlciA9XHJcbiAgICAgICAgbmV3IERvY3VtZW50U3luY0FkYXB0ZXIoXHJcbiAgICAgICAgICBzZXJ2ZXIuY29ubmVjdGlvbixcclxuICAgICAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMudGV4dERvY3VtZW50U3luYyxcclxuICAgICAgICAgIChlZGl0b3IpID0+IHRoaXMuc2hvdWxkU3luY0ZvckVkaXRvcihlZGl0b3IsIHNlcnZlci5wcm9qZWN0UGF0aCkpO1xyXG4gICAgICBzZXJ2ZXIuZGlzcG9zYWJsZS5hZGQoc2VydmVyLmRvY1N5bmNBZGFwdGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXJ2ZXIubGludGVyUHVzaFYyID0gbmV3IExpbnRlclB1c2hWMkFkYXB0ZXIoc2VydmVyLmNvbm5lY3Rpb24pO1xyXG4gICAgaWYgKHRoaXMuX2xpbnRlckRlbGVnYXRlICE9IG51bGwpIHtcclxuICAgICAgc2VydmVyLmxpbnRlclB1c2hWMi5hdHRhY2godGhpcy5fbGludGVyRGVsZWdhdGUpO1xyXG4gICAgfVxyXG4gICAgc2VydmVyLmRpc3Bvc2FibGUuYWRkKHNlcnZlci5saW50ZXJQdXNoVjIpO1xyXG5cclxuICAgIGlmIChTaWduYXR1cmVIZWxwQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICBzZXJ2ZXIuc2lnbmF0dXJlSGVscEFkYXB0ZXIgPSBuZXcgU2lnbmF0dXJlSGVscEFkYXB0ZXIoc2VydmVyLCB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSk7XHJcbiAgICAgIGlmICh0aGlzLl9zaWduYXR1cmVIZWxwUmVnaXN0cnkgIT0gbnVsbCkge1xyXG4gICAgICAgIHNlcnZlci5zaWduYXR1cmVIZWxwQWRhcHRlci5hdHRhY2godGhpcy5fc2lnbmF0dXJlSGVscFJlZ2lzdHJ5KTtcclxuICAgICAgfVxyXG4gICAgICBzZXJ2ZXIuZGlzcG9zYWJsZS5hZGQoc2VydmVyLnNpZ25hdHVyZUhlbHBBZGFwdGVyKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzaG91bGRTeW5jRm9yRWRpdG9yKGVkaXRvcjogVGV4dEVkaXRvciwgcHJvamVjdFBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaXNGaWxlSW5Qcm9qZWN0KGVkaXRvciwgcHJvamVjdFBhdGgpICYmIHRoaXMuc2hvdWxkU3RhcnRGb3JFZGl0b3IoZWRpdG9yKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBpc0ZpbGVJblByb2plY3QoZWRpdG9yOiBUZXh0RWRpdG9yLCBwcm9qZWN0UGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKGVkaXRvci5nZXRVUkkoKSB8fCAnJykuc3RhcnRzV2l0aChwcm9qZWN0UGF0aCk7XHJcbiAgfVxyXG5cclxuICAvLyBBdXRvY29tcGxldGUrIHZpYSBMUyBjb21wbGV0aW9uLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgcHVibGljIHByb3ZpZGVBdXRvY29tcGxldGUoKTogQXV0b2NvbXBsZXRlUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc2VsZWN0b3I6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpXHJcbiAgICAgICAgLm1hcCgoZykgPT4gJy4nICsgZylcclxuICAgICAgICAuam9pbignLCAnKSxcclxuICAgICAgaW5jbHVzaW9uUHJpb3JpdHk6IDEsXHJcbiAgICAgIHN1Z2dlc3Rpb25Qcmlvcml0eTogMixcclxuICAgICAgZXhjbHVkZUxvd2VyUHJpb3JpdHk6IGZhbHNlLFxyXG4gICAgICBnZXRTdWdnZXN0aW9uczogdGhpcy5nZXRTdWdnZXN0aW9ucy5iaW5kKHRoaXMpLFxyXG4gICAgICBvbkRpZEluc2VydFN1Z2dlc3Rpb246IHRoaXMub25EaWRJbnNlcnRTdWdnZXN0aW9uLmJpbmQodGhpcyksXHJcbiAgICAgIGdldFN1Z2dlc3Rpb25EZXRhaWxzT25TZWxlY3Q6IHRoaXMuZ2V0U3VnZ2VzdGlvbkRldGFpbHNPblNlbGVjdC5iaW5kKHRoaXMpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhc3luYyBnZXRTdWdnZXN0aW9ucyhcclxuICAgIHJlcXVlc3Q6IEF1dG9jb21wbGV0ZVJlcXVlc3QsXHJcbiAgKTogUHJvbWlzZTxBdXRvY29tcGxldGVTdWdnZXN0aW9uW10+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKHJlcXVlc3QuZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhQXV0b2NvbXBsZXRlQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hdXRvQ29tcGxldGUgPSB0aGlzLmF1dG9Db21wbGV0ZSB8fCBuZXcgQXV0b2NvbXBsZXRlQWRhcHRlcigpO1xyXG4gICAgdGhpcy5fbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3QgPSByZXF1ZXN0O1xyXG4gICAgcmV0dXJuIHRoaXMuYXV0b0NvbXBsZXRlLmdldFN1Z2dlc3Rpb25zKHNlcnZlciwgcmVxdWVzdCwgdGhpcy5vbkRpZENvbnZlcnRBdXRvY29tcGxldGUsXHJcbiAgICAgIGF0b20uY29uZmlnLmdldCgnYXV0b2NvbXBsZXRlLXBsdXMubWluaW11bVdvcmRMZW5ndGgnKSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgYXN5bmMgZ2V0U3VnZ2VzdGlvbkRldGFpbHNPblNlbGVjdChcclxuICAgIHN1Z2dlc3Rpb246IEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24pOiBQcm9taXNlPEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24gfCBudWxsPiB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5fbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3Q7XHJcbiAgICBpZiAocmVxdWVzdCA9PSBudWxsKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihyZXF1ZXN0LmVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUF1dG9jb21wbGV0ZUFkYXB0ZXIuY2FuUmVzb2x2ZShzZXJ2ZXIuY2FwYWJpbGl0aWVzKSB8fCB0aGlzLmF1dG9Db21wbGV0ZSA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmF1dG9Db21wbGV0ZS5jb21wbGV0ZVN1Z2dlc3Rpb24oc2VydmVyLCBzdWdnZXN0aW9uLCByZXF1ZXN0LCB0aGlzLm9uRGlkQ29udmVydEF1dG9jb21wbGV0ZSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgb25EaWRDb252ZXJ0QXV0b2NvbXBsZXRlKFxyXG4gICAgY29tcGxldGlvbkl0ZW06IGxzLkNvbXBsZXRpb25JdGVtLFxyXG4gICAgc3VnZ2VzdGlvbjogQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbixcclxuICAgIHJlcXVlc3Q6IEF1dG9jb21wbGV0ZVJlcXVlc3QsXHJcbiAgKTogdm9pZCB7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgb25EaWRJbnNlcnRTdWdnZXN0aW9uKGFyZzogQXV0b2NvbXBsZXRlRGlkSW5zZXJ0KTogdm9pZCB7fVxyXG5cclxuICAvLyBEZWZpbml0aW9ucyB2aWEgTFMgZG9jdW1lbnRIaWdobGlnaHQgYW5kIGdvdG9EZWZpbml0aW9uLS0tLS0tLS0tLS0tXHJcbiAgcHVibGljIHByb3ZpZGVEZWZpbml0aW9ucygpOiBhdG9tSWRlLkRlZmluaXRpb25Qcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXHJcbiAgICAgIHByaW9yaXR5OiAyMCxcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIGdldERlZmluaXRpb246IHRoaXMuZ2V0RGVmaW5pdGlvbi5iaW5kKHRoaXMpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhc3luYyBnZXREZWZpbml0aW9uKGVkaXRvcjogVGV4dEVkaXRvciwgcG9pbnQ6IFBvaW50KTogUHJvbWlzZTxhdG9tSWRlLkRlZmluaXRpb25RdWVyeVJlc3VsdCB8IG51bGw+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIURlZmluaXRpb25BZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGVmaW5pdGlvbnMgPSB0aGlzLmRlZmluaXRpb25zIHx8IG5ldyBEZWZpbml0aW9uQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuZGVmaW5pdGlvbnMuZ2V0RGVmaW5pdGlvbihcclxuICAgICAgc2VydmVyLmNvbm5lY3Rpb24sXHJcbiAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIHRoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCksXHJcbiAgICAgIGVkaXRvcixcclxuICAgICAgcG9pbnQsXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gT3V0bGluZSBWaWV3IHZpYSBMUyBkb2N1bWVudFN5bWJvbC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIHB1YmxpYyBwcm92aWRlT3V0bGluZXMoKTogYXRvbUlkZS5PdXRsaW5lUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgcHJpb3JpdHk6IDEsXHJcbiAgICAgIGdldE91dGxpbmU6IHRoaXMuZ2V0T3V0bGluZS5iaW5kKHRoaXMpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhc3luYyBnZXRPdXRsaW5lKGVkaXRvcjogVGV4dEVkaXRvcik6IFByb21pc2U8YXRvbUlkZS5PdXRsaW5lIHwgbnVsbD4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhT3V0bGluZVZpZXdBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMub3V0bGluZVZpZXcgPSB0aGlzLm91dGxpbmVWaWV3IHx8IG5ldyBPdXRsaW5lVmlld0FkYXB0ZXIoKTtcclxuICAgIHJldHVybiB0aGlzLm91dGxpbmVWaWV3LmdldE91dGxpbmUoc2VydmVyLmNvbm5lY3Rpb24sIGVkaXRvcik7XHJcbiAgfVxyXG5cclxuICAvLyBMaW50ZXIgcHVzaCB2MiBBUEkgdmlhIExTIHB1Ymxpc2hEaWFnbm9zdGljc1xyXG4gIHB1YmxpYyBjb25zdW1lTGludGVyVjIocmVnaXN0ZXJJbmRpZTogKHBhcmFtczoge25hbWU6IHN0cmluZ30pID0+IGxpbnRlci5JbmRpZURlbGVnYXRlKTogdm9pZCB7XHJcbiAgICB0aGlzLl9saW50ZXJEZWxlZ2F0ZSA9IHJlZ2lzdGVySW5kaWUoe25hbWU6IHRoaXMubmFtZX0pO1xyXG4gICAgaWYgKHRoaXMuX2xpbnRlckRlbGVnYXRlID09IG51bGwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3Qgc2VydmVyIG9mIHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0QWN0aXZlU2VydmVycygpKSB7XHJcbiAgICAgIGlmIChzZXJ2ZXIubGludGVyUHVzaFYyICE9IG51bGwpIHtcclxuICAgICAgICBzZXJ2ZXIubGludGVyUHVzaFYyLmF0dGFjaCh0aGlzLl9saW50ZXJEZWxlZ2F0ZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEZpbmQgUmVmZXJlbmNlcyB2aWEgTFMgZmluZFJlZmVyZW5jZXMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICBwdWJsaWMgcHJvdmlkZUZpbmRSZWZlcmVuY2VzKCk6IGF0b21JZGUuRmluZFJlZmVyZW5jZXNQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc0VkaXRvclN1cHBvcnRlZDogKGVkaXRvcjogVGV4dEVkaXRvcikgPT4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWUpLFxyXG4gICAgICBmaW5kUmVmZXJlbmNlczogdGhpcy5nZXRSZWZlcmVuY2VzLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGFzeW5jIGdldFJlZmVyZW5jZXMoZWRpdG9yOiBUZXh0RWRpdG9yLCBwb2ludDogUG9pbnQpOiBQcm9taXNlPGF0b21JZGUuRmluZFJlZmVyZW5jZXNSZXR1cm4gfCBudWxsPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFGaW5kUmVmZXJlbmNlc0FkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5maW5kUmVmZXJlbmNlcyA9IHRoaXMuZmluZFJlZmVyZW5jZXMgfHwgbmV3IEZpbmRSZWZlcmVuY2VzQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuZmluZFJlZmVyZW5jZXMuZ2V0UmVmZXJlbmNlcyhzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yLCBwb2ludCwgc2VydmVyLnByb2plY3RQYXRoKTtcclxuICB9XHJcblxyXG4gIC8vIERhdGF0aXAgdmlhIExTIHRleHREb2N1bWVudC9ob3Zlci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICBwdWJsaWMgY29uc3VtZURhdGF0aXAoc2VydmljZTogYXRvbUlkZS5EYXRhdGlwU2VydmljZSk6IHZvaWQge1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZS5hZGQoXHJcbiAgICAgIHNlcnZpY2UuYWRkUHJvdmlkZXIoe1xyXG4gICAgICAgIHByb3ZpZGVyTmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICAgIHZhbGlkRm9yU2NvcGU6IChzY29wZU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLmluY2x1ZGVzKHNjb3BlTmFtZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBkYXRhdGlwOiB0aGlzLmdldERhdGF0aXAuYmluZCh0aGlzKSxcclxuICAgICAgfSksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGFzeW5jIGdldERhdGF0aXAoZWRpdG9yOiBUZXh0RWRpdG9yLCBwb2ludDogUG9pbnQpOiBQcm9taXNlPGF0b21JZGUuRGF0YXRpcCB8IG51bGw+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIURhdGF0aXBBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGF0YXRpcCA9IHRoaXMuZGF0YXRpcCB8fCBuZXcgRGF0YXRpcEFkYXB0ZXIoKTtcclxuICAgIHJldHVybiB0aGlzLmRhdGF0aXAuZ2V0RGF0YXRpcChzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yLCBwb2ludCk7XHJcbiAgfVxyXG5cclxuICAvLyBDb2RlIEZvcm1hdCB2aWEgTFMgZm9ybWF0RG9jdW1lbnQgJiBmb3JtYXREb2N1bWVudFJhbmdlLS0tLS0tLS0tLS0tXHJcbiAgcHVibGljIHByb3ZpZGVDb2RlRm9ybWF0KCk6IGF0b21JZGUuUmFuZ2VDb2RlRm9ybWF0UHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBmb3JtYXRDb2RlOiB0aGlzLmdldENvZGVGb3JtYXQuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgYXN5bmMgZ2V0Q29kZUZvcm1hdChlZGl0b3I6IFRleHRFZGl0b3IsIHJhbmdlOiBSYW5nZSk6IFByb21pc2U8YXRvbUlkZS5UZXh0RWRpdFtdPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFDb2RlRm9ybWF0QWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIENvZGVGb3JtYXRBZGFwdGVyLmZvcm1hdChzZXJ2ZXIuY29ubmVjdGlvbiwgc2VydmVyLmNhcGFiaWxpdGllcywgZWRpdG9yLCByYW5nZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcHJvdmlkZUNvZGVIaWdobGlnaHQoKTogYXRvbUlkZS5Db2RlSGlnaGxpZ2h0UHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBoaWdobGlnaHQ6IChlZGl0b3IsIHBvc2l0aW9uKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29kZUhpZ2hsaWdodChlZGl0b3IsIHBvc2l0aW9uKTtcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgYXN5bmMgZ2V0Q29kZUhpZ2hsaWdodChlZGl0b3I6IFRleHRFZGl0b3IsIHBvc2l0aW9uOiBQb2ludCk6IFByb21pc2U8UmFuZ2VbXSB8IG51bGw+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVIaWdobGlnaHRBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBDb2RlSGlnaGxpZ2h0QWRhcHRlci5oaWdobGlnaHQoc2VydmVyLmNvbm5lY3Rpb24sIHNlcnZlci5jYXBhYmlsaXRpZXMsIGVkaXRvciwgcG9zaXRpb24pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHByb3ZpZGVDb2RlQWN0aW9ucygpOiBhdG9tSWRlLkNvZGVBY3Rpb25Qcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgcHJpb3JpdHk6IDEsXHJcbiAgICAgIGdldENvZGVBY3Rpb25zOiAoZWRpdG9yLCByYW5nZSwgZGlhZ25vc3RpY3MpID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2RlQWN0aW9ucyhlZGl0b3IsIHJhbmdlLCBkaWFnbm9zdGljcyk7XHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGFzeW5jIGdldENvZGVBY3Rpb25zKGVkaXRvcjogVGV4dEVkaXRvciwgcmFuZ2U6IFJhbmdlLCBkaWFnbm9zdGljczogYXRvbUlkZS5EaWFnbm9zdGljW10pIHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVBY3Rpb25BZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBDb2RlQWN0aW9uQWRhcHRlci5nZXRDb2RlQWN0aW9ucyhcclxuICAgICAgc2VydmVyLmNvbm5lY3Rpb24sXHJcbiAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIHNlcnZlci5saW50ZXJQdXNoVjIsXHJcbiAgICAgIGVkaXRvcixcclxuICAgICAgcmFuZ2UsXHJcbiAgICAgIGRpYWdub3N0aWNzLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjb25zdW1lU2lnbmF0dXJlSGVscChyZWdpc3RyeTogYXRvbUlkZS5TaWduYXR1cmVIZWxwUmVnaXN0cnkpOiBEaXNwb3NhYmxlIHtcclxuICAgIHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSA9IHJlZ2lzdHJ5O1xyXG4gICAgZm9yIChjb25zdCBzZXJ2ZXIgb2YgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRBY3RpdmVTZXJ2ZXJzKCkpIHtcclxuICAgICAgaWYgKHNlcnZlci5zaWduYXR1cmVIZWxwQWRhcHRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgc2VydmVyLnNpZ25hdHVyZUhlbHBBZGFwdGVyLmF0dGFjaChyZWdpc3RyeSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSA9IG51bGw7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjb25zdW1lQnVzeVNpZ25hbChzZXJ2aWNlOiBhdG9tSWRlLkJ1c3lTaWduYWxTZXJ2aWNlKTogRGlzcG9zYWJsZSB7XHJcbiAgICB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlID0gc2VydmljZTtcclxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiBkZWxldGUgdGhpcy5idXN5U2lnbmFsU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBgZGlkQ2hhbmdlV2F0Y2hlZEZpbGVzYCBtZXNzYWdlIGZpbHRlcmluZywgb3ZlcnJpZGUgZm9yIGN1c3RvbSBsb2dpYy5cclxuICAgKiBAcGFyYW0gZmlsZVBhdGggcGF0aCBvZiBhIGZpbGUgdGhhdCBoYXMgY2hhbmdlZCBpbiB0aGUgcHJvamVjdCBwYXRoXHJcbiAgICogQHJldHVybiBmYWxzZSA9PiBtZXNzYWdlIHdpbGwgbm90IGJlIHNlbnQgdG8gdGhlIGxhbmd1YWdlIHNlcnZlclxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBmaWx0ZXJDaGFuZ2VXYXRjaGVkRmlsZXMoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxsZWQgb24gbGFuZ3VhZ2Ugc2VydmVyIHN0ZGVyciBvdXRwdXQuXHJcbiAgICogQHBhcmFtIHN0ZGVyciBhIGNodW5rIG9mIHN0ZGVyciBmcm9tIGEgbGFuZ3VhZ2Ugc2VydmVyIGluc3RhbmNlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVTZXJ2ZXJTdGRlcnIoc3RkZXJyOiBzdHJpbmcsIHByb2plY3RQYXRoOiBzdHJpbmcpIHtcclxuICAgIHN0ZGVyci5zcGxpdCgnXFxuJykuZmlsdGVyKChsKSA9PiBsKS5mb3JFYWNoKChsaW5lKSA9PiB0aGlzLmxvZ2dlci53YXJuKGBzdGRlcnIgJHtsaW5lfWApKTtcclxuICB9XHJcbn1cclxuIl19
Object.defineProperty(exports, "__esModule", {
  value: true
});

var _languageclient = require('../languageclient');

var _convert = require('../convert');

var _convert2 = _interopRequireDefault(_convert);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Public: Adapts the language server protocol "textDocument/completion" to the Atom
// AutoComplete+ package.
class AutocompleteAdapter {
  constructor() {
    this._lastSuggestions = new Map();
  }

  static canAdapt(serverCapabilities) {
    return serverCapabilities.completionProvider != null;
  }

  // Public: Obtain suggestion list for AutoComplete+ by querying the language server using
  // the `textDocument/completion` request.
  //
  // * `connection` A {LanguageClientConnection} to the language server to query.
  // * `request` The {atom$AutocompleteRequest} to satisfy.
  // * `onDidConvertCompletionItem` A function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
  //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
  //
  // Returns a {Promise} of an {Array} of {atom$AutocompleteSuggestion}s containing the
  // AutoComplete+ suggestions to display.
  async getSuggestions(connection, request, onDidConvertCompletionItem) {
    const items = await connection.completion(AutocompleteAdapter.requestToTextDocumentPositionParams(request));
    this._lastSuggestions = this.completionItemsToSuggestions(items, request, onDidConvertCompletionItem);
    return Array.from(this._lastSuggestions.keys());
  }

  // Public: Obtain a complete version of a suggestion with additional information
  // the language server can provide by way of the `completionItem/resolve` request.
  //
  // * `connection` A {LanguageClientConnection} to the language server to query.
  // * `request` An {Object} with the AutoComplete+ request to satisfy.
  //
  // Returns a {Promise} of an {atom$AutocompleteSuggestion} with the resolved AutoComplete+
  // suggestion.
  async completeSuggestion(connection, suggestion, request, onDidConvertCompletionItem) {
    const originalCompletionItem = this._lastSuggestions.get(suggestion);
    if (originalCompletionItem != null && originalCompletionItem[1] === false) {
      const resolveCompletionItem = await connection.completionItemResolve(originalCompletionItem[0]);
      if (resolveCompletionItem != null) {
        AutocompleteAdapter.completionItemToSuggestion(resolveCompletionItem, suggestion, request, onDidConvertCompletionItem);
      }
    }

    return suggestion;
  }

  // Public: Create TextDocumentPositionParams to be sent to the language server
  // based on the editor and position from the AutoCompleteRequest.
  //
  // * `request` The {atom$AutocompleteRequest} to satisfy.
  //
  // Returns an {TextDocumentPositionParams} with the keys:
  //  * `textDocument` the language server protocol textDocument identification.
  //  * `position` the position within the text document to display completion request for.
  static requestToTextDocumentPositionParams(request) {
    return {
      textDocument: _convert2.default.editorToTextDocumentIdentifier(request.editor),
      position: _convert2.default.pointToPosition(request.bufferPosition)
    };
  }

  // Public: Convert a language server protocol CompletionItem array or CompletionList to
  // an array of ordered AutoComplete+ suggestions.
  //
  // * `completionItems` An {Array} of {CompletionItem} objects or a {CompletionList} containing completion
  //           items to be converted.
  // * `request` The {atom$AutocompleteRequest} to satisfy.
  // * `onDidConvertCompletionItem` A function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
  //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
  //
  // Returns a {Map} of AutoComplete+ suggestions ordered by the CompletionItems sortText.
  completionItemsToSuggestions(completionItems, request, onDidConvertCompletionItem) {
    return new Map((Array.isArray(completionItems) ? completionItems : completionItems.items || []).sort((a, b) => (a.sortText || a.label).localeCompare(b.sortText || b.label)).map(s => [AutocompleteAdapter.completionItemToSuggestion(s, {}, request, onDidConvertCompletionItem), [s, false]]));
  }

  // Public: Convert a language server protocol CompletionItem to an AutoComplete+ suggestion.
  //
  // * `item` An {CompletionItem} containing a completion item to be converted.
  // * `suggestion` A {atom$AutocompleteSuggestion} to have the conversion applied to.
  // * `request` The {atom$AutocompleteRequest} to satisfy.
  // * `onDidConvertCompletionItem` A function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
  //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
  //
  // Returns the {atom$AutocompleteSuggestion} passed in as suggestion with the conversion applied.
  static completionItemToSuggestion(item, suggestion, request, onDidConvertCompletionItem) {
    AutocompleteAdapter.applyCompletionItemToSuggestion(item, suggestion);
    AutocompleteAdapter.applyTextEditToSuggestion(item.textEdit, request.editor, suggestion);
    if (onDidConvertCompletionItem != null) {
      onDidConvertCompletionItem(item, suggestion, request);
    }
    return suggestion;
  }

  // Public: Convert the primary parts of a language server protocol CompletionItem to an AutoComplete+ suggestion.
  //
  // * `item` An {CompletionItem} containing the completion items to be merged into.
  // * `suggestion` The {atom$AutocompleteSuggestion} to merge the conversion into.
  //
  // Returns an {atom$AutocompleteSuggestion} created from the {CompletionItem}.
  static applyCompletionItemToSuggestion(item, suggestion) {
    suggestion.text = item.insertText || item.label;
    suggestion.displayText = item.label;
    suggestion.snippet = item.insertTextFormat === 2 ? item.insertText : undefined;
    suggestion.type = AutocompleteAdapter.completionKindToSuggestionType(item.kind);
    suggestion.rightLabel = item.detail;
    suggestion.description = item.documentation;
    suggestion.descriptionMarkdown = item.documentation;
  }

  // Public: Applies the textEdit part of a language server protocol CompletionItem to an
  // AutoComplete+ Suggestion via the replacementPrefix and text properties.
  //
  // * `textEdit` A {TextEdit} from a CompletionItem to apply.
  // * `editor` An Atom {TextEditor} used to obtain the necessary text replacement.
  // * `suggestion` An {atom$AutocompleteSuggestion} to set the replacementPrefix and text properties of.
  static applyTextEditToSuggestion(textEdit, editor, suggestion) {
    if (textEdit != null) {
      suggestion.replacementPrefix = editor.getTextInBufferRange(_convert2.default.lsRangeToAtomRange(textEdit.range));
      suggestion.text = textEdit.newText;
    }
  }

  // Public: Obtain the textual suggestion type required by AutoComplete+ that
  // most closely maps to the numeric completion kind supplies by the language server.
  //
  // * `kind` A {Number} that represents the suggestion kind to be converted.
  //
  // Returns a {String} containing the AutoComplete+ suggestion type equivalent
  // to the given completion kind.
  static completionKindToSuggestionType(kind) {
    switch (kind) {
      case _languageclient.CompletionItemKind.Method:
        return 'method';
      case _languageclient.CompletionItemKind.Function:
      case _languageclient.CompletionItemKind.Constructor:
        return 'function';
      case _languageclient.CompletionItemKind.Field:
      case _languageclient.CompletionItemKind.Property:
        return 'property';
      case _languageclient.CompletionItemKind.Variable:
        return 'variable';
      case _languageclient.CompletionItemKind.Class:
        return 'class';
      case _languageclient.CompletionItemKind.Interface:
        return 'interface';
      case _languageclient.CompletionItemKind.Module:
        return 'module';
      case _languageclient.CompletionItemKind.Unit:
        return 'builtin';
      case _languageclient.CompletionItemKind.Enum:
        return 'enum';
      case _languageclient.CompletionItemKind.Keyword:
        return 'keyword';
      case _languageclient.CompletionItemKind.Snippet:
        return 'snippet';
      case _languageclient.CompletionItemKind.File:
        return 'import';
      case _languageclient.CompletionItemKind.Reference:
        return 'require';
      default:
        return 'value';
    }
  }
}
exports.default = AutocompleteAdapter;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9hZGFwdGVycy9hdXRvY29tcGxldGUtYWRhcHRlci5qcyJdLCJuYW1lcyI6WyJBdXRvY29tcGxldGVBZGFwdGVyIiwiX2xhc3RTdWdnZXN0aW9ucyIsIk1hcCIsImNhbkFkYXB0Iiwic2VydmVyQ2FwYWJpbGl0aWVzIiwiY29tcGxldGlvblByb3ZpZGVyIiwiZ2V0U3VnZ2VzdGlvbnMiLCJjb25uZWN0aW9uIiwicmVxdWVzdCIsIm9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtIiwiaXRlbXMiLCJjb21wbGV0aW9uIiwicmVxdWVzdFRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMiLCJjb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zIiwiQXJyYXkiLCJmcm9tIiwia2V5cyIsImNvbXBsZXRlU3VnZ2VzdGlvbiIsInN1Z2dlc3Rpb24iLCJvcmlnaW5hbENvbXBsZXRpb25JdGVtIiwiZ2V0IiwicmVzb2x2ZUNvbXBsZXRpb25JdGVtIiwiY29tcGxldGlvbkl0ZW1SZXNvbHZlIiwiY29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24iLCJ0ZXh0RG9jdW1lbnQiLCJlZGl0b3JUb1RleHREb2N1bWVudElkZW50aWZpZXIiLCJlZGl0b3IiLCJwb3NpdGlvbiIsInBvaW50VG9Qb3NpdGlvbiIsImJ1ZmZlclBvc2l0aW9uIiwiY29tcGxldGlvbkl0ZW1zIiwiaXNBcnJheSIsInNvcnQiLCJhIiwiYiIsInNvcnRUZXh0IiwibGFiZWwiLCJsb2NhbGVDb21wYXJlIiwibWFwIiwicyIsIml0ZW0iLCJhcHBseUNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uIiwiYXBwbHlUZXh0RWRpdFRvU3VnZ2VzdGlvbiIsInRleHRFZGl0IiwidGV4dCIsImluc2VydFRleHQiLCJkaXNwbGF5VGV4dCIsInNuaXBwZXQiLCJpbnNlcnRUZXh0Rm9ybWF0IiwidW5kZWZpbmVkIiwidHlwZSIsImNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZSIsImtpbmQiLCJyaWdodExhYmVsIiwiZGV0YWlsIiwiZGVzY3JpcHRpb24iLCJkb2N1bWVudGF0aW9uIiwiZGVzY3JpcHRpb25NYXJrZG93biIsInJlcGxhY2VtZW50UHJlZml4IiwiZ2V0VGV4dEluQnVmZmVyUmFuZ2UiLCJsc1JhbmdlVG9BdG9tUmFuZ2UiLCJyYW5nZSIsIm5ld1RleHQiLCJNZXRob2QiLCJGdW5jdGlvbiIsIkNvbnN0cnVjdG9yIiwiRmllbGQiLCJQcm9wZXJ0eSIsIlZhcmlhYmxlIiwiQ2xhc3MiLCJJbnRlcmZhY2UiLCJNb2R1bGUiLCJVbml0IiwiRW51bSIsIktleXdvcmQiLCJTbmlwcGV0IiwiRmlsZSIsIlJlZmVyZW5jZSJdLCJtYXBwaW5ncyI6Ijs7OztBQUVBOztBQVNBOzs7Ozs7QUFFQTtBQUNBO0FBQ2UsTUFBTUEsbUJBQU4sQ0FBMEI7QUFBQTtBQUFBLFNBS3ZDQyxnQkFMdUMsR0FLeUMsSUFBSUMsR0FBSixFQUx6QztBQUFBOztBQUN2QyxTQUFPQyxRQUFQLENBQWdCQyxrQkFBaEIsRUFBaUU7QUFDL0QsV0FBT0EsbUJBQW1CQyxrQkFBbkIsSUFBeUMsSUFBaEQ7QUFDRDs7QUFJRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQU1DLGNBQU4sQ0FDRUMsVUFERixFQUVFQyxPQUZGLEVBR0VDLDBCQUhGLEVBSStDO0FBQzdDLFVBQU1DLFFBQVEsTUFBTUgsV0FBV0ksVUFBWCxDQUFzQlgsb0JBQW9CWSxtQ0FBcEIsQ0FBd0RKLE9BQXhELENBQXRCLENBQXBCO0FBQ0EsU0FBS1AsZ0JBQUwsR0FBd0IsS0FBS1ksNEJBQUwsQ0FBa0NILEtBQWxDLEVBQXlDRixPQUF6QyxFQUFrREMsMEJBQWxELENBQXhCO0FBQ0EsV0FBT0ssTUFBTUMsSUFBTixDQUFXLEtBQUtkLGdCQUFMLENBQXNCZSxJQUF0QixFQUFYLENBQVA7QUFDRDs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBTUMsa0JBQU4sQ0FDRVYs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QUFDRixXQUFLLG1DQUFtQkMsSUFBeEI7QUFDRSxlQUFPLFFBQVA7QUFDRixXQUFLLG1DQUFtQkMsU0FBeEI7QUFDRSxlQUFPLFNBQVA7QUFDRjtBQUNFLGVBQU8sT0FBUDtBQTlCSjtBQWdDRDtBQXZMc0M7a0JBQXBCN0UsbUIiLCJmaWxlIjoiYXV0b2NvbXBsZXRlLWFkYXB0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xyXG5cclxuaW1wb3J0IHtcclxuICBDb21wbGV0aW9uSXRlbUtpbmQsXHJcbiAgTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uLFxyXG4gIHR5cGUgQ29tcGxldGlvbkl0ZW0sXHJcbiAgdHlwZSBDb21wbGV0aW9uTGlzdCxcclxuICB0eXBlIFRleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zLFxyXG4gIHR5cGUgVGV4dEVkaXQsXHJcbiAgdHlwZSBTZXJ2ZXJDYXBhYmlsaXRpZXMsXHJcbn0gZnJvbSAnLi4vbGFuZ3VhZ2VjbGllbnQnO1xyXG5pbXBvcnQgQ29udmVydCBmcm9tICcuLi9jb252ZXJ0JztcclxuXHJcbi8vIFB1YmxpYzogQWRhcHRzIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wgXCJ0ZXh0RG9jdW1lbnQvY29tcGxldGlvblwiIHRvIHRoZSBBdG9tXHJcbi8vIEF1dG9Db21wbGV0ZSsgcGFja2FnZS5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0b2NvbXBsZXRlQWRhcHRlciB7XHJcbiAgc3RhdGljIGNhbkFkYXB0KHNlcnZlckNhcGFiaWxpdGllczogU2VydmVyQ2FwYWJpbGl0aWVzKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gc2VydmVyQ2FwYWJpbGl0aWVzLmNvbXBsZXRpb25Qcm92aWRlciAhPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgX2xhc3RTdWdnZXN0aW9uczogTWFwPGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbiwgW0NvbXBsZXRpb25JdGVtLCBib29sZWFuXT4gPSBuZXcgTWFwKCk7XHJcblxyXG4gIC8vIFB1YmxpYzogT2J0YWluIHN1Z2dlc3Rpb24gbGlzdCBmb3IgQXV0b0NvbXBsZXRlKyBieSBxdWVyeWluZyB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHVzaW5nXHJcbiAgLy8gdGhlIGB0ZXh0RG9jdW1lbnQvY29tcGxldGlvbmAgcmVxdWVzdC5cclxuICAvL1xyXG4gIC8vICogYGNvbm5lY3Rpb25gIEEge0xhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbn0gdG8gdGhlIGxhbmd1YWdlIHNlcnZlciB0byBxdWVyeS5cclxuICAvLyAqIGByZXF1ZXN0YCBUaGUge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gdG8gc2F0aXNmeS5cclxuICAvLyAqIGBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbWAgQSBmdW5jdGlvbiB0aGF0IHRha2VzIGEge0NvbXBsZXRpb25JdGVtfSwgYW4ge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn1cclxuICAvLyAgIGFuZCBhIHthdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3R9IGFsbG93aW5nIHlvdSB0byBhZGp1c3QgY29udmVydGVkIGl0ZW1zLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSBvZiBhbiB7QXJyYXl9IG9mIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259cyBjb250YWluaW5nIHRoZVxyXG4gIC8vIEF1dG9Db21wbGV0ZSsgc3VnZ2VzdGlvbnMgdG8gZGlzcGxheS5cclxuICBhc3luYyBnZXRTdWdnZXN0aW9ucyhcclxuICAgIGNvbm5lY3Rpb246IExhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbixcclxuICAgIHJlcXVlc3Q6IGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCxcclxuICAgIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtPzogKENvbXBsZXRpb25JdGVtLCBhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sIGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCkgPT4gdm9pZCxcclxuICApOiBQcm9taXNlPEFycmF5PGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbj4+IHtcclxuICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgY29ubmVjdGlvbi5jb21wbGV0aW9uKEF1dG9jb21wbGV0ZUFkYXB0ZXIucmVxdWVzdFRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMocmVxdWVzdCkpO1xyXG4gICAgdGhpcy5fbGFzdFN1Z2dlc3Rpb25zID0gdGhpcy5jb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zKGl0ZW1zLCByZXF1ZXN0LCBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbSk7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9sYXN0U3VnZ2VzdGlvbnMua2V5cygpKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogT2J0YWluIGEgY29tcGxldGUgdmVyc2lvbiBvZiBhIHN1Z2dlc3Rpb24gd2l0aCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXHJcbiAgLy8gdGhlIGxhbmd1YWdlIHNlcnZlciBjYW4gcHJvdmlkZSBieSB3YXkgb2YgdGhlIGBjb21wbGV0aW9uSXRlbS9yZXNvbHZlYCByZXF1ZXN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgY29ubmVjdGlvbmAgQSB7TGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9ufSB0byB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHRvIHF1ZXJ5LlxyXG4gIC8vICogYHJlcXVlc3RgIEFuIHtPYmplY3R9IHdpdGggdGhlIEF1dG9Db21wbGV0ZSsgcmVxdWVzdCB0byBzYXRpc2Z5LlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSBvZiBhbiB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufSB3aXRoIHRoZSByZXNvbHZlZCBBdXRvQ29tcGxldGUrXHJcbiAgLy8gc3VnZ2VzdGlvbi5cclxuICBhc3luYyBjb21wbGV0ZVN1Z2dlc3Rpb24oXHJcbiAgICBjb25uZWN0aW9uOiBMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24sXHJcbiAgICBzdWdnZXN0aW9uOiBhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sXHJcbiAgICByZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QsXHJcbiAgICBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbT86IChDb21wbGV0aW9uSXRlbSwgYXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uLCBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QpID0+IHZvaWQsXHJcbiAgKTogUHJvbWlzZTxhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24+IHtcclxuICAgIGNvbnN0IG9yaWdpbmFsQ29tcGxldGlvbkl0ZW0gPSB0aGlzLl9sYXN0U3VnZ2VzdGlvbnMuZ2V0KHN1Z2dlc3Rpb24pO1xyXG4gICAgaWYgKG9yaWdpbmFsQ29tcGxldGlvbkl0ZW0gIT0gbnVsbCAmJiBvcmlnaW5hbENvbXBsZXRpb25JdGVtWzFdID09PSBmYWxzZSkge1xyXG4gICAgICBjb25zdCByZXNvbHZlQ29tcGxldGlvbkl0ZW0gPSBhd2FpdCBjb25uZWN0aW9uLmNvbXBsZXRpb25JdGVtUmVzb2x2ZShvcmlnaW5hbENvbXBsZXRpb25JdGVtWzBdKTtcclxuICAgICAgaWYgKHJlc29sdmVDb21wbGV0aW9uSXRlbSAhPSBudWxsKSB7XHJcbiAgICAgICAgQXV0b2NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihyZXNvbHZlQ29tcGxldGlvbkl0ZW0sIHN1Z2dlc3Rpb24sIHJlcXVlc3QsIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzdWdnZXN0aW9uO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDcmVhdGUgVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMgdG8gYmUgc2VudCB0byB0aGUgbGFuZ3VhZ2Ugc2VydmVyXHJcbiAgLy8gYmFzZWQgb24gdGhlIGVkaXRvciBhbmQgcG9zaXRpb24gZnJvbSB0aGUgQXV0b0NvbXBsZXRlUmVxdWVzdC5cclxuICAvL1xyXG4gIC8vICogYHJlcXVlc3RgIFRoZSB7YXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0fSB0byBzYXRpc2Z5LlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhbiB7VGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXN9IHdpdGggdGhlIGtleXM6XHJcbiAgLy8gICogYHRleHREb2N1bWVudGAgdGhlIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCB0ZXh0RG9jdW1lbnQgaWRlbnRpZmljYXRpb24uXHJcbiAgLy8gICogYHBvc2l0aW9uYCB0aGUgcG9zaXRpb24gd2l0aGluIHRoZSB0ZXh0IGRvY3VtZW50IHRvIGRpc3BsYXkgY29tcGxldGlvbiByZXF1ZXN0IGZvci5cclxuICBzdGF0aWMgcmVxdWVzdFRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMocmVxdWVzdDogYXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0KTogVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGV4dERvY3VtZW50OiBDb252ZXJ0LmVkaXRvclRvVGV4dERvY3VtZW50SWRlbnRpZmllcihyZXF1ZXN0LmVkaXRvciksXHJcbiAgICAgIHBvc2l0aW9uOiBDb252ZXJ0LnBvaW50VG9Qb3NpdGlvbihyZXF1ZXN0LmJ1ZmZlclBvc2l0aW9uKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENvbnZlcnQgYSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wgQ29tcGxldGlvbkl0ZW0gYXJyYXkgb3IgQ29tcGxldGlvbkxpc3QgdG9cclxuICAvLyBhbiBhcnJheSBvZiBvcmRlcmVkIEF1dG9Db21wbGV0ZSsgc3VnZ2VzdGlvbnMuXHJcbiAgLy9cclxuICAvLyAqIGBjb21wbGV0aW9uSXRlbXNgIEFuIHtBcnJheX0gb2Yge0NvbXBsZXRpb25JdGVtfSBvYmplY3RzIG9yIGEge0NvbXBsZXRpb25MaXN0fSBjb250YWluaW5nIGNvbXBsZXRpb25cclxuICAvLyAgICAgICAgICAgaXRlbXMgdG8gYmUgY29udmVydGVkLlxyXG4gIC8vICogYHJlcXVlc3RgIFRoZSB7YXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0fSB0byBzYXRpc2Z5LlxyXG4gIC8vICogYG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtYCBBIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSB7Q29tcGxldGlvbkl0ZW19LCBhbiB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufVxyXG4gIC8vICAgYW5kIGEge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBjb252ZXJ0ZWQgaXRlbXMuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge01hcH0gb2YgQXV0b0NvbXBsZXRlKyBzdWdnZXN0aW9ucyBvcmRlcmVkIGJ5IHRoZSBDb21wbGV0aW9uSXRlbXMgc29ydFRleHQuXHJcbiAgY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhcclxuICAgIGNvbXBsZXRpb25JdGVtczogQXJyYXk8Q29tcGxldGlvbkl0ZW0+IHwgQ29tcGxldGlvbkxpc3QsXHJcbiAgICByZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QsXHJcbiAgICBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbT86IChDb21wbGV0aW9uSXRlbSwgYXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uLCBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QpID0+IHZvaWQsXHJcbiAgKTogTWFwPGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbiwgW0NvbXBsZXRpb25JdGVtLCBib29sZWFuXT4ge1xyXG4gICAgcmV0dXJuIG5ldyBNYXAoKEFycmF5LmlzQXJyYXkoY29tcGxldGlvbkl0ZW1zKSA/IGNvbXBsZXRpb25JdGVtcyA6IGNvbXBsZXRpb25JdGVtcy5pdGVtcyB8fCBbXSlcclxuICAgICAgLnNvcnQoKGEsIGIpID0+IChhLnNvcnRUZXh0IHx8IGEubGFiZWwpLmxvY2FsZUNvbXBhcmUoYi5zb3J0VGV4dCB8fCBiLmxhYmVsKSlcclxuICAgICAgLm1hcChzID0+IFtBdXRvY29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKHMsIHsgfSwgcmVxdWVzdCwgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW0pLCBbcywgZmFsc2VdXSkpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGEgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sIENvbXBsZXRpb25JdGVtIHRvIGFuIEF1dG9Db21wbGV0ZSsgc3VnZ2VzdGlvbi5cclxuICAvL1xyXG4gIC8vICogYGl0ZW1gIEFuIHtDb21wbGV0aW9uSXRlbX0gY29udGFpbmluZyBhIGNvbXBsZXRpb24gaXRlbSB0byBiZSBjb252ZXJ0ZWQuXHJcbiAgLy8gKiBgc3VnZ2VzdGlvbmAgQSB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufSB0byBoYXZlIHRoZSBjb252ZXJzaW9uIGFwcGxpZWQgdG8uXHJcbiAgLy8gKiBgcmVxdWVzdGAgVGhlIHthdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3R9IHRvIHNhdGlzZnkuXHJcbiAgLy8gKiBgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW1gIEEgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHtDb21wbGV0aW9uSXRlbX0sIGFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259XHJcbiAgLy8gICBhbmQgYSB7YXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0fSBhbGxvd2luZyB5b3UgdG8gYWRqdXN0IGNvbnZlcnRlZCBpdGVtcy5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgdGhlIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259IHBhc3NlZCBpbiBhcyBzdWdnZXN0aW9uIHdpdGggdGhlIGNvbnZlcnNpb24gYXBwbGllZC5cclxuICBzdGF0aWMgY29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24oXHJcbiAgICBpdGVtOiBDb21wbGV0aW9uSXRlbSxcclxuICAgIHN1Z2dlc3Rpb246IGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbixcclxuICAgIHJlcXVlc3Q6IGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCxcclxuICAgIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtPzogKENvbXBsZXRpb25JdGVtLCBhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sIGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCkgPT4gdm9pZCxcclxuICApOiBhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24ge1xyXG4gICAgQXV0b2NvbXBsZXRlQWRhcHRlci5hcHBseUNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKGl0ZW0sIHN1Z2dlc3Rpb24pO1xyXG4gICAgQXV0b2NvbXBsZXRlQWRhcHRlci5hcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uKGl0ZW0udGV4dEVkaXQsIHJlcXVlc3QuZWRpdG9yLCBzdWdnZXN0aW9uKTtcclxuICAgIGlmIChvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbSAhPSBudWxsKSB7XHJcbiAgICAgIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtKGl0ZW0sIHN1Z2dlc3Rpb24sIHJlcXVlc3QpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN1Z2dlc3Rpb247XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENvbnZlcnQgdGhlIHByaW1hcnkgcGFydHMgb2YgYSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wgQ29tcGxldGlvbkl0ZW0gdG8gYW4gQXV0b0NvbXBsZXRlKyBzdWdnZXN0aW9uLlxyXG4gIC8vXHJcbiAgLy8gKiBgaXRlbWAgQW4ge0NvbXBsZXRpb25JdGVtfSBjb250YWluaW5nIHRoZSBjb21wbGV0aW9uIGl0ZW1zIHRvIGJlIG1lcmdlZCBpbnRvLlxyXG4gIC8vICogYHN1Z2dlc3Rpb25gIFRoZSB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufSB0byBtZXJnZSB0aGUgY29udmVyc2lvbiBpbnRvLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhbiB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufSBjcmVhdGVkIGZyb20gdGhlIHtDb21wbGV0aW9uSXRlbX0uXHJcbiAgc3RhdGljIGFwcGx5Q29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24oaXRlbTogQ29tcGxldGlvbkl0ZW0sIHN1Z2dlc3Rpb246IGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbikge1xyXG4gICAgc3VnZ2VzdGlvbi50ZXh0ID0gaXRlbS5pbnNlcnRUZXh0IHx8IGl0ZW0ubGFiZWw7XHJcbiAgICBzdWdnZXN0aW9uLmRpc3BsYXlUZXh0ID0gaXRlbS5sYWJlbDtcclxuICAgIHN1Z2dlc3Rpb24uc25pcHBldCA9IGl0ZW0uaW5zZXJ0VGV4dEZvcm1hdCA9PT0gMiA/IGl0ZW0uaW5zZXJ0VGV4dCA6IHVuZGVmaW5lZDtcclxuICAgIHN1Z2dlc3Rpb24udHlwZSA9IEF1dG9jb21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlKGl0ZW0ua2luZCk7XHJcbiAgICBzdWdnZXN0aW9uLnJpZ2h0TGFiZWwgPSBpdGVtLmRldGFpbDtcclxuICAgIHN1Z2dlc3Rpb24uZGVzY3JpcHRpb24gPSBpdGVtLmRvY3VtZW50YXRpb247XHJcbiAgICBzdWdnZXN0aW9uLmRlc2NyaXB0aW9uTWFya2Rvd24gPSBpdGVtLmRvY3VtZW50YXRpb247XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEFwcGxpZXMgdGhlIHRleHRFZGl0IHBhcnQgb2YgYSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wgQ29tcGxldGlvbkl0ZW0gdG8gYW5cclxuICAvLyBBdXRvQ29tcGxldGUrIFN1Z2dlc3Rpb24gdmlhIHRoZSByZXBsYWNlbWVudFByZWZpeCBhbmQgdGV4dCBwcm9wZXJ0aWVzLlxyXG4gIC8vXHJcbiAgLy8gKiBgdGV4dEVkaXRgIEEge1RleHRFZGl0fSBmcm9tIGEgQ29tcGxldGlvbkl0ZW0gdG8gYXBwbHkuXHJcbiAgLy8gKiBgZWRpdG9yYCBBbiBBdG9tIHtUZXh0RWRpdG9yfSB1c2VkIHRvIG9idGFpbiB0aGUgbmVjZXNzYXJ5IHRleHQgcmVwbGFjZW1lbnQuXHJcbiAgLy8gKiBgc3VnZ2VzdGlvbmAgQW4ge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gdG8gc2V0IHRoZSByZXBsYWNlbWVudFByZWZpeCBhbmQgdGV4dCBwcm9wZXJ0aWVzIG9mLlxyXG4gIHN0YXRpYyBhcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uKFxyXG4gICAgdGV4dEVkaXQ6ID9UZXh0RWRpdCxcclxuICAgIGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLFxyXG4gICAgc3VnZ2VzdGlvbjogYXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uLFxyXG4gICk6IHZvaWQge1xyXG4gICAgaWYgKHRleHRFZGl0ICE9IG51bGwpIHtcclxuICAgICAgc3VnZ2VzdGlvbi5yZXBsYWNlbWVudFByZWZpeCA9IGVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZShDb252ZXJ0LmxzUmFuZ2VUb0F0b21SYW5nZSh0ZXh0RWRpdC5yYW5nZSkpO1xyXG4gICAgICBzdWdnZXN0aW9uLnRleHQgPSB0ZXh0RWRpdC5uZXdUZXh0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBPYnRhaW4gdGhlIHRleHR1YWwgc3VnZ2VzdGlvbiB0eXBlIHJlcXVpcmVkIGJ5IEF1dG9Db21wbGV0ZSsgdGhhdFxyXG4gIC8vIG1vc3QgY2xvc2VseSBtYXBzIHRvIHRoZSBudW1lcmljIGNvbXBsZXRpb24ga2luZCBzdXBwbGllcyBieSB0aGUgbGFuZ3VhZ2Ugc2VydmVyLlxyXG4gIC8vXHJcbiAgLy8gKiBga2luZGAgQSB7TnVtYmVyfSB0aGF0IHJlcHJlc2VudHMgdGhlIHN1Z2dlc3Rpb24ga2luZCB0byBiZSBjb252ZXJ0ZWQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge1N0cmluZ30gY29udGFpbmluZyB0aGUgQXV0b0NvbXBsZXRlKyBzdWdnZXN0aW9uIHR5cGUgZXF1aXZhbGVudFxyXG4gIC8vIHRvIHRoZSBnaXZlbiBjb21wbGV0aW9uIGtpbmQuXHJcbiAgc3RhdGljIGNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShraW5kOiA/bnVtYmVyKTogc3RyaW5nIHtcclxuICAgIHN3aXRjaCAoa2luZCkge1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5NZXRob2Q6XHJcbiAgICAgICAgcmV0dXJuICdtZXRob2QnO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5GdW5jdGlvbjpcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuQ29uc3RydWN0b3I6XHJcbiAgICAgICAgcmV0dXJuICdmdW5jdGlvbic7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkZpZWxkOlxyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5Qcm9wZXJ0eTpcclxuICAgICAgICByZXR1cm4gJ3Byb3BlcnR5JztcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGU6XHJcbiAgICAgICAgcmV0dXJuICd2YXJpYWJsZSc7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkNsYXNzOlxyXG4gICAgICAgIHJldHVybiAnY2xhc3MnO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5JbnRlcmZhY2U6XHJcbiAgICAgICAgcmV0dXJuICdpbnRlcmZhY2UnO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5Nb2R1bGU6XHJcbiAgICAgICAgcmV0dXJuICdtb2R1bGUnO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5Vbml0OlxyXG4gICAgICAgIHJldHVybiAnYnVpbHRpbic7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkVudW06XHJcbiAgICAgICAgcmV0dXJuICdlbnVtJztcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuS2V5d29yZDpcclxuICAgICAgICByZXR1cm4gJ2tleXdvcmQnO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5TbmlwcGV0OlxyXG4gICAgICAgIHJldHVybiAnc25pcHBldCc7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkZpbGU6XHJcbiAgICAgICAgcmV0dXJuICdpbXBvcnQnO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5SZWZlcmVuY2U6XHJcbiAgICAgICAgcmV0dXJuICdyZXF1aXJlJztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICByZXR1cm4gJ3ZhbHVlJztcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
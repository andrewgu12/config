"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const languageclient_1 = require("../languageclient");
const atom_1 = require("atom");
const convert_1 = require("../convert");
const fuzzaldrin_plus_1 = require("fuzzaldrin-plus");
const utils_1 = require("../utils");
// Public: Adapts the language server protocol "textDocument/completion" to the Atom
// AutoComplete+ package.
class AutocompleteAdapter {
    constructor() {
        this._suggestionCache = new WeakMap();
        this._cancellationTokens = new WeakMap();
    }
    static canAdapt(serverCapabilities) {
        return serverCapabilities.completionProvider != null;
    }
    static canResolve(serverCapabilities) {
        return serverCapabilities.completionProvider != null &&
            serverCapabilities.completionProvider.resolveProvider === true;
    }
    // Public: Obtain suggestion list for AutoComplete+ by querying the language server using
    // the `textDocument/completion` request.
    //
    // * `server` An {ActiveServer} pointing to the language server to query.
    // * `request` The {atom$AutocompleteRequest} to satisfy.
    // * `onDidConvertCompletionItem` An optional function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
    //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
    //
    // Returns a {Promise} of an {Array} of {atom$AutocompleteSuggestion}s containing the
    // AutoComplete+ suggestions to display.
    getSuggestions(server, request, onDidConvertCompletionItem, minimumWordLength) {
        return __awaiter(this, void 0, void 0, function* () {
            const triggerChars = server.capabilities.completionProvider != null ?
                server.capabilities.completionProvider.triggerCharacters || [] : [];
            const triggerChar = AutocompleteAdapter.getTriggerCharacter(request, triggerChars);
            const prefixWithTrigger = triggerChar + request.prefix;
            const triggerColumn = request.bufferPosition.column - prefixWithTrigger.length;
            const triggerPoint = new atom_1.Point(request.bufferPosition.row, triggerColumn);
            // Only auto-trigger on a trigger character or after the minimum number of characters from autocomplete-plus
            minimumWordLength = minimumWordLength || 0;
            if (!request.activatedManually && triggerChar === '' &&
                minimumWordLength > 0 && request.prefix.length < minimumWordLength) {
                return [];
            }
            const cache = this._suggestionCache.get(server);
            let suggestionMap = null;
            // Do we have complete cached suggestions that are still valid for this request
            if (cache && !cache.isIncomplete && cache.triggerChar === triggerChar && cache.triggerPoint.isEqual(triggerPoint)) {
                suggestionMap = cache.suggestionMap;
            }
            else {
                // Our cached suggestions can't be used so obtain new ones from the language server
                const completions = yield utils_1.default.doWithCancellationToken(server.connection, this._cancellationTokens, (cancellationToken) => server.connection.completion(AutocompleteAdapter.createCompletionParams(request, triggerChar), cancellationToken));
                const isIncomplete = !Array.isArray(completions) && completions.isIncomplete;
                suggestionMap = this.completionItemsToSuggestions(completions, request, onDidConvertCompletionItem);
                this._suggestionCache.set(server, { isIncomplete, triggerChar, triggerPoint, suggestionMap });
            }
            // Filter the results to recalculate the score and ordering (unless only triggerChar)
            const suggestions = Array.from(suggestionMap.keys());
            const replacementPrefix = request.prefix != triggerChar ? request.prefix : '';
            AutocompleteAdapter.setReplacementPrefixOnSuggestions(suggestions, replacementPrefix);
            return request.prefix === triggerChar ? suggestions : fuzzaldrin_plus_1.filter(suggestions, request.prefix, { key: 'text' });
        });
    }
    // Public: Obtain a complete version of a suggestion with additional information
    // the language server can provide by way of the `completionItem/resolve` request.
    //
    // * `server` An {ActiveServer} pointing to the language server to query.
    // * `suggestion` An {atom$AutocompleteSuggestion} suggestion that should be resolved.
    // * `request` An {Object} with the AutoComplete+ request to satisfy.
    // * `onDidConvertCompletionItem` An optional function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
    //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
    //
    // Returns a {Promise} of an {atom$AutocompleteSuggestion} with the resolved AutoComplete+ suggestion.
    completeSuggestion(server, suggestion, request, onDidConvertCompletionItem) {
        return __awaiter(this, void 0, void 0, function* () {
            const cache = this._suggestionCache.get(server);
            if (cache) {
                const originalCompletionItem = cache.suggestionMap.get(suggestion);
                if (originalCompletionItem != null && originalCompletionItem[1] === false) {
                    const resolvedCompletionItem = yield server.connection.completionItemResolve(originalCompletionItem[0]);
                    if (resolvedCompletionItem != null) {
                        AutocompleteAdapter.completionItemToSuggestion(resolvedCompletionItem, suggestion, request, onDidConvertCompletionItem);
                        originalCompletionItem[1] = true;
                    }
                }
            }
            return suggestion;
        });
    }
    // Public: Set the replacementPrefix property on all given suggestions to the
    // prefix specified.
    //
    // * `suggestions` An {Array} of {atom$AutocompleteSuggestion}s to set the replacementPrefix on.
    // * `prefix` The {string} containing the prefix that should be set as replacementPrefix on all suggestions.
    static setReplacementPrefixOnSuggestions(suggestions, prefix) {
        for (const suggestion of suggestions) {
            suggestion.replacementPrefix = prefix;
        }
    }
    // Public: Get the trigger character that caused the autocomplete (if any).  This is required because
    // AutoComplete-plus does not have trigger characters.  Although the terminology is 'character' we treat
    // them as variable length strings as this will almost certainly change in the future to support '->' etc.
    //
    // * `request` An {Array} of {atom$AutocompleteSuggestion}s to locate the prefix, editor, bufferPosition etc.
    // * `triggerChars` The {Array} of {string}s that can be trigger characters.
    //
    // Returns a {string} containing the matching trigger character or an empty string if one was not matched.
    static getTriggerCharacter(request, triggerChars) {
        // AutoComplete-Plus considers text after a symbol to be a new trigger. So we should look backward
        // from the current cursor position to see if one is there and thus simulate it.
        const buffer = request.editor.getBuffer();
        const cursor = request.bufferPosition;
        const prefixStartColumn = cursor.column - request.prefix.length;
        for (const triggerChar of triggerChars) {
            if (triggerChar === request.prefix) {
                return triggerChar;
            }
            if (prefixStartColumn >= triggerChar.length) {
                const start = new atom_1.Point(cursor.row, prefixStartColumn - triggerChar.length);
                const possibleTrigger = buffer.getTextInRange([start, [cursor.row, prefixStartColumn]]);
                if (possibleTrigger === triggerChar) {
                    return triggerChar;
                }
            }
        }
        // There was no explicit trigger char
        return '';
    }
    // Public: Create TextDocumentPositionParams to be sent to the language server
    // based on the editor and position from the AutoCompleteRequest.
    //
    // * `request` The {atom$AutocompleteRequest} to obtain the editor from.
    // * `triggerPoint` The {atom$Point} where the trigger started.
    //
    // Returns a {string} containing the prefix including the trigger character.
    static getPrefixWithTrigger(request, triggerPoint) {
        return request.editor
            .getBuffer()
            .getTextInRange([[triggerPoint.row, triggerPoint.column], request.bufferPosition]);
    }
    // Public: Create {CompletionParams} to be sent to the language server
    // based on the editor and position from the Autocomplete request etc.
    //
    // * `request` The {atom$AutocompleteRequest} containing the request details.
    // * `triggerCharacter` The {string} containing the trigger character (empty if none).
    //
    // Returns an {CompletionParams} with the keys:
    //  * `textDocument` the language server protocol textDocument identification.
    //  * `position` the position within the text document to display completion request for.
    //  * `context` containing the trigger character and kind.
    static createCompletionParams(request, triggerCharacter) {
        return {
            textDocument: convert_1.default.editorToTextDocumentIdentifier(request.editor),
            position: convert_1.default.pointToPosition(request.bufferPosition),
            context: AutocompleteAdapter.createCompletionContext(triggerCharacter),
        };
    }
    // Public: Create {CompletionContext} to be sent to the language server
    // based on the trigger character.
    //
    // * `triggerCharacter` The {string} containing the trigger character or '' if none.
    //
    // Returns an {CompletionContext} that specifies the triggerKind and the triggerCharacter
    // if there is one.
    static createCompletionContext(triggerCharacter) {
        return triggerCharacter === ''
            ? { triggerKind: languageclient_1.CompletionTriggerKind.Invoked }
            : { triggerKind: languageclient_1.CompletionTriggerKind.TriggerCharacter, triggerCharacter };
    }
    // Public: Convert a language server protocol CompletionItem array or CompletionList to
    // an array of ordered AutoComplete+ suggestions.
    //
    // * `completionItems` An {Array} of {CompletionItem} objects or a {CompletionList} containing completion
    //           items to be converted.
    // * `request` The {atom$AutocompleteRequest} to satisfy.
    // * `onDidConvertCompletionItem` A function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
    //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
    //
    // Returns a {Map} of AutoComplete+ suggestions ordered by the CompletionItems sortText.
    completionItemsToSuggestions(completionItems, request, onDidConvertCompletionItem) {
        return new Map((Array.isArray(completionItems) ? completionItems : completionItems.items || [])
            .sort((a, b) => (a.sortText || a.label).localeCompare(b.sortText || b.label))
            .map((s) => [
            AutocompleteAdapter.completionItemToSuggestion(s, {}, request, onDidConvertCompletionItem),
            [s, false]
        ]));
    }
    // Public: Convert a language server protocol CompletionItem to an AutoComplete+ suggestion.
    //
    // * `item` An {CompletionItem} containing a completion item to be converted.
    // * `suggestion` A {atom$AutocompleteSuggestion} to have the conversion applied to.
    // * `request` The {atom$AutocompleteRequest} to satisfy.
    // * `onDidConvertCompletionItem` A function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
    //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
    //
    // Returns the {atom$AutocompleteSuggestion} passed in as suggestion with the conversion applied.
    static completionItemToSuggestion(item, suggestion, request, onDidConvertCompletionItem) {
        AutocompleteAdapter.applyCompletionItemToSuggestion(item, suggestion);
        AutocompleteAdapter.applyTextEditToSuggestion(item.textEdit, request.editor, suggestion);
        AutocompleteAdapter.applySnippetToSuggestion(item, suggestion);
        if (onDidConvertCompletionItem != null) {
            onDidConvertCompletionItem(item, suggestion, request);
        }
        return suggestion;
    }
    // Public: Convert the primary parts of a language server protocol CompletionItem to an AutoComplete+ suggestion.
    //
    // * `item` An {CompletionItem} containing the completion items to be merged into.
    // * `suggestion` The {atom$AutocompleteSuggestion} to merge the conversion into.
    //
    // Returns an {atom$AutocompleteSuggestion} created from the {CompletionItem}.
    static applyCompletionItemToSuggestion(item, suggestion) {
        suggestion.text = item.insertText || item.label;
        suggestion.displayText = item.label;
        suggestion.type = AutocompleteAdapter.completionKindToSuggestionType(item.kind);
        suggestion.rightLabel = item.detail;
        if (typeof item.documentation === 'object') {
            suggestion.descriptionMarkdown = item.documentation.value;
            suggestion.description = item.documentation.value;
        }
        else {
            suggestion.descriptionMarkdown = item.documentation;
            suggestion.description = item.documentation;
        }
    }
    // Public: Applies the textEdit part of a language server protocol CompletionItem to an
    // AutoComplete+ Suggestion via the replacementPrefix and text properties.
    //
    // * `textEdit` A {TextEdit} from a CompletionItem to apply.
    // * `editor` An Atom {TextEditor} used to obtain the necessary text replacement.
    // * `suggestion` An {atom$AutocompleteSuggestion} to set the replacementPrefix and text properties of.
    static applyTextEditToSuggestion(textEdit, editor, suggestion) {
        if (textEdit) {
            suggestion.replacementPrefix = editor.getTextInBufferRange(convert_1.default.lsRangeToAtomRange(textEdit.range));
            suggestion.text = textEdit.newText;
        }
    }
    // Public: Adds a snippet to the suggestion if the CompletionItem contains
    // snippet-formatted text
    //
    // * `item` An {CompletionItem} containing the completion items to be merged into.
    // * `suggestion` The {atom$AutocompleteSuggestion} to merge the conversion into.
    //
    static applySnippetToSuggestion(item, suggestion) {
        if (item.insertTextFormat === languageclient_1.InsertTextFormat.Snippet) {
            suggestion.snippet = item.textEdit != null ? item.textEdit.newText : item.insertText;
        }
    }
    // Public: Obtain the textual suggestion type required by AutoComplete+ that
    // most closely maps to the numeric completion kind supplies by the language server.
    //
    // * `kind` A {Number} that represents the suggestion kind to be converted.
    //
    // Returns a {String} containing the AutoComplete+ suggestion type equivalent
    // to the given completion kind.
    static completionKindToSuggestionType(kind) {
        switch (kind) {
            case languageclient_1.CompletionItemKind.Constant:
                return 'constant';
            case languageclient_1.CompletionItemKind.Method:
                return 'method';
            case languageclient_1.CompletionItemKind.Function:
            case languageclient_1.CompletionItemKind.Constructor:
                return 'function';
            case languageclient_1.CompletionItemKind.Field:
            case languageclient_1.CompletionItemKind.Property:
                return 'property';
            case languageclient_1.CompletionItemKind.Variable:
                return 'variable';
            case languageclient_1.CompletionItemKind.Class:
                return 'class';
            case languageclient_1.CompletionItemKind.Struct:
            case languageclient_1.CompletionItemKind.TypeParameter:
                return 'type';
            case languageclient_1.CompletionItemKind.Operator:
                return 'selector';
            case languageclient_1.CompletionItemKind.Interface:
                return 'mixin';
            case languageclient_1.CompletionItemKind.Module:
                return 'module';
            case languageclient_1.CompletionItemKind.Unit:
                return 'builtin';
            case languageclient_1.CompletionItemKind.Enum:
            case languageclient_1.CompletionItemKind.EnumMember:
                return 'enum';
            case languageclient_1.CompletionItemKind.Keyword:
                return 'keyword';
            case languageclient_1.CompletionItemKind.Snippet:
                return 'snippet';
            case languageclient_1.CompletionItemKind.File:
            case languageclient_1.CompletionItemKind.Folder:
                return 'import';
            case languageclient_1.CompletionItemKind.Reference:
                return 'require';
            default:
                return 'value';
        }
    }
}
exports.default = AutocompleteAdapter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLWFkYXB0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLHNEQVcyQjtBQUMzQiwrQkFLYztBQUdkLHdDQUFpQztBQUNqQyxxREFBeUM7QUFDekMsb0NBQTZCO0FBUzdCLG9GQUFvRjtBQUNwRix5QkFBeUI7QUFDekI7SUFBQTtRQVVVLHFCQUFnQixHQUFnRCxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzlFLHdCQUFtQixHQUErRCxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBNFUxRyxDQUFDO0lBdFZRLE1BQU0sQ0FBQyxRQUFRLENBQUMsa0JBQXNDO1FBQzNELE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxrQkFBa0IsSUFBSSxJQUFJLENBQUM7SUFDdkQsQ0FBQztJQUVNLE1BQU0sQ0FBQyxVQUFVLENBQUMsa0JBQXNDO1FBQzdELE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxrQkFBa0IsSUFBSSxJQUFJO1lBQ2xELGtCQUFrQixDQUFDLGtCQUFrQixDQUFDLGVBQWUsS0FBSyxJQUFJLENBQUM7SUFDbkUsQ0FBQztJQUtELHlGQUF5RjtJQUN6Rix5Q0FBeUM7SUFDekMsRUFBRTtJQUNGLHlFQUF5RTtJQUN6RSx5REFBeUQ7SUFDekQsc0hBQXNIO0lBQ3RILDZFQUE2RTtJQUM3RSxFQUFFO0lBQ0YscUZBQXFGO0lBQ3JGLHdDQUF3QztJQUMzQixjQUFjLENBQ3pCLE1BQW9CLEVBQ3BCLE9BQTRCLEVBQzVCLDBCQUNtRSxFQUNuRSxpQkFBMEI7O1lBRTFCLE1BQU0sWUFBWSxHQUNoQixNQUFNLENBQUMsWUFBWSxDQUFDLGtCQUFrQixJQUFJLElBQUksQ0FBQyxDQUFDO2dCQUM5QyxNQUFNLENBQUMsWUFBWSxDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3hFLE1BQU0sV0FBVyxHQUFHLG1CQUFtQixDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQztZQUNuRixNQUFNLGlCQUFpQixHQUFHLFdBQVcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO1lBQ3ZELE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsTUFBTSxHQUFHLGlCQUFpQixDQUFDLE1BQU0sQ0FBQztZQUMvRSxNQUFNLFlBQVksR0FBRyxJQUFJLFlBQUssQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUUxRSw0R0FBNEc7WUFDNUcsaUJBQWlCLEdBQUcsaUJBQWlCLElBQUksQ0FBQyxDQUFDO1lBQzNDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGlCQUFpQixJQUFJLFdBQVcsS0FBSyxFQUFFO2dCQUNoRCxpQkFBaUIsR0FBRyxDQUFDLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO2dCQUN2RSxNQUFNLENBQUMsRUFBRSxDQUFDO1lBQ1osQ0FBQztZQUVELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDaEQsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDO1lBRXpCLCtFQUErRTtZQUMvRSxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxJQUFJLEtBQUssQ0FBQyxXQUFXLEtBQUssV0FBVyxJQUFJLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEgsYUFBYSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUM7WUFDdEMsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLG1GQUFtRjtnQkFDbkYsTUFBTSxXQUFXLEdBQ2YsTUFBTSxlQUFLLENBQUMsdUJBQXVCLENBQ2pDLE1BQU0sQ0FBQyxVQUFVLEVBQ2pCLElBQUksQ0FBQyxtQkFBbUIsRUFDeEIsQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLENBQ3BCLE1BQU0sQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUMxQixtQkFBbUIsQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLEVBQUUsaUJBQWlCLENBQUMsQ0FDM0YsQ0FBQztnQkFDRixNQUFNLFlBQVksR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksV0FBVyxDQUFDLFlBQVksQ0FBQztnQkFDN0UsYUFBYSxHQUFHLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxXQUFXLEVBQUUsT0FBTyxFQUFFLDBCQUEwQixDQUFDLENBQUM7Z0JBQ3BHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLEVBQUMsWUFBWSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFDLENBQUMsQ0FBQztZQUM5RixDQUFDO1lBRUQscUZBQXFGO1lBQ3JGLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7WUFDckQsTUFBTSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsTUFBTSxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQzlFLG1CQUFtQixDQUFDLGlDQUFpQyxDQUFDLFdBQVcsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1lBQ3RGLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyx3QkFBTSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUMsR0FBRyxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDM0csQ0FBQztLQUFBO0lBRUQsZ0ZBQWdGO0lBQ2hGLGtGQUFrRjtJQUNsRixFQUFFO0lBQ0YseUVBQXlFO0lBQ3pFLHNGQUFzRjtJQUN0RixxRUFBcUU7SUFDckUsc0hBQXNIO0lBQ3RILDZFQUE2RTtJQUM3RSxFQUFFO0lBQ0Ysc0dBQXNHO0lBQ3pGLGtCQUFrQixDQUM3QixNQUFvQixFQUNwQixVQUFrQyxFQUNsQyxPQUE0QixFQUM1QiwwQkFDbUU7O1lBRW5FLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDaEQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDVixNQUFNLHNCQUFzQixHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUNuRSxFQUFFLENBQUMsQ0FBQyxzQkFBc0IsSUFBSSxJQUFJLElBQUksc0JBQXNCLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztvQkFDMUUsTUFBTSxzQkFBc0IsR0FBRyxNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDeEcsRUFBRSxDQUFDLENBQUMsc0JBQXNCLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQzt3QkFDbkMsbUJBQW1CLENBQUMsMEJBQTBCLENBQzVDLHNCQUFzQixFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsMEJBQTBCLENBQUMsQ0FBQzt3QkFDM0Usc0JBQXNCLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUNuQyxDQUFDO2dCQUNILENBQUM7WUFDSCxDQUFDO1lBQ0QsTUFBTSxDQUFDLFVBQVUsQ0FBQztRQUNwQixDQUFDO0tBQUE7SUFFRCw2RUFBNkU7SUFDN0Usb0JBQW9CO0lBQ3BCLEVBQUU7SUFDRixnR0FBZ0c7SUFDaEcsNEdBQTRHO0lBQ3JHLE1BQU0sQ0FBQyxpQ0FBaUMsQ0FBQyxXQUFxQyxFQUFFLE1BQWM7UUFDbkcsR0FBRyxDQUFDLENBQUMsTUFBTSxVQUFVLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNyQyxVQUFVLENBQUMsaUJBQWlCLEdBQUcsTUFBTSxDQUFDO1FBQ3hDLENBQUM7SUFDSCxDQUFDO0lBRUQscUdBQXFHO0lBQ3JHLHdHQUF3RztJQUN4RywwR0FBMEc7SUFDMUcsRUFBRTtJQUNGLDZHQUE2RztJQUM3Ryw0RUFBNEU7SUFDNUUsRUFBRTtJQUNGLDBHQUEwRztJQUNuRyxNQUFNLENBQUMsbUJBQW1CLENBQUMsT0FBNEIsRUFBRSxZQUFzQjtRQUNwRixrR0FBa0c7UUFDbEcsZ0ZBQWdGO1FBQ2hGLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDMUMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQztRQUN0QyxNQUFNLGlCQUFpQixHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDaEUsR0FBRyxDQUFDLENBQUMsTUFBTSxXQUFXLElBQUksWUFBWSxDQUFDLENBQUMsQ0FBQztZQUN2QyxFQUFFLENBQUMsQ0FBQyxXQUFXLEtBQUssT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQ25DLE1BQU0sQ0FBQyxXQUFXLENBQUM7WUFDckIsQ0FBQztZQUNELEVBQUUsQ0FBQyxDQUFDLGlCQUFpQixJQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUM1QyxNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLGlCQUFpQixHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDNUUsTUFBTSxlQUFlLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hGLEVBQUUsQ0FBQyxDQUFDLGVBQWUsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO29CQUNwQyxNQUFNLENBQUMsV0FBVyxDQUFDO2dCQUNyQixDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUM7UUFFRCxxQ0FBcUM7UUFDckMsTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFRCw4RUFBOEU7SUFDOUUsaUVBQWlFO0lBQ2pFLEVBQUU7SUFDRix3RUFBd0U7SUFDeEUsK0RBQStEO0lBQy9ELEVBQUU7SUFDRiw0RUFBNEU7SUFDckUsTUFBTSxDQUFDLG9CQUFvQixDQUFDLE9BQTRCLEVBQUUsWUFBbUI7UUFDbEYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNO2FBQ2xCLFNBQVMsRUFBRTthQUNYLGNBQWMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxZQUFZLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7SUFDdkYsQ0FBQztJQUVELHNFQUFzRTtJQUN0RSxzRUFBc0U7SUFDdEUsRUFBRTtJQUNGLDZFQUE2RTtJQUM3RSxzRkFBc0Y7SUFDdEYsRUFBRTtJQUNGLCtDQUErQztJQUMvQyw4RUFBOEU7SUFDOUUseUZBQXlGO0lBQ3pGLDBEQUEwRDtJQUNuRCxNQUFNLENBQUMsc0JBQXNCLENBQ2xDLE9BQTRCLEVBQUUsZ0JBQXdCO1FBQ3RELE1BQU0sQ0FBQztZQUNMLFlBQVksRUFBRSxpQkFBTyxDQUFDLDhCQUE4QixDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7WUFDcEUsUUFBUSxFQUFFLGlCQUFPLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUM7WUFDekQsT0FBTyxFQUFFLG1CQUFtQixDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixDQUFDO1NBQ3ZFLENBQUM7SUFDSixDQUFDO0lBRUQsdUVBQXVFO0lBQ3ZFLGtDQUFrQztJQUNsQyxFQUFFO0lBQ0Ysb0ZBQW9GO0lBQ3BGLEVBQUU7SUFDRix5RkFBeUY7SUFDekYsbUJBQW1CO0lBQ1osTUFBTSxDQUFDLHVCQUF1QixDQUFDLGdCQUF3QjtRQUM1RCxNQUFNLENBQUMsZ0JBQWdCLEtBQUssRUFBRTtZQUM1QixDQUFDLENBQUMsRUFBQyxXQUFXLEVBQUUsc0NBQXFCLENBQUMsT0FBTyxFQUFDO1lBQzlDLENBQUMsQ0FBQyxFQUFDLFdBQVcsRUFBRSxzQ0FBcUIsQ0FBQyxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBQyxDQUFDO0lBQzlFLENBQUM7SUFFRCx1RkFBdUY7SUFDdkYsaURBQWlEO0lBQ2pELEVBQUU7SUFDRix5R0FBeUc7SUFDekcsbUNBQW1DO0lBQ25DLHlEQUF5RDtJQUN6RCw0R0FBNEc7SUFDNUcsNkVBQTZFO0lBQzdFLEVBQUU7SUFDRix3RkFBd0Y7SUFDakYsNEJBQTRCLENBQ2pDLGVBQWtELEVBQ2xELE9BQTRCLEVBQzVCLDBCQUNtRTtRQUVuRSxNQUFNLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO2FBQzVGLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQzVFLEdBQUcsQ0FDRixDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDTCxtQkFBbUIsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDLEVBQUUsRUFBRyxFQUFFLE9BQU8sRUFBRSwwQkFBMEIsQ0FBQztZQUMzRixDQUFDLENBQUMsRUFBRSxLQUFLLENBQUM7U0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBRUQsNEZBQTRGO0lBQzVGLEVBQUU7SUFDRiw2RUFBNkU7SUFDN0Usb0ZBQW9GO0lBQ3BGLHlEQUF5RDtJQUN6RCw0R0FBNEc7SUFDNUcsNkVBQTZFO0lBQzdFLEVBQUU7SUFDRixpR0FBaUc7SUFDMUYsTUFBTSxDQUFDLDBCQUEwQixDQUN0QyxJQUFvQixFQUNwQixVQUFrQyxFQUNsQyxPQUE0QixFQUM1QiwwQkFDbUU7UUFFbkUsbUJBQW1CLENBQUMsK0JBQStCLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ3RFLG1CQUFtQixDQUFDLHlCQUF5QixDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztRQUN6RixtQkFBbUIsQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDL0QsRUFBRSxDQUFDLENBQUMsMEJBQTBCLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUN2QywwQkFBMEIsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3hELENBQUM7UUFFRCxNQUFNLENBQUMsVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxpSEFBaUg7SUFDakgsRUFBRTtJQUNGLGtGQUFrRjtJQUNsRixpRkFBaUY7SUFDakYsRUFBRTtJQUNGLDhFQUE4RTtJQUN2RSxNQUFNLENBQUMsK0JBQStCLENBQUMsSUFBb0IsRUFBRSxVQUFrQztRQUNwRyxVQUFVLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNoRCxVQUFVLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDcEMsVUFBVSxDQUFDLElBQUksR0FBRyxtQkFBbUIsQ0FBQyw4QkFBOEIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEYsVUFBVSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBRXBDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDLGFBQWEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQzNDLFVBQVUsQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQztZQUMxRCxVQUFVLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDO1FBQ3BELENBQUM7UUFDRCxJQUFJLENBQUMsQ0FBQztZQUNKLFVBQVUsQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO1lBQ3BELFVBQVUsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztRQUM5QyxDQUFDO0lBQ0gsQ0FBQztJQUVELHVGQUF1RjtJQUN2RiwwRUFBMEU7SUFDMUUsRUFBRTtJQUNGLDREQUE0RDtJQUM1RCxpRkFBaUY7SUFDakYsdUdBQXVHO0lBQ2hHLE1BQU0sQ0FBQyx5QkFBeUIsQ0FDckMsUUFBOEIsRUFDOUIsTUFBa0IsRUFDbEIsVUFBa0M7UUFFbEMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNiLFVBQVUsQ0FBQyxpQkFBaUIsR0FBRyxNQUFNLENBQUMsb0JBQW9CLENBQUMsaUJBQU8sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUN2RyxVQUFVLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUM7UUFDckMsQ0FBQztJQUNILENBQUM7SUFFRCwwRUFBMEU7SUFDMUUseUJBQXlCO0lBQ3pCLEVBQUU7SUFDRixrRkFBa0Y7SUFDbEYsaUZBQWlGO0lBQ2pGLEVBQUU7SUFDSyxNQUFNLENBQUMsd0JBQXdCLENBQUMsSUFBb0IsRUFBRSxVQUFrQztRQUM3RixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEtBQUssaUNBQWdCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUN2RCxVQUFVLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUN2RixDQUFDO0lBQ0gsQ0FBQztJQUVELDRFQUE0RTtJQUM1RSxvRkFBb0Y7SUFDcEYsRUFBRTtJQUNGLDJFQUEyRTtJQUMzRSxFQUFFO0lBQ0YsNkVBQTZFO0lBQzdFLGdDQUFnQztJQUN6QixNQUFNLENBQUMsOEJBQThCLENBQUMsSUFBd0I7UUFDbkUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNiLEtBQUssbUNBQWtCLENBQUMsUUFBUTtnQkFDOUIsTUFBTSxDQUFDLFVBQVUsQ0FBQztZQUNwQixLQUFLLG1DQUFrQixDQUFDLE1BQU07Z0JBQzVCLE1BQU0sQ0FBQyxRQUFRLENBQUM7WUFDbEIsS0FBSyxtQ0FBa0IsQ0FBQyxRQUFRLENBQUM7WUFDakMsS0FBSyxtQ0FBa0IsQ0FBQyxXQUFXO2dCQUNqQyxNQUFNLENBQUMsVUFBVSxDQUFDO1lBQ3BCLEtBQUssbUNBQWtCLENBQUMsS0FBSyxDQUFDO1lBQzlCLEtBQUssbUNBQWtCLENBQUMsUUFBUTtnQkFDOUIsTUFBTSxDQUFDLFVBQVUsQ0FBQztZQUNwQixLQUFLLG1DQUFrQixDQUFDLFFBQVE7Z0JBQzlCLE1BQU0sQ0FBQyxVQUFVLENBQUM7WUFDcEIsS0FBSyxtQ0FBa0IsQ0FBQyxLQUFLO2dCQUMzQixNQUFNLENBQUMsT0FBTyxDQUFDO1lBQ2pCLEtBQUssbUNBQWtCLENBQUMsTUFBTSxDQUFDO1lBQy9CLEtBQUssbUNBQWtCLENBQUMsYUFBYTtnQkFDbkMsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUNoQixLQUFLLG1DQUFrQixDQUFDLFFBQVE7Z0JBQzlCLE1BQU0sQ0FBQyxVQUFVLENBQUM7WUFDcEIsS0FBSyxtQ0FBa0IsQ0FBQyxTQUFTO2dCQUMvQixNQUFNLENBQUMsT0FBTyxDQUFDO1lBQ2pCLEtBQUssbUNBQWtCLENBQUMsTUFBTTtnQkFDNUIsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUNsQixLQUFLLG1DQUFrQixDQUFDLElBQUk7Z0JBQzFCLE1BQU0sQ0FBQyxTQUFTLENBQUM7WUFDbkIsS0FBSyxtQ0FBa0IsQ0FBQyxJQUFJLENBQUM7WUFDN0IsS0FBSyxtQ0FBa0IsQ0FBQyxVQUFVO2dCQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQ2hCLEtBQUssbUNBQWtCLENBQUMsT0FBTztnQkFDN0IsTUFBTSxDQUFDLFNBQVMsQ0FBQztZQUNuQixLQUFLLG1DQUFrQixDQUFDLE9BQU87Z0JBQzdCLE1BQU0sQ0FBQyxTQUFTLENBQUM7WUFDbkIsS0FBSyxtQ0FBa0IsQ0FBQyxJQUFJLENBQUM7WUFDN0IsS0FBSyxtQ0FBa0IsQ0FBQyxNQUFNO2dCQUM1QixNQUFNLENBQUMsUUFBUSxDQUFDO1lBQ2xCLEtBQUssbUNBQWtCLENBQUMsU0FBUztnQkFDL0IsTUFBTSxDQUFDLFNBQVMsQ0FBQztZQUNuQjtnQkFDRSxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ25CLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUF2VkQsc0NBdVZDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wbGV0aW9uSXRlbUtpbmQsXHJcbiAgQ29tcGxldGlvblRyaWdnZXJLaW5kLFxyXG4gIEluc2VydFRleHRGb3JtYXQsXHJcbiAgTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uLFxyXG4gIENvbXBsZXRpb25Db250ZXh0LFxyXG4gIENvbXBsZXRpb25JdGVtLFxyXG4gIENvbXBsZXRpb25MaXN0LFxyXG4gIENvbXBsZXRpb25QYXJhbXMsXHJcbiAgU2VydmVyQ2FwYWJpbGl0aWVzLFxyXG4gIFRleHRFZGl0LFxyXG59IGZyb20gJy4uL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0IHtcclxuICBBdXRvY29tcGxldGVTdWdnZXN0aW9uLFxyXG4gIEF1dG9jb21wbGV0ZVJlcXVlc3QsXHJcbiAgUG9pbnQsXHJcbiAgVGV4dEVkaXRvcixcclxufSBmcm9tICdhdG9tJztcclxuaW1wb3J0IHsgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UgfSBmcm9tICd2c2NvZGUtanNvbnJwYyc7XHJcbmltcG9ydCB7IEFjdGl2ZVNlcnZlciB9IGZyb20gJy4uL3NlcnZlci1tYW5hZ2VyJztcclxuaW1wb3J0IENvbnZlcnQgZnJvbSAnLi4vY29udmVydCc7XHJcbmltcG9ydCB7IGZpbHRlciB9IGZyb20gJ2Z1enphbGRyaW4tcGx1cyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi91dGlscyc7XHJcblxyXG5pbnRlcmZhY2UgU3VnZ2VzdGlvbkNhY2hlRW50cnkge1xyXG4gIGlzSW5jb21wbGV0ZTogYm9vbGVhbjtcclxuICB0cmlnZ2VyUG9pbnQ6IFBvaW50O1xyXG4gIHRyaWdnZXJDaGFyOiBzdHJpbmc7XHJcbiAgc3VnZ2VzdGlvbk1hcDogTWFwPEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sIFtDb21wbGV0aW9uSXRlbSwgYm9vbGVhbl0+O1xyXG59XHJcblxyXG4vLyBQdWJsaWM6IEFkYXB0cyB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sIFwidGV4dERvY3VtZW50L2NvbXBsZXRpb25cIiB0byB0aGUgQXRvbVxyXG4vLyBBdXRvQ29tcGxldGUrIHBhY2thZ2UuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1dG9jb21wbGV0ZUFkYXB0ZXIge1xyXG4gIHB1YmxpYyBzdGF0aWMgY2FuQWRhcHQoc2VydmVyQ2FwYWJpbGl0aWVzOiBTZXJ2ZXJDYXBhYmlsaXRpZXMpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBzZXJ2ZXJDYXBhYmlsaXRpZXMuY29tcGxldGlvblByb3ZpZGVyICE9IG51bGw7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIGNhblJlc29sdmUoc2VydmVyQ2FwYWJpbGl0aWVzOiBTZXJ2ZXJDYXBhYmlsaXRpZXMpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBzZXJ2ZXJDYXBhYmlsaXRpZXMuY29tcGxldGlvblByb3ZpZGVyICE9IG51bGwgJiZcclxuICAgICAgc2VydmVyQ2FwYWJpbGl0aWVzLmNvbXBsZXRpb25Qcm92aWRlci5yZXNvbHZlUHJvdmlkZXIgPT09IHRydWU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zdWdnZXN0aW9uQ2FjaGU6IFdlYWtNYXA8QWN0aXZlU2VydmVyLCBTdWdnZXN0aW9uQ2FjaGVFbnRyeT4gPSBuZXcgV2Vha01hcCgpO1xyXG4gIHByaXZhdGUgX2NhbmNlbGxhdGlvblRva2VuczogV2Vha01hcDxMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24sIENhbmNlbGxhdGlvblRva2VuU291cmNlPiA9IG5ldyBXZWFrTWFwKCk7XHJcblxyXG4gIC8vIFB1YmxpYzogT2J0YWluIHN1Z2dlc3Rpb24gbGlzdCBmb3IgQXV0b0NvbXBsZXRlKyBieSBxdWVyeWluZyB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHVzaW5nXHJcbiAgLy8gdGhlIGB0ZXh0RG9jdW1lbnQvY29tcGxldGlvbmAgcmVxdWVzdC5cclxuICAvL1xyXG4gIC8vICogYHNlcnZlcmAgQW4ge0FjdGl2ZVNlcnZlcn0gcG9pbnRpbmcgdG8gdGhlIGxhbmd1YWdlIHNlcnZlciB0byBxdWVyeS5cclxuICAvLyAqIGByZXF1ZXN0YCBUaGUge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gdG8gc2F0aXNmeS5cclxuICAvLyAqIGBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbWAgQW4gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHtDb21wbGV0aW9uSXRlbX0sIGFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259XHJcbiAgLy8gICBhbmQgYSB7YXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0fSBhbGxvd2luZyB5b3UgdG8gYWRqdXN0IGNvbnZlcnRlZCBpdGVtcy5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gb2YgYW4ge0FycmF5fSBvZiB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufXMgY29udGFpbmluZyB0aGVcclxuICAvLyBBdXRvQ29tcGxldGUrIHN1Z2dlc3Rpb25zIHRvIGRpc3BsYXkuXHJcbiAgcHVibGljIGFzeW5jIGdldFN1Z2dlc3Rpb25zKFxyXG4gICAgc2VydmVyOiBBY3RpdmVTZXJ2ZXIsXHJcbiAgICByZXF1ZXN0OiBBdXRvY29tcGxldGVSZXF1ZXN0LFxyXG4gICAgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW0/OiAoaXRlbTogQ29tcGxldGlvbkl0ZW0sIHN1Z2dlc3Rpb246IEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0OiBBdXRvY29tcGxldGVSZXF1ZXN0KSA9PiB2b2lkLFxyXG4gICAgbWluaW11bVdvcmRMZW5ndGg/OiBudW1iZXIsXHJcbiAgKTogUHJvbWlzZTxBdXRvY29tcGxldGVTdWdnZXN0aW9uW10+IHtcclxuICAgIGNvbnN0IHRyaWdnZXJDaGFycyA9XHJcbiAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMuY29tcGxldGlvblByb3ZpZGVyICE9IG51bGwgP1xyXG4gICAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMuY29tcGxldGlvblByb3ZpZGVyLnRyaWdnZXJDaGFyYWN0ZXJzIHx8IFtdIDogW107XHJcbiAgICBjb25zdCB0cmlnZ2VyQ2hhciA9IEF1dG9jb21wbGV0ZUFkYXB0ZXIuZ2V0VHJpZ2dlckNoYXJhY3RlcihyZXF1ZXN0LCB0cmlnZ2VyQ2hhcnMpO1xyXG4gICAgY29uc3QgcHJlZml4V2l0aFRyaWdnZXIgPSB0cmlnZ2VyQ2hhciArIHJlcXVlc3QucHJlZml4O1xyXG4gICAgY29uc3QgdHJpZ2dlckNvbHVtbiA9IHJlcXVlc3QuYnVmZmVyUG9zaXRpb24uY29sdW1uIC0gcHJlZml4V2l0aFRyaWdnZXIubGVuZ3RoO1xyXG4gICAgY29uc3QgdHJpZ2dlclBvaW50ID0gbmV3IFBvaW50KHJlcXVlc3QuYnVmZmVyUG9zaXRpb24ucm93LCB0cmlnZ2VyQ29sdW1uKTtcclxuXHJcbiAgICAvLyBPbmx5IGF1dG8tdHJpZ2dlciBvbiBhIHRyaWdnZXIgY2hhcmFjdGVyIG9yIGFmdGVyIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIGZyb20gYXV0b2NvbXBsZXRlLXBsdXNcclxuICAgIG1pbmltdW1Xb3JkTGVuZ3RoID0gbWluaW11bVdvcmRMZW5ndGggfHwgMDtcclxuICAgIGlmICghcmVxdWVzdC5hY3RpdmF0ZWRNYW51YWxseSAmJiB0cmlnZ2VyQ2hhciA9PT0gJycgJiZcclxuICAgICAgICBtaW5pbXVtV29yZExlbmd0aCA+IDAgJiYgcmVxdWVzdC5wcmVmaXgubGVuZ3RoIDwgbWluaW11bVdvcmRMZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNhY2hlID0gdGhpcy5fc3VnZ2VzdGlvbkNhY2hlLmdldChzZXJ2ZXIpO1xyXG4gICAgbGV0IHN1Z2dlc3Rpb25NYXAgPSBudWxsO1xyXG5cclxuICAgIC8vIERvIHdlIGhhdmUgY29tcGxldGUgY2FjaGVkIHN1Z2dlc3Rpb25zIHRoYXQgYXJlIHN0aWxsIHZhbGlkIGZvciB0aGlzIHJlcXVlc3RcclxuICAgIGlmIChjYWNoZSAmJiAhY2FjaGUuaXNJbmNvbXBsZXRlICYmIGNhY2hlLnRyaWdnZXJDaGFyID09PSB0cmlnZ2VyQ2hhciAmJiBjYWNoZS50cmlnZ2VyUG9pbnQuaXNFcXVhbCh0cmlnZ2VyUG9pbnQpKSB7XHJcbiAgICAgIHN1Z2dlc3Rpb25NYXAgPSBjYWNoZS5zdWdnZXN0aW9uTWFwO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gT3VyIGNhY2hlZCBzdWdnZXN0aW9ucyBjYW4ndCBiZSB1c2VkIHNvIG9idGFpbiBuZXcgb25lcyBmcm9tIHRoZSBsYW5ndWFnZSBzZXJ2ZXJcclxuICAgICAgY29uc3QgY29tcGxldGlvbnMgPVxyXG4gICAgICAgIGF3YWl0IFV0aWxzLmRvV2l0aENhbmNlbGxhdGlvblRva2VuKFxyXG4gICAgICAgICAgc2VydmVyLmNvbm5lY3Rpb24sXHJcbiAgICAgICAgICB0aGlzLl9jYW5jZWxsYXRpb25Ub2tlbnMsXHJcbiAgICAgICAgICAoY2FuY2VsbGF0aW9uVG9rZW4pID0+XHJcbiAgICAgICAgICAgIHNlcnZlci5jb25uZWN0aW9uLmNvbXBsZXRpb24oXHJcbiAgICAgICAgICAgICAgQXV0b2NvbXBsZXRlQWRhcHRlci5jcmVhdGVDb21wbGV0aW9uUGFyYW1zKHJlcXVlc3QsIHRyaWdnZXJDaGFyKSwgY2FuY2VsbGF0aW9uVG9rZW4pLFxyXG4gICAgICApO1xyXG4gICAgICBjb25zdCBpc0luY29tcGxldGUgPSAhQXJyYXkuaXNBcnJheShjb21wbGV0aW9ucykgJiYgY29tcGxldGlvbnMuaXNJbmNvbXBsZXRlO1xyXG4gICAgICBzdWdnZXN0aW9uTWFwID0gdGhpcy5jb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zKGNvbXBsZXRpb25zLCByZXF1ZXN0LCBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbSk7XHJcbiAgICAgIHRoaXMuX3N1Z2dlc3Rpb25DYWNoZS5zZXQoc2VydmVyLCB7aXNJbmNvbXBsZXRlLCB0cmlnZ2VyQ2hhciwgdHJpZ2dlclBvaW50LCBzdWdnZXN0aW9uTWFwfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmlsdGVyIHRoZSByZXN1bHRzIHRvIHJlY2FsY3VsYXRlIHRoZSBzY29yZSBhbmQgb3JkZXJpbmcgKHVubGVzcyBvbmx5IHRyaWdnZXJDaGFyKVxyXG4gICAgY29uc3Qgc3VnZ2VzdGlvbnMgPSBBcnJheS5mcm9tKHN1Z2dlc3Rpb25NYXAua2V5cygpKTtcclxuICAgIGNvbnN0IHJlcGxhY2VtZW50UHJlZml4ID0gcmVxdWVzdC5wcmVmaXggIT0gdHJpZ2dlckNoYXIgPyByZXF1ZXN0LnByZWZpeCA6ICcnO1xyXG4gICAgQXV0b2NvbXBsZXRlQWRhcHRlci5zZXRSZXBsYWNlbWVudFByZWZpeE9uU3VnZ2VzdGlvbnMoc3VnZ2VzdGlvbnMsIHJlcGxhY2VtZW50UHJlZml4KTtcclxuICAgIHJldHVybiByZXF1ZXN0LnByZWZpeCA9PT0gdHJpZ2dlckNoYXIgPyBzdWdnZXN0aW9ucyA6IGZpbHRlcihzdWdnZXN0aW9ucywgcmVxdWVzdC5wcmVmaXgsIHtrZXk6ICd0ZXh0J30pO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBPYnRhaW4gYSBjb21wbGV0ZSB2ZXJzaW9uIG9mIGEgc3VnZ2VzdGlvbiB3aXRoIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cclxuICAvLyB0aGUgbGFuZ3VhZ2Ugc2VydmVyIGNhbiBwcm92aWRlIGJ5IHdheSBvZiB0aGUgYGNvbXBsZXRpb25JdGVtL3Jlc29sdmVgIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBzZXJ2ZXJgIEFuIHtBY3RpdmVTZXJ2ZXJ9IHBvaW50aW5nIHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgdG8gcXVlcnkuXHJcbiAgLy8gKiBgc3VnZ2VzdGlvbmAgQW4ge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gc3VnZ2VzdGlvbiB0aGF0IHNob3VsZCBiZSByZXNvbHZlZC5cclxuICAvLyAqIGByZXF1ZXN0YCBBbiB7T2JqZWN0fSB3aXRoIHRoZSBBdXRvQ29tcGxldGUrIHJlcXVlc3QgdG8gc2F0aXNmeS5cclxuICAvLyAqIGBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbWAgQW4gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHtDb21wbGV0aW9uSXRlbX0sIGFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259XHJcbiAgLy8gICBhbmQgYSB7YXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0fSBhbGxvd2luZyB5b3UgdG8gYWRqdXN0IGNvbnZlcnRlZCBpdGVtcy5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gb2YgYW4ge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gd2l0aCB0aGUgcmVzb2x2ZWQgQXV0b0NvbXBsZXRlKyBzdWdnZXN0aW9uLlxyXG4gIHB1YmxpYyBhc3luYyBjb21wbGV0ZVN1Z2dlc3Rpb24oXHJcbiAgICBzZXJ2ZXI6IEFjdGl2ZVNlcnZlcixcclxuICAgIHN1Z2dlc3Rpb246IEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sXHJcbiAgICByZXF1ZXN0OiBBdXRvY29tcGxldGVSZXF1ZXN0LFxyXG4gICAgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW0/OiAoaXRlbTogQ29tcGxldGlvbkl0ZW0sIHN1Z2dlc3Rpb246IEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0OiBBdXRvY29tcGxldGVSZXF1ZXN0KSA9PiB2b2lkLFxyXG4gICk6IFByb21pc2U8QXV0b2NvbXBsZXRlU3VnZ2VzdGlvbj4ge1xyXG4gICAgY29uc3QgY2FjaGUgPSB0aGlzLl9zdWdnZXN0aW9uQ2FjaGUuZ2V0KHNlcnZlcik7XHJcbiAgICBpZiAoY2FjaGUpIHtcclxuICAgICAgY29uc3Qgb3JpZ2luYWxDb21wbGV0aW9uSXRlbSA9IGNhY2hlLnN1Z2dlc3Rpb25NYXAuZ2V0KHN1Z2dlc3Rpb24pO1xyXG4gICAgICBpZiAob3JpZ2luYWxDb21wbGV0aW9uSXRlbSAhPSBudWxsICYmIG9yaWdpbmFsQ29tcGxldGlvbkl0ZW1bMV0gPT09IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3QgcmVzb2x2ZWRDb21wbGV0aW9uSXRlbSA9IGF3YWl0IHNlcnZlci5jb25uZWN0aW9uLmNvbXBsZXRpb25JdGVtUmVzb2x2ZShvcmlnaW5hbENvbXBsZXRpb25JdGVtWzBdKTtcclxuICAgICAgICBpZiAocmVzb2x2ZWRDb21wbGV0aW9uSXRlbSAhPSBudWxsKSB7XHJcbiAgICAgICAgICBBdXRvY29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKFxyXG4gICAgICAgICAgICByZXNvbHZlZENvbXBsZXRpb25JdGVtLCBzdWdnZXN0aW9uLCByZXF1ZXN0LCBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbSk7XHJcbiAgICAgICAgICBvcmlnaW5hbENvbXBsZXRpb25JdGVtWzFdID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBzdWdnZXN0aW9uO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZXQgdGhlIHJlcGxhY2VtZW50UHJlZml4IHByb3BlcnR5IG9uIGFsbCBnaXZlbiBzdWdnZXN0aW9ucyB0byB0aGVcclxuICAvLyBwcmVmaXggc3BlY2lmaWVkLlxyXG4gIC8vXHJcbiAgLy8gKiBgc3VnZ2VzdGlvbnNgIEFuIHtBcnJheX0gb2Yge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn1zIHRvIHNldCB0aGUgcmVwbGFjZW1lbnRQcmVmaXggb24uXHJcbiAgLy8gKiBgcHJlZml4YCBUaGUge3N0cmluZ30gY29udGFpbmluZyB0aGUgcHJlZml4IHRoYXQgc2hvdWxkIGJlIHNldCBhcyByZXBsYWNlbWVudFByZWZpeCBvbiBhbGwgc3VnZ2VzdGlvbnMuXHJcbiAgcHVibGljIHN0YXRpYyBzZXRSZXBsYWNlbWVudFByZWZpeE9uU3VnZ2VzdGlvbnMoc3VnZ2VzdGlvbnM6IEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25bXSwgcHJlZml4OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGZvciAoY29uc3Qgc3VnZ2VzdGlvbiBvZiBzdWdnZXN0aW9ucykge1xyXG4gICAgICBzdWdnZXN0aW9uLnJlcGxhY2VtZW50UHJlZml4ID0gcHJlZml4O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBHZXQgdGhlIHRyaWdnZXIgY2hhcmFjdGVyIHRoYXQgY2F1c2VkIHRoZSBhdXRvY29tcGxldGUgKGlmIGFueSkuICBUaGlzIGlzIHJlcXVpcmVkIGJlY2F1c2VcclxuICAvLyBBdXRvQ29tcGxldGUtcGx1cyBkb2VzIG5vdCBoYXZlIHRyaWdnZXIgY2hhcmFjdGVycy4gIEFsdGhvdWdoIHRoZSB0ZXJtaW5vbG9neSBpcyAnY2hhcmFjdGVyJyB3ZSB0cmVhdFxyXG4gIC8vIHRoZW0gYXMgdmFyaWFibGUgbGVuZ3RoIHN0cmluZ3MgYXMgdGhpcyB3aWxsIGFsbW9zdCBjZXJ0YWlubHkgY2hhbmdlIGluIHRoZSBmdXR1cmUgdG8gc3VwcG9ydCAnLT4nIGV0Yy5cclxuICAvL1xyXG4gIC8vICogYHJlcXVlc3RgIEFuIHtBcnJheX0gb2Yge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn1zIHRvIGxvY2F0ZSB0aGUgcHJlZml4LCBlZGl0b3IsIGJ1ZmZlclBvc2l0aW9uIGV0Yy5cclxuICAvLyAqIGB0cmlnZ2VyQ2hhcnNgIFRoZSB7QXJyYXl9IG9mIHtzdHJpbmd9cyB0aGF0IGNhbiBiZSB0cmlnZ2VyIGNoYXJhY3RlcnMuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge3N0cmluZ30gY29udGFpbmluZyB0aGUgbWF0Y2hpbmcgdHJpZ2dlciBjaGFyYWN0ZXIgb3IgYW4gZW1wdHkgc3RyaW5nIGlmIG9uZSB3YXMgbm90IG1hdGNoZWQuXHJcbiAgcHVibGljIHN0YXRpYyBnZXRUcmlnZ2VyQ2hhcmFjdGVyKHJlcXVlc3Q6IEF1dG9jb21wbGV0ZVJlcXVlc3QsIHRyaWdnZXJDaGFyczogc3RyaW5nW10pOiBzdHJpbmcge1xyXG4gICAgLy8gQXV0b0NvbXBsZXRlLVBsdXMgY29uc2lkZXJzIHRleHQgYWZ0ZXIgYSBzeW1ib2wgdG8gYmUgYSBuZXcgdHJpZ2dlci4gU28gd2Ugc2hvdWxkIGxvb2sgYmFja3dhcmRcclxuICAgIC8vIGZyb20gdGhlIGN1cnJlbnQgY3Vyc29yIHBvc2l0aW9uIHRvIHNlZSBpZiBvbmUgaXMgdGhlcmUgYW5kIHRodXMgc2ltdWxhdGUgaXQuXHJcbiAgICBjb25zdCBidWZmZXIgPSByZXF1ZXN0LmVkaXRvci5nZXRCdWZmZXIoKTtcclxuICAgIGNvbnN0IGN1cnNvciA9IHJlcXVlc3QuYnVmZmVyUG9zaXRpb247XHJcbiAgICBjb25zdCBwcmVmaXhTdGFydENvbHVtbiA9IGN1cnNvci5jb2x1bW4gLSByZXF1ZXN0LnByZWZpeC5sZW5ndGg7XHJcbiAgICBmb3IgKGNvbnN0IHRyaWdnZXJDaGFyIG9mIHRyaWdnZXJDaGFycykge1xyXG4gICAgICBpZiAodHJpZ2dlckNoYXIgPT09IHJlcXVlc3QucHJlZml4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRyaWdnZXJDaGFyO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChwcmVmaXhTdGFydENvbHVtbiA+PSB0cmlnZ2VyQ2hhci5sZW5ndGgpIHsgLy8gRmFyIGVub3VnaCBhbG9uZyBhIGxpbmUgdG8gZml0IHRoZSB0cmlnZ2VyIGNoYXJcclxuICAgICAgICBjb25zdCBzdGFydCA9IG5ldyBQb2ludChjdXJzb3Iucm93LCBwcmVmaXhTdGFydENvbHVtbiAtIHRyaWdnZXJDaGFyLmxlbmd0aCk7XHJcbiAgICAgICAgY29uc3QgcG9zc2libGVUcmlnZ2VyID0gYnVmZmVyLmdldFRleHRJblJhbmdlKFtzdGFydCwgW2N1cnNvci5yb3csIHByZWZpeFN0YXJ0Q29sdW1uXV0pO1xyXG4gICAgICAgIGlmIChwb3NzaWJsZVRyaWdnZXIgPT09IHRyaWdnZXJDaGFyKSB7IC8vIFRoZSB0ZXh0IGJlZm9yZSBvdXIgdHJpZ2dlciBpcyBhIHRyaWdnZXIgY2hhciFcclxuICAgICAgICAgIHJldHVybiB0cmlnZ2VyQ2hhcjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBUaGVyZSB3YXMgbm8gZXhwbGljaXQgdHJpZ2dlciBjaGFyXHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENyZWF0ZSBUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyB0byBiZSBzZW50IHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXJcclxuICAvLyBiYXNlZCBvbiB0aGUgZWRpdG9yIGFuZCBwb3NpdGlvbiBmcm9tIHRoZSBBdXRvQ29tcGxldGVSZXF1ZXN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgcmVxdWVzdGAgVGhlIHthdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3R9IHRvIG9idGFpbiB0aGUgZWRpdG9yIGZyb20uXHJcbiAgLy8gKiBgdHJpZ2dlclBvaW50YCBUaGUge2F0b20kUG9pbnR9IHdoZXJlIHRoZSB0cmlnZ2VyIHN0YXJ0ZWQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge3N0cmluZ30gY29udGFpbmluZyB0aGUgcHJlZml4IGluY2x1ZGluZyB0aGUgdHJpZ2dlciBjaGFyYWN0ZXIuXHJcbiAgcHVibGljIHN0YXRpYyBnZXRQcmVmaXhXaXRoVHJpZ2dlcihyZXF1ZXN0OiBBdXRvY29tcGxldGVSZXF1ZXN0LCB0cmlnZ2VyUG9pbnQ6IFBvaW50KTogc3RyaW5nIHtcclxuICAgIHJldHVybiByZXF1ZXN0LmVkaXRvclxyXG4gICAgICAuZ2V0QnVmZmVyKClcclxuICAgICAgLmdldFRleHRJblJhbmdlKFtbdHJpZ2dlclBvaW50LnJvdywgdHJpZ2dlclBvaW50LmNvbHVtbl0sIHJlcXVlc3QuYnVmZmVyUG9zaXRpb25dKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ3JlYXRlIHtDb21wbGV0aW9uUGFyYW1zfSB0byBiZSBzZW50IHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXJcclxuICAvLyBiYXNlZCBvbiB0aGUgZWRpdG9yIGFuZCBwb3NpdGlvbiBmcm9tIHRoZSBBdXRvY29tcGxldGUgcmVxdWVzdCBldGMuXHJcbiAgLy9cclxuICAvLyAqIGByZXF1ZXN0YCBUaGUge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gY29udGFpbmluZyB0aGUgcmVxdWVzdCBkZXRhaWxzLlxyXG4gIC8vICogYHRyaWdnZXJDaGFyYWN0ZXJgIFRoZSB7c3RyaW5nfSBjb250YWluaW5nIHRoZSB0cmlnZ2VyIGNoYXJhY3RlciAoZW1wdHkgaWYgbm9uZSkuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGFuIHtDb21wbGV0aW9uUGFyYW1zfSB3aXRoIHRoZSBrZXlzOlxyXG4gIC8vICAqIGB0ZXh0RG9jdW1lbnRgIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wgdGV4dERvY3VtZW50IGlkZW50aWZpY2F0aW9uLlxyXG4gIC8vICAqIGBwb3NpdGlvbmAgdGhlIHBvc2l0aW9uIHdpdGhpbiB0aGUgdGV4dCBkb2N1bWVudCB0byBkaXNwbGF5IGNvbXBsZXRpb24gcmVxdWVzdCBmb3IuXHJcbiAgLy8gICogYGNvbnRleHRgIGNvbnRhaW5pbmcgdGhlIHRyaWdnZXIgY2hhcmFjdGVyIGFuZCBraW5kLlxyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQ29tcGxldGlvblBhcmFtcyhcclxuICAgIHJlcXVlc3Q6IEF1dG9jb21wbGV0ZVJlcXVlc3QsIHRyaWdnZXJDaGFyYWN0ZXI6IHN0cmluZyk6IENvbXBsZXRpb25QYXJhbXMge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGV4dERvY3VtZW50OiBDb252ZXJ0LmVkaXRvclRvVGV4dERvY3VtZW50SWRlbnRpZmllcihyZXF1ZXN0LmVkaXRvciksXHJcbiAgICAgIHBvc2l0aW9uOiBDb252ZXJ0LnBvaW50VG9Qb3NpdGlvbihyZXF1ZXN0LmJ1ZmZlclBvc2l0aW9uKSxcclxuICAgICAgY29udGV4dDogQXV0b2NvbXBsZXRlQWRhcHRlci5jcmVhdGVDb21wbGV0aW9uQ29udGV4dCh0cmlnZ2VyQ2hhcmFjdGVyKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENyZWF0ZSB7Q29tcGxldGlvbkNvbnRleHR9IHRvIGJlIHNlbnQgdG8gdGhlIGxhbmd1YWdlIHNlcnZlclxyXG4gIC8vIGJhc2VkIG9uIHRoZSB0cmlnZ2VyIGNoYXJhY3Rlci5cclxuICAvL1xyXG4gIC8vICogYHRyaWdnZXJDaGFyYWN0ZXJgIFRoZSB7c3RyaW5nfSBjb250YWluaW5nIHRoZSB0cmlnZ2VyIGNoYXJhY3RlciBvciAnJyBpZiBub25lLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhbiB7Q29tcGxldGlvbkNvbnRleHR9IHRoYXQgc3BlY2lmaWVzIHRoZSB0cmlnZ2VyS2luZCBhbmQgdGhlIHRyaWdnZXJDaGFyYWN0ZXJcclxuICAvLyBpZiB0aGVyZSBpcyBvbmUuXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVDb21wbGV0aW9uQ29udGV4dCh0cmlnZ2VyQ2hhcmFjdGVyOiBzdHJpbmcpOiBDb21wbGV0aW9uQ29udGV4dCB7XHJcbiAgICByZXR1cm4gdHJpZ2dlckNoYXJhY3RlciA9PT0gJydcclxuICAgICAgPyB7dHJpZ2dlcktpbmQ6IENvbXBsZXRpb25UcmlnZ2VyS2luZC5JbnZva2VkfVxyXG4gICAgICA6IHt0cmlnZ2VyS2luZDogQ29tcGxldGlvblRyaWdnZXJLaW5kLlRyaWdnZXJDaGFyYWN0ZXIsIHRyaWdnZXJDaGFyYWN0ZXJ9O1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGEgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sIENvbXBsZXRpb25JdGVtIGFycmF5IG9yIENvbXBsZXRpb25MaXN0IHRvXHJcbiAgLy8gYW4gYXJyYXkgb2Ygb3JkZXJlZCBBdXRvQ29tcGxldGUrIHN1Z2dlc3Rpb25zLlxyXG4gIC8vXHJcbiAgLy8gKiBgY29tcGxldGlvbkl0ZW1zYCBBbiB7QXJyYXl9IG9mIHtDb21wbGV0aW9uSXRlbX0gb2JqZWN0cyBvciBhIHtDb21wbGV0aW9uTGlzdH0gY29udGFpbmluZyBjb21wbGV0aW9uXHJcbiAgLy8gICAgICAgICAgIGl0ZW1zIHRvIGJlIGNvbnZlcnRlZC5cclxuICAvLyAqIGByZXF1ZXN0YCBUaGUge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gdG8gc2F0aXNmeS5cclxuICAvLyAqIGBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbWAgQSBmdW5jdGlvbiB0aGF0IHRha2VzIGEge0NvbXBsZXRpb25JdGVtfSwgYW4ge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn1cclxuICAvLyAgIGFuZCBhIHthdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3R9IGFsbG93aW5nIHlvdSB0byBhZGp1c3QgY29udmVydGVkIGl0ZW1zLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtNYXB9IG9mIEF1dG9Db21wbGV0ZSsgc3VnZ2VzdGlvbnMgb3JkZXJlZCBieSB0aGUgQ29tcGxldGlvbkl0ZW1zIHNvcnRUZXh0LlxyXG4gIHB1YmxpYyBjb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zKFxyXG4gICAgY29tcGxldGlvbkl0ZW1zOiBDb21wbGV0aW9uSXRlbVtdIHwgQ29tcGxldGlvbkxpc3QsXHJcbiAgICByZXF1ZXN0OiBBdXRvY29tcGxldGVSZXF1ZXN0LFxyXG4gICAgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW0/OiAoaXRlbTogQ29tcGxldGlvbkl0ZW0sIHN1Z2dlc3Rpb246IEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0OiBBdXRvY29tcGxldGVSZXF1ZXN0KSA9PiB2b2lkLFxyXG4gICk6IE1hcDxBdXRvY29tcGxldGVTdWdnZXN0aW9uLCBbQ29tcGxldGlvbkl0ZW0sIGJvb2xlYW5dPiB7XHJcbiAgICByZXR1cm4gbmV3IE1hcCgoQXJyYXkuaXNBcnJheShjb21wbGV0aW9uSXRlbXMpID8gY29tcGxldGlvbkl0ZW1zIDogY29tcGxldGlvbkl0ZW1zLml0ZW1zIHx8IFtdKVxyXG4gICAgICAuc29ydCgoYSwgYikgPT4gKGEuc29ydFRleHQgfHwgYS5sYWJlbCkubG9jYWxlQ29tcGFyZShiLnNvcnRUZXh0IHx8IGIubGFiZWwpKVxyXG4gICAgICAubWFwPFtBdXRvY29tcGxldGVTdWdnZXN0aW9uLCBbQ29tcGxldGlvbkl0ZW0sIGJvb2xlYW5dXT4oXHJcbiAgICAgICAgKHMpID0+IFtcclxuICAgICAgICAgIEF1dG9jb21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24ocywgeyB9LCByZXF1ZXN0LCBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbSksXHJcbiAgICAgICAgICBbcywgZmFsc2VdXSkpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGEgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sIENvbXBsZXRpb25JdGVtIHRvIGFuIEF1dG9Db21wbGV0ZSsgc3VnZ2VzdGlvbi5cclxuICAvL1xyXG4gIC8vICogYGl0ZW1gIEFuIHtDb21wbGV0aW9uSXRlbX0gY29udGFpbmluZyBhIGNvbXBsZXRpb24gaXRlbSB0byBiZSBjb252ZXJ0ZWQuXHJcbiAgLy8gKiBgc3VnZ2VzdGlvbmAgQSB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufSB0byBoYXZlIHRoZSBjb252ZXJzaW9uIGFwcGxpZWQgdG8uXHJcbiAgLy8gKiBgcmVxdWVzdGAgVGhlIHthdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3R9IHRvIHNhdGlzZnkuXHJcbiAgLy8gKiBgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW1gIEEgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHtDb21wbGV0aW9uSXRlbX0sIGFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259XHJcbiAgLy8gICBhbmQgYSB7YXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0fSBhbGxvd2luZyB5b3UgdG8gYWRqdXN0IGNvbnZlcnRlZCBpdGVtcy5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgdGhlIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259IHBhc3NlZCBpbiBhcyBzdWdnZXN0aW9uIHdpdGggdGhlIGNvbnZlcnNpb24gYXBwbGllZC5cclxuICBwdWJsaWMgc3RhdGljIGNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKFxyXG4gICAgaXRlbTogQ29tcGxldGlvbkl0ZW0sXHJcbiAgICBzdWdnZXN0aW9uOiBBdXRvY29tcGxldGVTdWdnZXN0aW9uLFxyXG4gICAgcmVxdWVzdDogQXV0b2NvbXBsZXRlUmVxdWVzdCxcclxuICAgIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtPzogKGl0ZW06IENvbXBsZXRpb25JdGVtLCBzdWdnZXN0aW9uOiBBdXRvY29tcGxldGVTdWdnZXN0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdDogQXV0b2NvbXBsZXRlUmVxdWVzdCkgPT4gdm9pZCxcclxuICApOiBBdXRvY29tcGxldGVTdWdnZXN0aW9uIHtcclxuICAgIEF1dG9jb21wbGV0ZUFkYXB0ZXIuYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihpdGVtLCBzdWdnZXN0aW9uKTtcclxuICAgIEF1dG9jb21wbGV0ZUFkYXB0ZXIuYXBwbHlUZXh0RWRpdFRvU3VnZ2VzdGlvbihpdGVtLnRleHRFZGl0LCByZXF1ZXN0LmVkaXRvciwgc3VnZ2VzdGlvbik7XHJcbiAgICBBdXRvY29tcGxldGVBZGFwdGVyLmFwcGx5U25pcHBldFRvU3VnZ2VzdGlvbihpdGVtLCBzdWdnZXN0aW9uKTtcclxuICAgIGlmIChvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbSAhPSBudWxsKSB7XHJcbiAgICAgIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtKGl0ZW0sIHN1Z2dlc3Rpb24sIHJlcXVlc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzdWdnZXN0aW9uO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IHRoZSBwcmltYXJ5IHBhcnRzIG9mIGEgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sIENvbXBsZXRpb25JdGVtIHRvIGFuIEF1dG9Db21wbGV0ZSsgc3VnZ2VzdGlvbi5cclxuICAvL1xyXG4gIC8vICogYGl0ZW1gIEFuIHtDb21wbGV0aW9uSXRlbX0gY29udGFpbmluZyB0aGUgY29tcGxldGlvbiBpdGVtcyB0byBiZSBtZXJnZWQgaW50by5cclxuICAvLyAqIGBzdWdnZXN0aW9uYCBUaGUge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gdG8gbWVyZ2UgdGhlIGNvbnZlcnNpb24gaW50by5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYW4ge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gY3JlYXRlZCBmcm9tIHRoZSB7Q29tcGxldGlvbkl0ZW19LlxyXG4gIHB1YmxpYyBzdGF0aWMgYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihpdGVtOiBDb21wbGV0aW9uSXRlbSwgc3VnZ2VzdGlvbjogQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbikge1xyXG4gICAgc3VnZ2VzdGlvbi50ZXh0ID0gaXRlbS5pbnNlcnRUZXh0IHx8IGl0ZW0ubGFiZWw7XHJcbiAgICBzdWdnZXN0aW9uLmRpc3BsYXlUZXh0ID0gaXRlbS5sYWJlbDtcclxuICAgIHN1Z2dlc3Rpb24udHlwZSA9IEF1dG9jb21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlKGl0ZW0ua2luZCk7XHJcbiAgICBzdWdnZXN0aW9uLnJpZ2h0TGFiZWwgPSBpdGVtLmRldGFpbDtcclxuXHJcbiAgICBpZiAodHlwZW9mIGl0ZW0uZG9jdW1lbnRhdGlvbiA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgc3VnZ2VzdGlvbi5kZXNjcmlwdGlvbk1hcmtkb3duID0gaXRlbS5kb2N1bWVudGF0aW9uLnZhbHVlO1xyXG4gICAgICBzdWdnZXN0aW9uLmRlc2NyaXB0aW9uID0gaXRlbS5kb2N1bWVudGF0aW9uLnZhbHVlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHN1Z2dlc3Rpb24uZGVzY3JpcHRpb25NYXJrZG93biA9IGl0ZW0uZG9jdW1lbnRhdGlvbjtcclxuICAgICAgc3VnZ2VzdGlvbi5kZXNjcmlwdGlvbiA9IGl0ZW0uZG9jdW1lbnRhdGlvbjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQXBwbGllcyB0aGUgdGV4dEVkaXQgcGFydCBvZiBhIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCBDb21wbGV0aW9uSXRlbSB0byBhblxyXG4gIC8vIEF1dG9Db21wbGV0ZSsgU3VnZ2VzdGlvbiB2aWEgdGhlIHJlcGxhY2VtZW50UHJlZml4IGFuZCB0ZXh0IHByb3BlcnRpZXMuXHJcbiAgLy9cclxuICAvLyAqIGB0ZXh0RWRpdGAgQSB7VGV4dEVkaXR9IGZyb20gYSBDb21wbGV0aW9uSXRlbSB0byBhcHBseS5cclxuICAvLyAqIGBlZGl0b3JgIEFuIEF0b20ge1RleHRFZGl0b3J9IHVzZWQgdG8gb2J0YWluIHRoZSBuZWNlc3NhcnkgdGV4dCByZXBsYWNlbWVudC5cclxuICAvLyAqIGBzdWdnZXN0aW9uYCBBbiB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufSB0byBzZXQgdGhlIHJlcGxhY2VtZW50UHJlZml4IGFuZCB0ZXh0IHByb3BlcnRpZXMgb2YuXHJcbiAgcHVibGljIHN0YXRpYyBhcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uKFxyXG4gICAgdGV4dEVkaXQ6IFRleHRFZGl0IHwgdW5kZWZpbmVkLFxyXG4gICAgZWRpdG9yOiBUZXh0RWRpdG9yLFxyXG4gICAgc3VnZ2VzdGlvbjogQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbixcclxuICApOiB2b2lkIHtcclxuICAgIGlmICh0ZXh0RWRpdCkge1xyXG4gICAgICBzdWdnZXN0aW9uLnJlcGxhY2VtZW50UHJlZml4ID0gZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlKENvbnZlcnQubHNSYW5nZVRvQXRvbVJhbmdlKHRleHRFZGl0LnJhbmdlKSk7XHJcbiAgICAgIHN1Z2dlc3Rpb24udGV4dCA9IHRleHRFZGl0Lm5ld1RleHQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEFkZHMgYSBzbmlwcGV0IHRvIHRoZSBzdWdnZXN0aW9uIGlmIHRoZSBDb21wbGV0aW9uSXRlbSBjb250YWluc1xyXG4gIC8vIHNuaXBwZXQtZm9ybWF0dGVkIHRleHRcclxuICAvL1xyXG4gIC8vICogYGl0ZW1gIEFuIHtDb21wbGV0aW9uSXRlbX0gY29udGFpbmluZyB0aGUgY29tcGxldGlvbiBpdGVtcyB0byBiZSBtZXJnZWQgaW50by5cclxuICAvLyAqIGBzdWdnZXN0aW9uYCBUaGUge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gdG8gbWVyZ2UgdGhlIGNvbnZlcnNpb24gaW50by5cclxuICAvL1xyXG4gIHB1YmxpYyBzdGF0aWMgYXBwbHlTbmlwcGV0VG9TdWdnZXN0aW9uKGl0ZW06IENvbXBsZXRpb25JdGVtLCBzdWdnZXN0aW9uOiBBdXRvY29tcGxldGVTdWdnZXN0aW9uKTogdm9pZCB7XHJcbiAgICBpZiAoaXRlbS5pbnNlcnRUZXh0Rm9ybWF0ID09PSBJbnNlcnRUZXh0Rm9ybWF0LlNuaXBwZXQpIHtcclxuICAgICAgc3VnZ2VzdGlvbi5zbmlwcGV0ID0gaXRlbS50ZXh0RWRpdCAhPSBudWxsID8gaXRlbS50ZXh0RWRpdC5uZXdUZXh0IDogaXRlbS5pbnNlcnRUZXh0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBPYnRhaW4gdGhlIHRleHR1YWwgc3VnZ2VzdGlvbiB0eXBlIHJlcXVpcmVkIGJ5IEF1dG9Db21wbGV0ZSsgdGhhdFxyXG4gIC8vIG1vc3QgY2xvc2VseSBtYXBzIHRvIHRoZSBudW1lcmljIGNvbXBsZXRpb24ga2luZCBzdXBwbGllcyBieSB0aGUgbGFuZ3VhZ2Ugc2VydmVyLlxyXG4gIC8vXHJcbiAgLy8gKiBga2luZGAgQSB7TnVtYmVyfSB0aGF0IHJlcHJlc2VudHMgdGhlIHN1Z2dlc3Rpb24ga2luZCB0byBiZSBjb252ZXJ0ZWQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge1N0cmluZ30gY29udGFpbmluZyB0aGUgQXV0b0NvbXBsZXRlKyBzdWdnZXN0aW9uIHR5cGUgZXF1aXZhbGVudFxyXG4gIC8vIHRvIHRoZSBnaXZlbiBjb21wbGV0aW9uIGtpbmQuXHJcbiAgcHVibGljIHN0YXRpYyBjb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUoa2luZDogbnVtYmVyIHwgdW5kZWZpbmVkKTogc3RyaW5nIHtcclxuICAgIHN3aXRjaCAoa2luZCkge1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5Db25zdGFudDpcclxuICAgICAgICByZXR1cm4gJ2NvbnN0YW50JztcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuTWV0aG9kOlxyXG4gICAgICAgIHJldHVybiAnbWV0aG9kJztcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuRnVuY3Rpb246XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkNvbnN0cnVjdG9yOlxyXG4gICAgICAgIHJldHVybiAnZnVuY3Rpb24nO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5GaWVsZDpcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuUHJvcGVydHk6XHJcbiAgICAgICAgcmV0dXJuICdwcm9wZXJ0eSc7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLlZhcmlhYmxlOlxyXG4gICAgICAgIHJldHVybiAndmFyaWFibGUnO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5DbGFzczpcclxuICAgICAgICByZXR1cm4gJ2NsYXNzJztcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuU3RydWN0OlxyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5UeXBlUGFyYW1ldGVyOlxyXG4gICAgICAgIHJldHVybiAndHlwZSc7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLk9wZXJhdG9yOlxyXG4gICAgICAgIHJldHVybiAnc2VsZWN0b3InO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5JbnRlcmZhY2U6XHJcbiAgICAgICAgcmV0dXJuICdtaXhpbic7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLk1vZHVsZTpcclxuICAgICAgICByZXR1cm4gJ21vZHVsZSc7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLlVuaXQ6XHJcbiAgICAgICAgcmV0dXJuICdidWlsdGluJztcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuRW51bTpcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuRW51bU1lbWJlcjpcclxuICAgICAgICByZXR1cm4gJ2VudW0nO1xyXG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkOlxyXG4gICAgICAgIHJldHVybiAna2V5d29yZCc7XHJcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLlNuaXBwZXQ6XHJcbiAgICAgICAgcmV0dXJuICdzbmlwcGV0JztcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuRmlsZTpcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuRm9sZGVyOlxyXG4gICAgICAgIHJldHVybiAnaW1wb3J0JztcclxuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuUmVmZXJlbmNlOlxyXG4gICAgICAgIHJldHVybiAncmVxdWlyZSc7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuICd2YWx1ZSc7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ls = require("./languageclient");
const atom_1 = require("atom");
const URL = require("url");
// Public: Class that contains a number of helper methods for general conversions
// between the language server protocol and Atom/Atom packages.
class Convert {
    // Public: Convert a path to a Uri.
    //
    // * `filePath` A file path to convert to a Uri.
    //
    // Returns the Uri corresponding to the path. e.g. file:///a/b/c.txt
    static pathToUri(filePath) {
        let newPath = filePath.replace(/\\/g, '/');
        if (newPath[0] !== '/') {
            newPath = `/${newPath}`;
        }
        return encodeURI(`file://${newPath}`).replace(/[?#]/g, encodeURIComponent);
    }
    // Public: Convert a Uri to a path.
    //
    // * `uri` A Uri to convert to a file path.
    //
    // Returns a file path corresponding to the Uri. e.g. /a/b/c.txt
    // If the Uri does not begin file: then it is returned as-is to allow Atom
    // to deal with http/https sources in the future.
    static uriToPath(uri) {
        const url = URL.parse(uri);
        if (url.protocol !== 'file:' || url.path === undefined) {
            return uri;
        }
        let filePath = decodeURIComponent(url.path);
        if (process.platform === 'win32') {
            // Deal with Windows drive names
            if (filePath[0] === '/') {
                filePath = filePath.substr(1);
            }
            return filePath.replace(/\//g, '\\');
        }
        return filePath;
    }
    // Public: Convert an Atom {Point} to a language server {Position}.
    //
    // * `point` An Atom {Point} to convert from.
    //
    // Returns the {Position} representation of the Atom {PointObject}.
    static pointToPosition(point) {
        return { line: point.row, character: point.column };
    }
    // Public: Convert a language server {Position} into an Atom {PointObject}.
    //
    // * 'position' A language server {Position} to convert from.
    //
    // Returns the Atom {PointObject} representation of the given {Position}.
    static positionToPoint(position) {
        return new atom_1.Point(position.line, position.character);
    }
    // Public: Convert a language server {Range} into an Atom {Range}.
    //
    // * 'range' A language server {Range} to convert from.
    //
    // Returns the Atom {Range} representation of the given language server {Range}.
    static lsRangeToAtomRange(range) {
        return new atom_1.Range(Convert.positionToPoint(range.start), Convert.positionToPoint(range.end));
    }
    // Public: Convert an Atom {Range} into an language server {Range}.
    //
    // * 'range' An Atom {Range} to convert from.
    //
    // Returns the language server {Range} representation of the given Atom {Range}.
    static atomRangeToLSRange(range) {
        return {
            start: Convert.pointToPosition(range.start),
            end: Convert.pointToPosition(range.end),
        };
    }
    // Public: Create a {TextDocumentIdentifier} from an Atom {TextEditor}.
    //
    // * `editor` A {TextEditor} that will be used to form the uri property.
    //
    // Returns a {TextDocumentIdentifier} that has a `uri` property with the Uri for the
    // given editor's path.
    static editorToTextDocumentIdentifier(editor) {
        return { uri: Convert.pathToUri(editor.getPath() || '') };
    }
    // Public: Create a {TextDocumentPositionParams} from a {TextEditor} and optional {Point}.
    //
    // * `editor` A {TextEditor} that will be used to form the uri property.
    // * `point`  An optional {Point} that will supply the position property. If not specified
    //            the current cursor position will be used.
    //
    // Returns a {TextDocumentPositionParams} that has textDocument property with the editors {TextDocumentIdentifier}
    // and a position property with the supplied point (or current cursor position when not specified).
    static editorToTextDocumentPositionParams(editor, point) {
        return {
            textDocument: Convert.editorToTextDocumentIdentifier(editor),
            position: Convert.pointToPosition(point != null ? point : editor.getCursorBufferPosition()),
        };
    }
    // Public: Create a string of scopes for the atom text editor using the data-grammar selector from an
    // {Array} of grammarScope strings.
    //
    // * `grammarScopes` An {Array} of grammar scope string to convert from.
    //
    // Returns a single comma-separated list of CSS selectors targetting the grammars of Atom text editors.
    // e.g. `['c', 'cpp']` => `'atom-text-editor[data-grammar='c'], atom-text-editor[data-grammar='cpp']`
    static grammarScopesToTextEditorScopes(grammarScopes) {
        return grammarScopes
            .map((g) => `atom-text-editor[data-grammar="${Convert.encodeHTMLAttribute(g.replace(/\./g, ' '))}"]`)
            .join(', ');
    }
    // Public: Encode a string so that it can be safely used within a HTML attribute - i.e. replacing all quoted
    // values with their HTML entity encoded versions.  e.g. `Hello"` becomes `Hello&quot;`
    //
    // * 's' A string to be encoded.
    //
    // Returns a string that is HTML attribute encoded by replacing &, <, >, " and ' with their HTML entity
    // named equivalents.
    static encodeHTMLAttribute(s) {
        const attributeMap = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&apos;',
        };
        return s.replace(/[&<>'"]/g, (c) => attributeMap[c]);
    }
    // Public: Convert an Atom File Event as received from atom.project.onDidChangeFiles and convert
    // it into an Array of Language Server Protocol {FileEvent} objects. Normally this will be a 1-to-1
    // but renames will be represented by a deletion and a subsequent creation as LSP does not know about
    // renames.
    //
    // * 'fileEvent' An {atom$ProjectFileEvent} to be converted.
    //
    // Returns an array of LSP {ls.FileEvent} objects that equivalent conversions to the fileEvent parameter.
    static atomFileEventToLSFileEvents(fileEvent) {
        switch (fileEvent.action) {
            case 'created':
                return [{ uri: Convert.pathToUri(fileEvent.path), type: ls.FileChangeType.Created }];
            case 'modified':
                return [{ uri: Convert.pathToUri(fileEvent.path), type: ls.FileChangeType.Changed }];
            case 'deleted':
                return [{ uri: Convert.pathToUri(fileEvent.path), type: ls.FileChangeType.Deleted }];
            case 'renamed': {
                const results = [];
                if (fileEvent.oldPath) {
                    results.push({ uri: Convert.pathToUri(fileEvent.oldPath || ''), type: ls.FileChangeType.Deleted });
                }
                if (fileEvent.path) {
                    results.push({ uri: Convert.pathToUri(fileEvent.path), type: ls.FileChangeType.Created });
                }
                return results;
            }
            default:
                return [];
        }
    }
    static atomIdeDiagnosticToLSDiagnostic(diagnostic) {
        return {
            range: Convert.atomRangeToLSRange(diagnostic.range),
            severity: Convert.diagnosticTypeToLSSeverity(diagnostic.type),
            source: diagnostic.providerName,
            message: diagnostic.text || '',
        };
    }
    static diagnosticTypeToLSSeverity(type) {
        switch (type) {
            case 'Error':
                return ls.DiagnosticSeverity.Error;
            case 'Warning':
                return ls.DiagnosticSeverity.Warning;
            case 'Info':
                return ls.DiagnosticSeverity.Information;
            default:
                throw Error(`Unexpected diagnostic type ${type}`);
        }
    }
    // Public: Convert an array of language server protocol {TextEdit} objects to an
    // equivalent array of Atom {TextEdit} objects.
    //
    // * `textEdits` The language server protocol {TextEdit} objects to convert.
    //
    // Returns an {Array} of Atom {TextEdit} objects.
    static convertLsTextEdits(textEdits) {
        return (textEdits || []).map(Convert.convertLsTextEdit);
    }
    // Public: Convert a language server protocol {TextEdit} object to the
    // Atom equivalent {TextEdit}.
    //
    // * `textEdits` The language server protocol {TextEdit} objects to convert.
    //
    // Returns an Atom {TextEdit} object.
    static convertLsTextEdit(textEdit) {
        return {
            oldRange: Convert.lsRangeToAtomRange(textEdit.range),
            newText: textEdit.newText,
        };
    }
}
exports.default = Convert;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9jb252ZXJ0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsdUNBQXVDO0FBQ3ZDLCtCQUFrRTtBQUVsRSwyQkFBMkI7QUFFM0IsaUZBQWlGO0FBQ2pGLCtEQUErRDtBQUMvRDtJQUNFLG1DQUFtQztJQUNuQyxFQUFFO0lBQ0YsZ0RBQWdEO0lBQ2hELEVBQUU7SUFDRixvRUFBb0U7SUFDN0QsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFnQjtRQUN0QyxJQUFJLE9BQU8sR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztRQUMzQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN2QixPQUFPLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUMxQixDQUFDO1FBQ0QsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0lBQzdFLENBQUM7SUFFRCxtQ0FBbUM7SUFDbkMsRUFBRTtJQUNGLDJDQUEyQztJQUMzQyxFQUFFO0lBQ0YsZ0VBQWdFO0lBQ2hFLDBFQUEwRTtJQUMxRSxpREFBaUQ7SUFDMUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFXO1FBQ2pDLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDM0IsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxPQUFPLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3ZELE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDYixDQUFDO1FBRUQsSUFBSSxRQUFRLEdBQUcsa0JBQWtCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFD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QUFLLENBQUM7WUFDcEQsT0FBTyxFQUFFLFFBQVEsQ0FBQyxPQUFPO1NBQzFCLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFuTkQsMEJBbU5DIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCAqIGFzIGxzIGZyb20gJy4vbGFuZ3VhZ2VjbGllbnQnO1xyXG5pbXBvcnQgeyBQb2ludCwgUHJvamVjdEZpbGVFdmVudCwgUmFuZ2UsIFRleHRFZGl0b3IgfSBmcm9tICdhdG9tJztcclxuaW1wb3J0IHsgRGlhZ25vc3RpYywgRGlhZ25vc3RpY1R5cGUsIFRleHRFZGl0IH0gZnJvbSAnYXRvbS1pZGUnO1xyXG5pbXBvcnQgKiBhcyBVUkwgZnJvbSAndXJsJztcclxuXHJcbi8vIFB1YmxpYzogQ2xhc3MgdGhhdCBjb250YWlucyBhIG51bWJlciBvZiBoZWxwZXIgbWV0aG9kcyBmb3IgZ2VuZXJhbCBjb252ZXJzaW9uc1xyXG4vLyBiZXR3ZWVuIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wgYW5kIEF0b20vQXRvbSBwYWNrYWdlcy5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29udmVydCB7XHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGEgcGF0aCB0byBhIFVyaS5cclxuICAvL1xyXG4gIC8vICogYGZpbGVQYXRoYCBBIGZpbGUgcGF0aCB0byBjb252ZXJ0IHRvIGEgVXJpLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyB0aGUgVXJpIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHBhdGguIGUuZy4gZmlsZTovLy9hL2IvYy50eHRcclxuICBwdWJsaWMgc3RhdGljIHBhdGhUb1VyaShmaWxlUGF0aDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGxldCBuZXdQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvXFxcXC9nLCAnLycpO1xyXG4gICAgaWYgKG5ld1BhdGhbMF0gIT09ICcvJykge1xyXG4gICAgICBuZXdQYXRoID0gYC8ke25ld1BhdGh9YDtcclxuICAgIH1cclxuICAgIHJldHVybiBlbmNvZGVVUkkoYGZpbGU6Ly8ke25ld1BhdGh9YCkucmVwbGFjZSgvWz8jXS9nLCBlbmNvZGVVUklDb21wb25lbnQpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGEgVXJpIHRvIGEgcGF0aC5cclxuICAvL1xyXG4gIC8vICogYHVyaWAgQSBVcmkgdG8gY29udmVydCB0byBhIGZpbGUgcGF0aC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSBmaWxlIHBhdGggY29ycmVzcG9uZGluZyB0byB0aGUgVXJpLiBlLmcuIC9hL2IvYy50eHRcclxuICAvLyBJZiB0aGUgVXJpIGRvZXMgbm90IGJlZ2luIGZpbGU6IHRoZW4gaXQgaXMgcmV0dXJuZWQgYXMtaXMgdG8gYWxsb3cgQXRvbVxyXG4gIC8vIHRvIGRlYWwgd2l0aCBodHRwL2h0dHBzIHNvdXJjZXMgaW4gdGhlIGZ1dHVyZS5cclxuICBwdWJsaWMgc3RhdGljIHVyaVRvUGF0aCh1cmk6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCB1cmwgPSBVUkwucGFyc2UodXJpKTtcclxuICAgIGlmICh1cmwucHJvdG9jb2wgIT09ICdmaWxlOicgfHwgdXJsLnBhdGggPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICByZXR1cm4gdXJpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBmaWxlUGF0aCA9IGRlY29kZVVSSUNvbXBvbmVudCh1cmwucGF0aCk7XHJcbiAgICBpZiAocHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJykge1xyXG4gICAgICAvLyBEZWFsIHdpdGggV2luZG93cyBkcml2ZSBuYW1lc1xyXG4gICAgICBpZiAoZmlsZVBhdGhbMF0gPT09ICcvJykge1xyXG4gICAgICAgIGZpbGVQYXRoID0gZmlsZVBhdGguc3Vic3RyKDEpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmaWxlUGF0aC5yZXBsYWNlKC9cXC8vZywgJ1xcXFwnKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmaWxlUGF0aDtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ29udmVydCBhbiBBdG9tIHtQb2ludH0gdG8gYSBsYW5ndWFnZSBzZXJ2ZXIge1Bvc2l0aW9ufS5cclxuICAvL1xyXG4gIC8vICogYHBvaW50YCBBbiBBdG9tIHtQb2ludH0gdG8gY29udmVydCBmcm9tLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyB0aGUge1Bvc2l0aW9ufSByZXByZXNlbnRhdGlvbiBvZiB0aGUgQXRvbSB7UG9pbnRPYmplY3R9LlxyXG4gIHB1YmxpYyBzdGF0aWMgcG9pbnRUb1Bvc2l0aW9uKHBvaW50OiBQb2ludCk6IGxzLlBvc2l0aW9uIHtcclxuICAgIHJldHVybiB7bGluZTogcG9pbnQucm93LCBjaGFyYWN0ZXI6IHBvaW50LmNvbHVtbn07XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENvbnZlcnQgYSBsYW5ndWFnZSBzZXJ2ZXIge1Bvc2l0aW9ufSBpbnRvIGFuIEF0b20ge1BvaW50T2JqZWN0fS5cclxuICAvL1xyXG4gIC8vICogJ3Bvc2l0aW9uJyBBIGxhbmd1YWdlIHNlcnZlciB7UG9zaXRpb259IHRvIGNvbnZlcnQgZnJvbS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgdGhlIEF0b20ge1BvaW50T2JqZWN0fSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4ge1Bvc2l0aW9ufS5cclxuICBwdWJsaWMgc3RhdGljIHBvc2l0aW9uVG9Qb2ludChwb3NpdGlvbjogbHMuUG9zaXRpb24pOiBQb2ludCB7XHJcbiAgICByZXR1cm4gbmV3IFBvaW50KHBvc2l0aW9uLmxpbmUsIHBvc2l0aW9uLmNoYXJhY3Rlcik7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENvbnZlcnQgYSBsYW5ndWFnZSBzZXJ2ZXIge1JhbmdlfSBpbnRvIGFuIEF0b20ge1JhbmdlfS5cclxuICAvL1xyXG4gIC8vICogJ3JhbmdlJyBBIGxhbmd1YWdlIHNlcnZlciB7UmFuZ2V9IHRvIGNvbnZlcnQgZnJvbS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgdGhlIEF0b20ge1JhbmdlfSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugc2VydmVyIHtSYW5nZX0uXHJcbiAgcHVibGljIHN0YXRpYyBsc1JhbmdlVG9BdG9tUmFuZ2UocmFuZ2U6IGxzLlJhbmdlKTogUmFuZ2Uge1xyXG4gICAgcmV0dXJuIG5ldyBSYW5nZShDb252ZXJ0LnBvc2l0aW9uVG9Qb2ludChyYW5nZS5zdGFydCksIENvbnZlcnQucG9zaXRpb25Ub1BvaW50KHJhbmdlLmVuZCkpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGFuIEF0b20ge1JhbmdlfSBpbnRvIGFuIGxhbmd1YWdlIHNlcnZlciB7UmFuZ2V9LlxyXG4gIC8vXHJcbiAgLy8gKiAncmFuZ2UnIEFuIEF0b20ge1JhbmdlfSB0byBjb252ZXJ0IGZyb20uXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIHRoZSBsYW5ndWFnZSBzZXJ2ZXIge1JhbmdlfSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4gQXRvbSB7UmFuZ2V9LlxyXG4gIHB1YmxpYyBzdGF0aWMgYXRvbVJhbmdlVG9MU1JhbmdlKHJhbmdlOiBSYW5nZSk6IGxzLlJhbmdlIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN0YXJ0OiBDb252ZXJ0LnBvaW50VG9Qb3NpdGlvbihyYW5nZS5zdGFydCksXHJcbiAgICAgIGVuZDogQ29udmVydC5wb2ludFRvUG9zaXRpb24ocmFuZ2UuZW5kKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENyZWF0ZSBhIHtUZXh0RG9jdW1lbnRJZGVudGlmaWVyfSBmcm9tIGFuIEF0b20ge1RleHRFZGl0b3J9LlxyXG4gIC8vXHJcbiAgLy8gKiBgZWRpdG9yYCBBIHtUZXh0RWRpdG9yfSB0aGF0IHdpbGwgYmUgdXNlZCB0byBmb3JtIHRoZSB1cmkgcHJvcGVydHkuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge1RleHREb2N1bWVudElkZW50aWZpZXJ9IHRoYXQgaGFzIGEgYHVyaWAgcHJvcGVydHkgd2l0aCB0aGUgVXJpIGZvciB0aGVcclxuICAvLyBnaXZlbiBlZGl0b3IncyBwYXRoLlxyXG4gIHB1YmxpYyBzdGF0aWMgZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyKGVkaXRvcjogVGV4dEVkaXRvcik6IGxzLlRleHREb2N1bWVudElkZW50aWZpZXIge1xyXG4gICAgcmV0dXJuIHt1cmk6IENvbnZlcnQucGF0aFRvVXJpKGVkaXRvci5nZXRQYXRoKCkgfHwgJycpfTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ3JlYXRlIGEge1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zfSBmcm9tIGEge1RleHRFZGl0b3J9IGFuZCBvcHRpb25hbCB7UG9pbnR9LlxyXG4gIC8vXHJcbiAgLy8gKiBgZWRpdG9yYCBBIHtUZXh0RWRpdG9yfSB0aGF0IHdpbGwgYmUgdXNlZCB0byBmb3JtIHRoZSB1cmkgcHJvcGVydHkuXHJcbiAgLy8gKiBgcG9pbnRgICBBbiBvcHRpb25hbCB7UG9pbnR9IHRoYXQgd2lsbCBzdXBwbHkgdGhlIHBvc2l0aW9uIHByb3BlcnR5LiBJZiBub3Qgc3BlY2lmaWVkXHJcbiAgLy8gICAgICAgICAgICB0aGUgY3VycmVudCBjdXJzb3IgcG9zaXRpb24gd2lsbCBiZSB1c2VkLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtc30gdGhhdCBoYXMgdGV4dERvY3VtZW50IHByb3BlcnR5IHdpdGggdGhlIGVkaXRvcnMge1RleHREb2N1bWVudElkZW50aWZpZXJ9XHJcbiAgLy8gYW5kIGEgcG9zaXRpb24gcHJvcGVydHkgd2l0aCB0aGUgc3VwcGxpZWQgcG9pbnQgKG9yIGN1cnJlbnQgY3Vyc29yIHBvc2l0aW9uIHdoZW4gbm90IHNwZWNpZmllZCkuXHJcbiAgcHVibGljIHN0YXRpYyBlZGl0b3JUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zKFxyXG4gICAgZWRpdG9yOiBUZXh0RWRpdG9yLFxyXG4gICAgcG9pbnQ/OiBQb2ludCxcclxuICApOiBscy5UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0ZXh0RG9jdW1lbnQ6IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyKGVkaXRvciksXHJcbiAgICAgIHBvc2l0aW9uOiBDb252ZXJ0LnBvaW50VG9Qb3NpdGlvbihwb2ludCAhPSBudWxsID8gcG9pbnQgOiBlZGl0b3IuZ2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oKSksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDcmVhdGUgYSBzdHJpbmcgb2Ygc2NvcGVzIGZvciB0aGUgYXRvbSB0ZXh0IGVkaXRvciB1c2luZyB0aGUgZGF0YS1ncmFtbWFyIHNlbGVjdG9yIGZyb20gYW5cclxuICAvLyB7QXJyYXl9IG9mIGdyYW1tYXJTY29wZSBzdHJpbmdzLlxyXG4gIC8vXHJcbiAgLy8gKiBgZ3JhbW1hclNjb3Blc2AgQW4ge0FycmF5fSBvZiBncmFtbWFyIHNjb3BlIHN0cmluZyB0byBjb252ZXJ0IGZyb20uXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEgc2luZ2xlIGNvbW1hLXNlcGFyYXRlZCBsaXN0IG9mIENTUyBzZWxlY3RvcnMgdGFyZ2V0dGluZyB0aGUgZ3JhbW1hcnMgb2YgQXRvbSB0ZXh0IGVkaXRvcnMuXHJcbiAgLy8gZS5nLiBgWydjJywgJ2NwcCddYCA9PiBgJ2F0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPSdjJ10sIGF0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPSdjcHAnXWBcclxuICBwdWJsaWMgc3RhdGljIGdyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMoZ3JhbW1hclNjb3Blczogc3RyaW5nW10pOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGdyYW1tYXJTY29wZXNcclxuICAgICAgLm1hcCgoZykgPT4gYGF0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiJHtDb252ZXJ0LmVuY29kZUhUTUxBdHRyaWJ1dGUoZy5yZXBsYWNlKC9cXC4vZywgJyAnKSl9XCJdYClcclxuICAgICAgLmpvaW4oJywgJyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEVuY29kZSBhIHN0cmluZyBzbyB0aGF0IGl0IGNhbiBiZSBzYWZlbHkgdXNlZCB3aXRoaW4gYSBIVE1MIGF0dHJpYnV0ZSAtIGkuZS4gcmVwbGFjaW5nIGFsbCBxdW90ZWRcclxuICAvLyB2YWx1ZXMgd2l0aCB0aGVpciBIVE1MIGVudGl0eSBlbmNvZGVkIHZlcnNpb25zLiAgZS5nLiBgSGVsbG9cImAgYmVjb21lcyBgSGVsbG8mcXVvdDtgXHJcbiAgLy9cclxuICAvLyAqICdzJyBBIHN0cmluZyB0byBiZSBlbmNvZGVkLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHN0cmluZyB0aGF0IGlzIEhUTUwgYXR0cmlidXRlIGVuY29kZWQgYnkgcmVwbGFjaW5nICYsIDwsID4sIFwiIGFuZCAnIHdpdGggdGhlaXIgSFRNTCBlbnRpdHlcclxuICAvLyBuYW1lZCBlcXVpdmFsZW50cy5cclxuICBwdWJsaWMgc3RhdGljIGVuY29kZUhUTUxBdHRyaWJ1dGUoczogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGF0dHJpYnV0ZU1hcDogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcclxuICAgICAgJyYnOiAnJmFtcDsnLFxyXG4gICAgICAnPCc6ICcmbHQ7JyxcclxuICAgICAgJz4nOiAnJmd0OycsXHJcbiAgICAgICdcIic6ICcmcXVvdDsnLFxyXG4gICAgICBcIidcIjogJyZhcG9zOycsXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHMucmVwbGFjZSgvWyY8PidcIl0vZywgKGMpID0+IGF0dHJpYnV0ZU1hcFtjXSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENvbnZlcnQgYW4gQXRvbSBGaWxlIEV2ZW50IGFzIHJlY2VpdmVkIGZyb20gYXRvbS5wcm9qZWN0Lm9uRGlkQ2hhbmdlRmlsZXMgYW5kIGNvbnZlcnRcclxuICAvLyBpdCBpbnRvIGFuIEFycmF5IG9mIExhbmd1YWdlIFNlcnZlciBQcm90b2NvbCB7RmlsZUV2ZW50fSBvYmplY3RzLiBOb3JtYWxseSB0aGlzIHdpbGwgYmUgYSAxLXRvLTFcclxuICAvLyBidXQgcmVuYW1lcyB3aWxsIGJlIHJlcHJlc2VudGVkIGJ5IGEgZGVsZXRpb24gYW5kIGEgc3Vic2VxdWVudCBjcmVhdGlvbiBhcyBMU1AgZG9lcyBub3Qga25vdyBhYm91dFxyXG4gIC8vIHJlbmFtZXMuXHJcbiAgLy9cclxuICAvLyAqICdmaWxlRXZlbnQnIEFuIHthdG9tJFByb2plY3RGaWxlRXZlbnR9IHRvIGJlIGNvbnZlcnRlZC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYW4gYXJyYXkgb2YgTFNQIHtscy5GaWxlRXZlbnR9IG9iamVjdHMgdGhhdCBlcXVpdmFsZW50IGNvbnZlcnNpb25zIHRvIHRoZSBmaWxlRXZlbnQgcGFyYW1ldGVyLlxyXG4gIHB1YmxpYyBzdGF0aWMgYXRvbUZpbGVFdmVudFRvTFNGaWxlRXZlbnRzKGZpbGVFdmVudDogUHJvamVjdEZpbGVFdmVudCk6IGxzLkZpbGVFdmVudFtdIHtcclxuICAgIHN3aXRjaCAoZmlsZUV2ZW50LmFjdGlvbikge1xyXG4gICAgICBjYXNlICdjcmVhdGVkJzpcclxuICAgICAgICByZXR1cm4gW3t1cmk6IENvbnZlcnQucGF0aFRvVXJpKGZpbGVFdmVudC5wYXRoKSwgdHlwZTogbHMuRmlsZUNoYW5nZVR5cGUuQ3JlYXRlZH1dO1xyXG4gICAgICBjYXNlICdtb2RpZmllZCc6XHJcbiAgICAgICAgcmV0dXJuIFt7dXJpOiBDb252ZXJ0LnBhdGhUb1VyaShmaWxlRXZlbnQucGF0aCksIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkNoYW5nZWR9XTtcclxuICAgICAgY2FzZSAnZGVsZXRlZCc6XHJcbiAgICAgICAgcmV0dXJuIFt7dXJpOiBDb252ZXJ0LnBhdGhUb1VyaShmaWxlRXZlbnQucGF0aCksIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkRlbGV0ZWR9XTtcclxuICAgICAgY2FzZSAncmVuYW1lZCc6IHtcclxuICAgICAgICBjb25zdCByZXN1bHRzOiBBcnJheTx7IHVyaTogc3RyaW5nLCB0eXBlOiBscy5GaWxlQ2hhbmdlVHlwZSB9PiA9IFtdO1xyXG4gICAgICAgIGlmIChmaWxlRXZlbnQub2xkUGF0aCkge1xyXG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHt1cmk6IENvbnZlcnQucGF0aFRvVXJpKGZpbGVFdmVudC5vbGRQYXRoIHx8ICcnKSwgdHlwZTogbHMuRmlsZUNoYW5nZVR5cGUuRGVsZXRlZH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZmlsZUV2ZW50LnBhdGgpIHtcclxuICAgICAgICAgIHJlc3VsdHMucHVzaCh7dXJpOiBDb252ZXJ0LnBhdGhUb1VyaShmaWxlRXZlbnQucGF0aCksIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkNyZWF0ZWR9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICAgIH1cclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIGF0b21JZGVEaWFnbm9zdGljVG9MU0RpYWdub3N0aWMoZGlhZ25vc3RpYzogRGlhZ25vc3RpYyk6IGxzLkRpYWdub3N0aWMge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmFuZ2U6IENvbnZlcnQuYXRvbVJhbmdlVG9MU1JhbmdlKGRpYWdub3N0aWMucmFuZ2UpLFxyXG4gICAgICBzZXZlcml0eTogQ29udmVydC5kaWFnbm9zdGljVHlwZVRvTFNTZXZlcml0eShkaWFnbm9zdGljLnR5cGUpLFxyXG4gICAgICBzb3VyY2U6IGRpYWdub3N0aWMucHJvdmlkZXJOYW1lLFxyXG4gICAgICBtZXNzYWdlOiBkaWFnbm9zdGljLnRleHQgfHwgJycsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBkaWFnbm9zdGljVHlwZVRvTFNTZXZlcml0eSh0eXBlOiBEaWFnbm9zdGljVHlwZSk6IGxzLkRpYWdub3N0aWNTZXZlcml0eSB7XHJcbiAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgY2FzZSAnRXJyb3InOlxyXG4gICAgICAgIHJldHVybiBscy5EaWFnbm9zdGljU2V2ZXJpdHkuRXJyb3I7XHJcbiAgICAgIGNhc2UgJ1dhcm5pbmcnOlxyXG4gICAgICAgIHJldHVybiBscy5EaWFnbm9zdGljU2V2ZXJpdHkuV2FybmluZztcclxuICAgICAgY2FzZSAnSW5mbyc6XHJcbiAgICAgICAgcmV0dXJuIGxzLkRpYWdub3N0aWNTZXZlcml0eS5JbmZvcm1hdGlvbjtcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBFcnJvcihgVW5leHBlY3RlZCBkaWFnbm9zdGljIHR5cGUgJHt0eXBlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGFuIGFycmF5IG9mIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCB7VGV4dEVkaXR9IG9iamVjdHMgdG8gYW5cclxuICAvLyBlcXVpdmFsZW50IGFycmF5IG9mIEF0b20ge1RleHRFZGl0fSBvYmplY3RzLlxyXG4gIC8vXHJcbiAgLy8gKiBgdGV4dEVkaXRzYCBUaGUgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sIHtUZXh0RWRpdH0gb2JqZWN0cyB0byBjb252ZXJ0LlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhbiB7QXJyYXl9IG9mIEF0b20ge1RleHRFZGl0fSBvYmplY3RzLlxyXG4gIHB1YmxpYyBzdGF0aWMgY29udmVydExzVGV4dEVkaXRzKHRleHRFZGl0czogbHMuVGV4dEVkaXRbXSk6IFRleHRFZGl0W10ge1xyXG4gICAgcmV0dXJuICh0ZXh0RWRpdHMgfHwgW10pLm1hcChDb252ZXJ0LmNvbnZlcnRMc1RleHRFZGl0KTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ29udmVydCBhIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCB7VGV4dEVkaXR9IG9iamVjdCB0byB0aGVcclxuICAvLyBBdG9tIGVxdWl2YWxlbnQge1RleHRFZGl0fS5cclxuICAvL1xyXG4gIC8vICogYHRleHRFZGl0c2AgVGhlIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCB7VGV4dEVkaXR9IG9iamVjdHMgdG8gY29udmVydC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYW4gQXRvbSB7VGV4dEVkaXR9IG9iamVjdC5cclxuICBwdWJsaWMgc3RhdGljIGNvbnZlcnRMc1RleHRFZGl0KHRleHRFZGl0OiBscy5UZXh0RWRpdCk6IFRleHRFZGl0IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG9sZFJhbmdlOiBDb252ZXJ0LmxzUmFuZ2VUb0F0b21SYW5nZSh0ZXh0RWRpdC5yYW5nZSksXHJcbiAgICAgIG5ld1RleHQ6IHRleHRFZGl0Lm5ld1RleHQsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXX0=
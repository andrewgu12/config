"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ls = require("../lib/languageclient");
const convert_1 = require("../lib/convert");
const atom_1 = require("atom");
const chai_1 = require("chai");
let originalPlatform;
const setProcessPlatform = (platform) => {
    Object.defineProperty(process, 'platform', { value: platform });
};
const createFakeEditor = (path, text) => {
    const editor = new atom_1.TextEditor();
    editor.getBuffer().setPath(path);
    if (text != null) {
        editor.setText(text);
    }
    return editor;
};
describe('Convert', () => {
    beforeEach(() => {
        originalPlatform = process.platform;
    });
    afterEach(() => {
        Object.defineProperty(process, 'platform', { value: originalPlatform });
    });
    describe('pathToUri', () => {
        it('prefixes an absolute path with file://', () => {
            chai_1.expect(convert_1.default.pathToUri('/a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
        });
        it('prefixes an relative path with file:///', () => {
            chai_1.expect(convert_1.default.pathToUri('a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
        }); // TODO: Maybe don't do this in the function - should never be called with relative
        it('replaces backslashes with forward slashes', () => {
            chai_1.expect(convert_1.default.pathToUri('a\\b\\c\\d.txt')).equals('file:///a/b/c/d.txt');
        });
        it('does not encode Windows drive specifiers', () => {
            chai_1.expect(convert_1.default.pathToUri('d:\\ee\\ff.txt')).equals('file:///d:/ee/ff.txt');
        });
        it('URI encodes special characters', () => {
            chai_1.expect(convert_1.default.pathToUri('/a/sp ace/do$lar')).equals('file:///a/sp%20ace/do$lar');
        });
    });
    describe('uriToPath', () => {
        it("does not convert http: and https: uri's", () => {
            setProcessPlatform('darwin');
            chai_1.expect(convert_1.default.uriToPath('http://atom.io/a')).equals('http://atom.io/a');
            chai_1.expect(convert_1.default.uriToPath('https://atom.io/b')).equals('https://atom.io/b');
        });
        it('converts a file:// path to an absolute path', () => {
            setProcessPlatform('darwin');
            chai_1.expect(convert_1.default.uriToPath('file:///a/b/c/d.txt')).equals('/a/b/c/d.txt');
        });
        it('converts forward slashes to backslashes on Windows', () => {
            setProcessPlatform('win32');
            chai_1.expect(convert_1.default.uriToPath('file:///a/b/c/d.txt')).equals('a\\b\\c\\d.txt');
        });
        it('decodes Windows drive specifiers', () => {
            setProcessPlatform('win32');
            chai_1.expect(convert_1.default.uriToPath('file:///d:/ee/ff.txt')).equals('d:\\ee\\ff.txt');
        });
        it('URI decodes special characters', () => {
            setProcessPlatform('darwin');
            chai_1.expect(convert_1.default.uriToPath('file:///a/sp%20ace/do$lar')).equals('/a/sp ace/do$lar');
        });
        it('parses URI without double slash in the beginning', () => {
            setProcessPlatform('darwin');
            chai_1.expect(convert_1.default.uriToPath('file:/a/b/c/d.txt')).equals('/a/b/c/d.txt');
        });
        it('parses URI without double slash in the beginning on Windows', () => {
            setProcessPlatform('win32');
            chai_1.expect(convert_1.default.uriToPath('file:/x:/a/b/c/d.txt')).equals('x:\\a\\b\\c\\d.txt');
        });
    });
    describe('pointToPosition', () => {
        it('converts an Atom Point to a LSP position', () => {
            const point = new atom_1.Point(1, 2);
            const position = convert_1.default.pointToPosition(point);
            chai_1.expect(position.line).equals(point.row);
            chai_1.expect(position.character).equals(point.column);
        });
    });
    describe('positionToPoint', () => {
        it('converts a LSP position to an Atom Point-array', () => {
            const position = { line: 3, character: 4 };
            const point = convert_1.default.positionToPoint(position);
            chai_1.expect(point.row).equals(position.line);
            chai_1.expect(point.column).equals(position.character);
        });
    });
    describe('lsRangeToAtomRange', () => {
        it('converts a LSP range to an Atom Range-array', () => {
            const lspRange = {
                start: { character: 5, line: 6 },
                end: { line: 7, character: 8 },
            };
            const atomRange = convert_1.default.lsRangeToAtomRange(lspRange);
            chai_1.expect(atomRange.start.row).equals(lspRange.start.line);
            chai_1.expect(atomRange.start.column).equals(lspRange.start.character);
            chai_1.expect(atomRange.end.row).equals(lspRange.end.line);
            chai_1.expect(atomRange.end.column).equals(lspRange.end.character);
        });
    });
    describe('atomRangeToLSRange', () => {
        it('converts an Atom range to a LSP Range-array', () => {
            const atomRange = new atom_1.Range(new atom_1.Point(9, 10), new atom_1.Point(11, 12));
            const lspRange = convert_1.default.atomRangeToLSRange(atomRange);
            chai_1.expect(lspRange.start.line).equals(atomRange.start.row);
            chai_1.expect(lspRange.start.character).equals(atomRange.start.column);
            chai_1.expect(lspRange.end.line).equals(atomRange.end.row);
            chai_1.expect(lspRange.end.character).equals(atomRange.end.column);
        });
    });
    describe('editorToTextDocumentIdentifier', () => {
        it('uses getath which returns a path to create the URI', () => {
            const path = '/c/d/e/f/g/h/i/j.txt';
            const identifier = convert_1.default.editorToTextDocumentIdentifier(createFakeEditor(path));
            chai_1.expect(identifier.uri).equals('file://' + path);
        });
    });
    describe('editorToTextDocumentPositionParams', () => {
        it('uses the editor cursor position when none specified', () => {
            const path = '/c/d/e/f/g/h/i/j.txt';
            const editor = createFakeEditor(path, 'abc\ndefgh\nijkl');
            editor.setCursorBufferPosition(new atom_1.Point(1, 2));
            const params = convert_1.default.editorToTextDocumentPositionParams(editor);
            chai_1.expect(params.textDocument.uri).equals('file://' + path);
            chai_1.expect(params.position).deep.equals({ line: 1, character: 2 });
        });
        it('uses the cursor position parameter when specified', () => {
            const path = '/c/d/e/f/g/h/i/j.txt';
            const specifiedPoint = new atom_1.Point(911, 112);
            const editor = createFakeEditor(path, 'abcdef\nghijkl\nmnopq');
            editor.setCursorBufferPosition(new atom_1.Point(1, 1));
            const params = convert_1.default.editorToTextDocumentPositionParams(editor, specifiedPoint);
            chai_1.expect(params.textDocument.uri).equals('file://' + path);
            chai_1.expect(params.position).deep.equals({ line: 911, character: 112 });
        });
    });
    describe('grammarScopesToTextEditorScopes', () => {
        it('converts a single grammarScope to an atom-text-editor scope', () => {
            const grammarScopes = ['abc.def'];
            const textEditorScopes = convert_1.default.grammarScopesToTextEditorScopes(grammarScopes);
            chai_1.expect(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"]');
        });
        it('converts a multiple grammarScopes to a comma-seperated list of atom-text-editor scopes', () => {
            const grammarScopes = ['abc.def', 'ghi.jkl'];
            const textEditorScopes = convert_1.default.grammarScopesToTextEditorScopes(grammarScopes);
            chai_1.expect(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"], atom-text-editor[data-grammar="ghi jkl"]');
        });
        it('converts grammarScopes containing HTML sensitive characters to escaped sequences', () => {
            const grammarScopes = ['abc<def', 'ghi"jkl'];
            const textEditorScopes = convert_1.default.grammarScopesToTextEditorScopes(grammarScopes);
            chai_1.expect(textEditorScopes).equals('atom-text-editor[data-grammar="abc&lt;def"], atom-text-editor[data-grammar="ghi&quot;jkl"]');
        });
    });
    describe('encodeHTMLAttribute', () => {
        it('encodes characters that are not safe inside a HTML attribute', () => {
            const stringToEncode = 'a"b\'c&d>e<f';
            const encoded = convert_1.default.encodeHTMLAttribute(stringToEncode);
            chai_1.expect(encoded).equals('a&quot;b&apos;c&amp;d&gt;e&lt;f');
        });
    });
    describe('atomFileEventToLSFileEvents', () => {
        it('converts a created event', () => {
            const source = { path: '/a/b/c/d.txt', action: 'created' };
            const converted = convert_1.default.atomFileEventToLSFileEvents(source);
            chai_1.expect(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Created });
        });
        it('converts a modified event', () => {
            const source = { path: '/a/b/c/d.txt', action: 'modified' };
            const converted = convert_1.default.atomFileEventToLSFileEvents(source);
            chai_1.expect(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Changed });
        });
        it('converts a deleted event', () => {
            const source = { path: '/a/b/c/d.txt', action: 'deleted' };
            const converted = convert_1.default.atomFileEventToLSFileEvents(source);
            chai_1.expect(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Deleted });
        });
        it('converts a renamed event', () => {
            const source = { path: '/a/b/c/d.txt', oldPath: '/a/z/e.lst', action: 'renamed' };
            const converted = convert_1.default.atomFileEventToLSFileEvents(source);
            chai_1.expect(converted[0]).deep.equals({ uri: 'file:///a/z/e.lst', type: ls.FileChangeType.Deleted });
            chai_1.expect(converted[1]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Created });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdGVzdC9jb252ZXJ0LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0Q0FBNEM7QUFDNUMsNENBQXFDO0FBQ3JDLCtCQUFrRTtBQUNsRSwrQkFBOEI7QUFFOUIsSUFBSSxnQkFBaUMsQ0FBQztBQUN0QyxNQUFNLGtCQUFrQixHQUFHLENBQUMsUUFBYSxFQUFFLEVBQUU7SUFDM0MsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLEVBQUMsS0FBSyxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUM7QUFDaEUsQ0FBQyxDQUFDO0FBRUYsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLElBQVksRUFBRSxJQUFhLEVBQWMsRUFBRTtJQUNuRSxNQUFNLE1BQU0sR0FBRyxJQUFJLGlCQUFVLEVBQUUsQ0FBQztJQUNoQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pDLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUNELE1BQU0sQ0FBQyxNQUFNLENBQUM7QUFDaEIsQ0FBQyxDQUFDO0FBRUYsUUFBUSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7SUFDdkIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFDSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLEVBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFDLENBQUMsQ0FBQztJQUN4RSxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxXQUFXLEVBQUUs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UyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFDLEdBQUcsRUFBRSxxQkFBcUIsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBQ2xHLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGxzIGZyb20gJy4uL2xpYi9sYW5ndWFnZWNsaWVudCc7XHJcbmltcG9ydCBDb252ZXJ0IGZyb20gJy4uL2xpYi9jb252ZXJ0JztcclxuaW1wb3J0IHsgUG9pbnQsIFByb2plY3RGaWxlRXZlbnQsIFJhbmdlLCBUZXh0RWRpdG9yIH0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7IGV4cGVjdCB9IGZyb20gJ2NoYWknO1xyXG5cclxubGV0IG9yaWdpbmFsUGxhdGZvcm06IE5vZGVKUy5QbGF0Zm9ybTtcclxuY29uc3Qgc2V0UHJvY2Vzc1BsYXRmb3JtID0gKHBsYXRmb3JtOiBhbnkpID0+IHtcclxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvY2VzcywgJ3BsYXRmb3JtJywge3ZhbHVlOiBwbGF0Zm9ybX0pO1xyXG59O1xyXG5cclxuY29uc3QgY3JlYXRlRmFrZUVkaXRvciA9IChwYXRoOiBzdHJpbmcsIHRleHQ/OiBzdHJpbmcpOiBUZXh0RWRpdG9yID0+IHtcclxuICBjb25zdCBlZGl0b3IgPSBuZXcgVGV4dEVkaXRvcigpO1xyXG4gIGVkaXRvci5nZXRCdWZmZXIoKS5zZXRQYXRoKHBhdGgpO1xyXG4gIGlmICh0ZXh0ICE9IG51bGwpIHtcclxuICAgIGVkaXRvci5zZXRUZXh0KHRleHQpO1xyXG4gIH1cclxuICByZXR1cm4gZWRpdG9yO1xyXG59O1xyXG5cclxuZGVzY3JpYmUoJ0NvbnZlcnQnLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBvcmlnaW5hbFBsYXRmb3JtID0gcHJvY2Vzcy5wbGF0Zm9ybTtcclxuICB9KTtcclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHt2YWx1ZTogb3JpZ2luYWxQbGF0Zm9ybX0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncGF0aFRvVXJpJywgKCkgPT4ge1xyXG4gICAgaXQoJ3ByZWZpeGVzIGFuIGFic29sdXRlIHBhdGggd2l0aCBmaWxlOi8vJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoQ29udmVydC5wYXRoVG9VcmkoJy9hL2IvYy9kLnR4dCcpKS5lcXVhbHMoJ2ZpbGU6Ly8vYS9iL2MvZC50eHQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdwcmVmaXhlcyBhbiByZWxhdGl2ZSBwYXRoIHdpdGggZmlsZTovLy8nLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnYS9iL2MvZC50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2EvYi9jL2QudHh0Jyk7XHJcbiAgICB9KTsgLy8gVE9ETzogTWF5YmUgZG9uJ3QgZG8gdGhpcyBpbiB0aGUgZnVuY3Rpb24gLSBzaG91bGQgbmV2ZXIgYmUgY2FsbGVkIHdpdGggcmVsYXRpdmVcclxuXHJcbiAgICBpdCgncmVwbGFjZXMgYmFja3NsYXNoZXMgd2l0aCBmb3J3YXJkIHNsYXNoZXMnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnYVxcXFxiXFxcXGNcXFxcZC50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2EvYi9jL2QudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZG9lcyBub3QgZW5jb2RlIFdpbmRvd3MgZHJpdmUgc3BlY2lmaWVycycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KENvbnZlcnQucGF0aFRvVXJpKCdkOlxcXFxlZVxcXFxmZi50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2Q6L2VlL2ZmLnR4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ1VSSSBlbmNvZGVzIHNwZWNpYWwgY2hhcmFjdGVycycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KENvbnZlcnQucGF0aFRvVXJpKCcvYS9zcCBhY2UvZG8kbGFyJykpLmVxdWFscygnZmlsZTovLy9hL3NwJTIwYWNlL2RvJGxhcicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd1cmlUb1BhdGgnLCAoKSA9PiB7XHJcbiAgICBpdChcImRvZXMgbm90IGNvbnZlcnQgaHR0cDogYW5kIGh0dHBzOiB1cmknc1wiLCAoKSA9PiB7XHJcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnZGFyd2luJyk7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnaHR0cDovL2F0b20uaW8vYScpKS5lcXVhbHMoJ2h0dHA6Ly9hdG9tLmlvL2EnKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdodHRwczovL2F0b20uaW8vYicpKS5lcXVhbHMoJ2h0dHBzOi8vYXRvbS5pby9iJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgYSBmaWxlOi8vIHBhdGggdG8gYW4gYWJzb2x1dGUgcGF0aCcsICgpID0+IHtcclxuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCdkYXJ3aW4nKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2EvYi9jL2QudHh0JykpLmVxdWFscygnL2EvYi9jL2QudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgZm9yd2FyZCBzbGFzaGVzIHRvIGJhY2tzbGFzaGVzIG9uIFdpbmRvd3MnLCAoKSA9PiB7XHJcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnd2luMzInKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2EvYi9jL2QudHh0JykpLmVxdWFscygnYVxcXFxiXFxcXGNcXFxcZC50eHQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWNvZGVzIFdpbmRvd3MgZHJpdmUgc3BlY2lmaWVycycsICgpID0+IHtcclxuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCd3aW4zMicpO1xyXG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2ZpbGU6Ly8vZDovZWUvZmYudHh0JykpLmVxdWFscygnZDpcXFxcZWVcXFxcZmYudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnVVJJIGRlY29kZXMgc3BlY2lhbCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xyXG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ2RhcndpbicpO1xyXG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2ZpbGU6Ly8vYS9zcCUyMGFjZS9kbyRsYXInKSkuZXF1YWxzKCcvYS9zcCBhY2UvZG8kbGFyJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncGFyc2VzIFVSSSB3aXRob3V0IGRvdWJsZSBzbGFzaCBpbiB0aGUgYmVnaW5uaW5nJywgKCkgPT4ge1xyXG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ2RhcndpbicpO1xyXG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2ZpbGU6L2EvYi9jL2QudHh0JykpLmVxdWFscygnL2EvYi9jL2QudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncGFyc2VzIFVSSSB3aXRob3V0IGRvdWJsZSBzbGFzaCBpbiB0aGUgYmVnaW5uaW5nIG9uIFdpbmRvd3MnLCAoKSA9PiB7XHJcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnd2luMzInKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi94Oi9hL2IvYy9kLnR4dCcpKS5lcXVhbHMoJ3g6XFxcXGFcXFxcYlxcXFxjXFxcXGQudHh0Jyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3BvaW50VG9Qb3NpdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhbiBBdG9tIFBvaW50IHRvIGEgTFNQIHBvc2l0aW9uJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwb2ludCA9IG5ldyBQb2ludCgxLCAyKTtcclxuICAgICAgY29uc3QgcG9zaXRpb24gPSBDb252ZXJ0LnBvaW50VG9Qb3NpdGlvbihwb2ludCk7XHJcbiAgICAgIGV4cGVjdChwb3NpdGlvbi5saW5lKS5lcXVhbHMocG9pbnQucm93KTtcclxuICAgICAgZXhwZWN0KHBvc2l0aW9uLmNoYXJhY3RlcikuZXF1YWxzKHBvaW50LmNvbHVtbik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3Bvc2l0aW9uVG9Qb2ludCcsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhIExTUCBwb3NpdGlvbiB0byBhbiBBdG9tIFBvaW50LWFycmF5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwb3NpdGlvbiA9IHtsaW5lOiAzLCBjaGFyYWN0ZXI6IDR9O1xyXG4gICAgICBjb25zdCBwb2ludCA9IENvbnZlcnQucG9zaXRpb25Ub1BvaW50KHBvc2l0aW9uKTtcclxuICAgICAgZXhwZWN0KHBvaW50LnJvdykuZXF1YWxzKHBvc2l0aW9uLmxpbmUpO1xyXG4gICAgICBleHBlY3QocG9pbnQuY29sdW1uKS5lcXVhbHMocG9zaXRpb24uY2hhcmFjdGVyKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnbHNSYW5nZVRvQXRvbVJhbmdlJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIGEgTFNQIHJhbmdlIHRvIGFuIEF0b20gUmFuZ2UtYXJyYXknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxzcFJhbmdlID0ge1xyXG4gICAgICAgIHN0YXJ0OiB7Y2hhcmFjdGVyOiA1LCBsaW5lOiA2fSxcclxuICAgICAgICBlbmQ6IHtsaW5lOiA3LCBjaGFyYWN0ZXI6IDh9LFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBhdG9tUmFuZ2UgPSBDb252ZXJ0LmxzUmFuZ2VUb0F0b21SYW5nZShsc3BSYW5nZSk7XHJcbiAgICAgIGV4cGVjdChhdG9tUmFuZ2Uuc3RhcnQucm93KS5lcXVhbHMobHNwUmFuZ2Uuc3RhcnQubGluZSk7XHJcbiAgICAgIGV4cGVjdChhdG9tUmFuZ2Uuc3RhcnQuY29sdW1uKS5lcXVhbHMobHNwUmFuZ2Uuc3RhcnQuY2hhcmFjdGVyKTtcclxuICAgICAgZXhwZWN0KGF0b21SYW5nZS5lbmQucm93KS5lcXVhbHMobHNwUmFuZ2UuZW5kLmxpbmUpO1xyXG4gICAgICBleHBlY3QoYXRvbVJhbmdlLmVuZC5jb2x1bW4pLmVxdWFscyhsc3BSYW5nZS5lbmQuY2hhcmFjdGVyKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnYXRvbVJhbmdlVG9MU1JhbmdlJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIGFuIEF0b20gcmFuZ2UgdG8gYSBMU1AgUmFuZ2UtYXJyYXknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGF0b21SYW5nZSA9IG5ldyBSYW5nZShuZXcgUG9pbnQoOSwgMTApLCBuZXcgUG9pbnQoMTEsIDEyKSk7XHJcbiAgICAgIGNvbnN0IGxzcFJhbmdlID0gQ29udmVydC5hdG9tUmFuZ2VUb0xTUmFuZ2UoYXRvbVJhbmdlKTtcclxuICAgICAgZXhwZWN0KGxzcFJhbmdlLnN0YXJ0LmxpbmUpLmVxdWFscyhhdG9tUmFuZ2Uuc3RhcnQucm93KTtcclxuICAgICAgZXhwZWN0KGxzcFJhbmdlLnN0YXJ0LmNoYXJhY3RlcikuZXF1YWxzKGF0b21SYW5nZS5zdGFydC5jb2x1bW4pO1xyXG4gICAgICBleHBlY3QobHNwUmFuZ2UuZW5kLmxpbmUpLmVxdWFscyhhdG9tUmFuZ2UuZW5kLnJvdyk7XHJcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5lbmQuY2hhcmFjdGVyKS5lcXVhbHMoYXRvbVJhbmdlLmVuZC5jb2x1bW4pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdlZGl0b3JUb1RleHREb2N1bWVudElkZW50aWZpZXInLCAoKSA9PiB7XHJcbiAgICBpdCgndXNlcyBnZXRhdGggd2hpY2ggcmV0dXJucyBhIHBhdGggdG8gY3JlYXRlIHRoZSBVUkknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdGggPSAnL2MvZC9lL2YvZy9oL2kvai50eHQnO1xyXG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gQ29udmVydC5lZGl0b3JUb1RleHREb2N1bWVudElkZW50aWZpZXIoY3JlYXRlRmFrZUVkaXRvcihwYXRoKSk7XHJcbiAgICAgIGV4cGVjdChpZGVudGlmaWVyLnVyaSkuZXF1YWxzKCdmaWxlOi8vJyArIHBhdGgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdlZGl0b3JUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zJywgKCkgPT4ge1xyXG4gICAgaXQoJ3VzZXMgdGhlIGVkaXRvciBjdXJzb3IgcG9zaXRpb24gd2hlbiBub25lIHNwZWNpZmllZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcGF0aCA9ICcvYy9kL2UvZi9nL2gvaS9qLnR4dCc7XHJcbiAgICAgIGNvbnN0IGVkaXRvciA9IGNyZWF0ZUZha2VFZGl0b3IocGF0aCwgJ2FiY1xcbmRlZmdoXFxuaWprbCcpO1xyXG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24obmV3IFBvaW50KDEsIDIpKTtcclxuICAgICAgY29uc3QgcGFyYW1zID0gQ29udmVydC5lZGl0b3JUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zKGVkaXRvcik7XHJcbiAgICAgIGV4cGVjdChwYXJhbXMudGV4dERvY3VtZW50LnVyaSkuZXF1YWxzKCdmaWxlOi8vJyArIHBhdGgpO1xyXG4gICAgICBleHBlY3QocGFyYW1zLnBvc2l0aW9uKS5kZWVwLmVxdWFscyh7bGluZTogMSwgY2hhcmFjdGVyOiAyfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgndXNlcyB0aGUgY3Vyc29yIHBvc2l0aW9uIHBhcmFtZXRlciB3aGVuIHNwZWNpZmllZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcGF0aCA9ICcvYy9kL2UvZi9nL2gvaS9qLnR4dCc7XHJcbiAgICAgIGNvbnN0IHNwZWNpZmllZFBvaW50ID0gbmV3IFBvaW50KDkxMSwgMTEyKTtcclxuICAgICAgY29uc3QgZWRpdG9yID0gY3JlYXRlRmFrZUVkaXRvcihwYXRoLCAnYWJjZGVmXFxuZ2hpamtsXFxubW5vcHEnKTtcclxuICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKG5ldyBQb2ludCgxLCAxKSk7XHJcbiAgICAgIGNvbnN0IHBhcmFtcyA9IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyhlZGl0b3IsIHNwZWNpZmllZFBvaW50KTtcclxuICAgICAgZXhwZWN0KHBhcmFtcy50ZXh0RG9jdW1lbnQudXJpKS5lcXVhbHMoJ2ZpbGU6Ly8nICsgcGF0aCk7XHJcbiAgICAgIGV4cGVjdChwYXJhbXMucG9zaXRpb24pLmRlZXAuZXF1YWxzKHtsaW5lOiA5MTEsIGNoYXJhY3RlcjogMTEyfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgYSBzaW5nbGUgZ3JhbW1hclNjb3BlIHRvIGFuIGF0b20tdGV4dC1lZGl0b3Igc2NvcGUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGdyYW1tYXJTY29wZXMgPSBbJ2FiYy5kZWYnXTtcclxuICAgICAgY29uc3QgdGV4dEVkaXRvclNjb3BlcyA9IENvbnZlcnQuZ3JhbW1hclNjb3Blc1RvVGV4dEVkaXRvclNjb3BlcyhncmFtbWFyU2NvcGVzKTtcclxuICAgICAgZXhwZWN0KHRleHRFZGl0b3JTY29wZXMpLmVxdWFscygnYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCJhYmMgZGVmXCJdJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgYSBtdWx0aXBsZSBncmFtbWFyU2NvcGVzIHRvIGEgY29tbWEtc2VwZXJhdGVkIGxpc3Qgb2YgYXRvbS10ZXh0LWVkaXRvciBzY29wZXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGdyYW1tYXJTY29wZXMgPSBbJ2FiYy5kZWYnLCAnZ2hpLmprbCddO1xyXG4gICAgICBjb25zdCB0ZXh0RWRpdG9yU2NvcGVzID0gQ29udmVydC5ncmFtbWFyU2NvcGVzVG9UZXh0RWRpdG9yU2NvcGVzKGdyYW1tYXJTY29wZXMpO1xyXG4gICAgICBleHBlY3QodGV4dEVkaXRvclNjb3BlcykuZXF1YWxzKFxyXG4gICAgICAgICdhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj1cImFiYyBkZWZcIl0sIGF0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiZ2hpIGprbFwiXScsXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgZ3JhbW1hclNjb3BlcyBjb250YWluaW5nIEhUTUwgc2Vuc2l0aXZlIGNoYXJhY3RlcnMgdG8gZXNjYXBlZCBzZXF1ZW5jZXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGdyYW1tYXJTY29wZXMgPSBbJ2FiYzxkZWYnLCAnZ2hpXCJqa2wnXTtcclxuICAgICAgY29uc3QgdGV4dEVkaXRvclNjb3BlcyA9IENvbnZlcnQuZ3JhbW1hclNjb3Blc1RvVGV4dEVkaXRvclNjb3BlcyhncmFtbWFyU2NvcGVzKTtcclxuICAgICAgZXhwZWN0KHRleHRFZGl0b3JTY29wZXMpLmVxdWFscyhcclxuICAgICAgICAnYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCJhYmMmbHQ7ZGVmXCJdLCBhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj1cImdoaSZxdW90O2prbFwiXScsXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2VuY29kZUhUTUxBdHRyaWJ1dGUnLCAoKSA9PiB7XHJcbiAgICBpdCgnZW5jb2RlcyBjaGFyYWN0ZXJzIHRoYXQgYXJlIG5vdCBzYWZlIGluc2lkZSBhIEhUTUwgYXR0cmlidXRlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdHJpbmdUb0VuY29kZSA9ICdhXCJiXFwnYyZkPmU8Zic7XHJcbiAgICAgIGNvbnN0IGVuY29kZWQgPSBDb252ZXJ0LmVuY29kZUhUTUxBdHRyaWJ1dGUoc3RyaW5nVG9FbmNvZGUpO1xyXG4gICAgICBleHBlY3QoZW5jb2RlZCkuZXF1YWxzKCdhJnF1b3Q7YiZhcG9zO2MmYW1wO2QmZ3Q7ZSZsdDtmJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2F0b21GaWxlRXZlbnRUb0xTRmlsZUV2ZW50cycsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhIGNyZWF0ZWQgZXZlbnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvdXJjZTogUHJvamVjdEZpbGVFdmVudCA9IHtwYXRoOiAnL2EvYi9jL2QudHh0JywgYWN0aW9uOiAnY3JlYXRlZCd9O1xyXG4gICAgICBjb25zdCBjb252ZXJ0ZWQgPSBDb252ZXJ0LmF0b21GaWxlRXZlbnRUb0xTRmlsZUV2ZW50cyhzb3VyY2UpO1xyXG4gICAgICBleHBlY3QoY29udmVydGVkWzBdKS5kZWVwLmVxdWFscyh7dXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCcsIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkNyZWF0ZWR9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBhIG1vZGlmaWVkIGV2ZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzb3VyY2U6IFByb2plY3RGaWxlRXZlbnQgPSB7cGF0aDogJy9hL2IvYy9kLnR4dCcsIGFjdGlvbjogJ21vZGlmaWVkJ307XHJcbiAgICAgIGNvbnN0IGNvbnZlcnRlZCA9IENvbnZlcnQuYXRvbUZpbGVFdmVudFRvTFNGaWxlRXZlbnRzKHNvdXJjZSk7XHJcbiAgICAgIGV4cGVjdChjb252ZXJ0ZWRbMF0pLmRlZXAuZXF1YWxzKHt1cmk6ICdmaWxlOi8vL2EvYi9jL2QudHh0JywgdHlwZTogbHMuRmlsZUNoYW5nZVR5cGUuQ2hhbmdlZH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIGEgZGVsZXRlZCBldmVudCcsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlOiBQcm9qZWN0RmlsZUV2ZW50ID0ge3BhdGg6ICcvYS9iL2MvZC50eHQnLCBhY3Rpb246ICdkZWxldGVkJ307XHJcbiAgICAgIGNvbnN0IGNvbnZlcnRlZCA9IENvbnZlcnQuYXRvbUZpbGVFdmVudFRvTFNGaWxlRXZlbnRzKHNvdXJjZSk7XHJcbiAgICAgIGV4cGVjdChjb252ZXJ0ZWRbMF0pLmRlZXAuZXF1YWxzKHt1cmk6ICdmaWxlOi8vL2EvYi9jL2QudHh0JywgdHlwZTogbHMuRmlsZUNoYW5nZVR5cGUuRGVsZXRlZH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIGEgcmVuYW1lZCBldmVudCcsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlOiBQcm9qZWN0RmlsZUV2ZW50ID0ge3BhdGg6ICcvYS9iL2MvZC50eHQnLCBvbGRQYXRoOiAnL2Evei9lLmxzdCcsIGFjdGlvbjogJ3JlbmFtZWQnfTtcclxuICAgICAgY29uc3QgY29udmVydGVkID0gQ29udmVydC5hdG9tRmlsZUV2ZW50VG9MU0ZpbGVFdmVudHMoc291cmNlKTtcclxuICAgICAgZXhwZWN0KGNvbnZlcnRlZFswXSkuZGVlcC5lcXVhbHMoe3VyaTogJ2ZpbGU6Ly8vYS96L2UubHN0JywgdHlwZTogbHMuRmlsZUNoYW5nZVR5cGUuRGVsZXRlZH0pO1xyXG4gICAgICBleHBlY3QoY29udmVydGVkWzFdKS5kZWVwLmVxdWFscyh7dXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCcsIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkNyZWF0ZWR9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl19
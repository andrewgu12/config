var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _autocompleteAdapter = require('../../lib/adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _atom = require('atom');

var _chai = require('chai');

var _helpers = require('../helpers.js');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('AutoCompleteAdapter', () => {
  beforeEach(() => {
    global.sinon = _sinon2.default.sandbox.create();
  });
  afterEach(() => {
    global.sinon.restore();
  });

  const request = {
    editor: (0, _helpers.createFakeEditor)(),
    bufferPosition: new _atom.Point(123, 456),
    prefix: 'def',
    scopeDescriptor: 'some.scope'
  };

  const completionItems = [{
    label: 'label1',
    kind: ls.CompletionItemKind.Keyword,
    detail: 'description1',
    documentation: 'a very exciting keyword',
    sortText: 'z'
  }, {
    label: 'label2',
    kind: ls.CompletionItemKind.Field,
    detail: 'description2',
    documentation: 'a very exciting field',
    sortText: 'a'
  }, {
    label: 'label3',
    kind: ls.CompletionItemKind.Variable,
    detail: 'description3',
    documentation: 'a very exciting variable'
  }];

  describe('getSuggestions', () => {
    const fakeLanguageClient = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
    _sinon2.default.stub(fakeLanguageClient, 'completion').resolves(completionItems);

    it('gets AutoComplete suggestions via LSP given an AutoCompleteRequest', async () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = await autoCompleteAdapter.getSuggestions(fakeLanguageClient, request);
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0].text).equals('label2');
      (0, _chai.expect)(results[1].description).equals('a very exciting variable');
      (0, _chai.expect)(results[2].type).equals('keyword');
    });
  });

  describe('completeSuggestion', () => {
    const partialItems = [{
      label: 'label1',
      kind: ls.CompletionItemKind.Keyword,
      sortText: 'z'
    }, {
      label: 'label2',
      kind: ls.CompletionItemKind.Field,
      sortText: 'a'
    }, {
      label: 'label3',
      kind: ls.CompletionItemKind.Variable
    }];

    const fakeLanguageClient = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
    _sinon2.default.stub(fakeLanguageClient, 'completion').resolves(partialItems);
    _sinon2.default.stub(fakeLanguageClient, 'completionItemResolve').resolves({
      label: 'label3',
      kind: ls.CompletionItemKind.Variable,
      detail: 'description3',
      documentation: 'a very exciting variable'
    });

    it('resolves suggestions via LSP given an AutoCompleteRequest', async () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = await autoCompleteAdapter.getSuggestions(fakeLanguageClient, request);
      (0, _chai.expect)(results[2].description).equals(undefined);
      const resolvedItem = await autoCompleteAdapter.completeSuggestion(fakeLanguageClient, results[2], request);
      (0, _chai.expect)(resolvedItem.description).equals('a very exciting variable');
    });
  });

  describe('requestToTextDocumentPositionParams', () => {
    it('creates a TextDocumentPositionParams from an AutocompleteRequest', () => {
      const result = _autocompleteAdapter2.default.requestToTextDocumentPositionParams(request);
      (0, _chai.expect)(result.textDocument.uri).equals('file:///a/b/c/d.js');
      (0, _chai.expect)(result.position).deep.equals({ line: 123, character: 456 });
    });
  });

  describe('completionItemsToSuggestions', () => {
    it('converts LSP CompletionItem array to AutoComplete Suggestions array', () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = Array.from(autoCompleteAdapter.completionItemsToSuggestions(completionItems, request));
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0][0].text).equals('label2');
      (0, _chai.expect)(results[1][0].description).equals('a very exciting variable');
      (0, _chai.expect)(results[2][0].type).equals('keyword');
    });

    it('converts LSP CompletionList to AutoComplete Suggestions array', () => {
      const completionList = { items: completionItems, isIncomplete: false };
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = Array.from(autoCompleteAdapter.completionItemsToSuggestions(completionList, request));
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0][0].description).equals('a very exciting field');
      (0, _chai.expect)(results[1][0].text).equals('label3');
    });

    it('converts LSP CompletionList to AutoComplete Suggestions array using the onDidConvertCompletionItem', () => {
      const completionList = { items: completionItems, isIncomplete: false };
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = Array.from(autoCompleteAdapter.completionItemsToSuggestions(completionList, request, (c, a, r) => {
        a.text = c.label + ' ok';
        a.displayText = r.scopeDescriptor;
      }));
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0][0].displayText).equals('some.scope');
      (0, _chai.expect)(results[1][0].text).equals('label3 ok');
    });

    it('converts empty array into an empty AutoComplete Suggestions array', () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = Array.from(autoCompleteAdapter.completionItemsToSuggestions([], request));
      (0, _chai.expect)(results.length).equals(0);
    });
  });

  describe('completionItemToSuggestion', () => {
    it('converts LSP CompletionItem to AutoComplete Suggestion without textEdit', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'keyword',
        documentation: 'a truly useful keyword'
      };
      const result = {};
      _autocompleteAdapter2.default.completionItemToSuggestion(completionItem, result, request);
      (0, _chai.expect)(result.text).equals('insert');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('keyword');
      (0, _chai.expect)(result.description).equals('a truly useful keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a truly useful keyword');
    });

    it('converts LSP CompletionItem to AutoComplete Suggestion with textEdit', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Variable,
        detail: 'number',
        documentation: 'a truly useful variable',
        textEdit: {
          range: {
            start: { line: 10, character: 20 },
            end: { line: 30, character: 40 }
          },
          newText: 'newText'
        }
      };
      const autocompleteRequest = {
        editor: (0, _helpers.createFakeEditor)(),
        bufferPosition: new _atom.Point(123, 456),
        prefix: 'def',
        scopeDescriptor: 'some.scope'
      };
      _sinon2.default.stub(autocompleteRequest.editor, 'getTextInBufferRange').returns('replacementPrefix');
      const result = {};
      _autocompleteAdapter2.default.completionItemToSuggestion(completionItem, result, autocompleteRequest);
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('variable');
      (0, _chai.expect)(result.rightLabel).equals('number');
      (0, _chai.expect)(result.description).equals('a truly useful variable');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a truly useful variable');
      (0, _chai.expect)(result.replacementPrefix).equals('replacementPrefix');
      (0, _chai.expect)(result.text).equals('newText');
      (0, _chai.expect)(autocompleteRequest.editor.getTextInBufferRange.calledOnce).equals(true);
      (0, _chai.expect)(autocompleteRequest.editor.getTextInBufferRange.getCall(0).args).deep.equals([new _atom.Range(new _atom.Point(10, 20), new _atom.Point(30, 40))]);
    });
  });

  describe('basicCompletionItemToSuggestion', () => {
    it('converts LSP CompletionItem with insertText and filterText to AutoComplete Suggestion', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'detail',
        documentation: 'a very exciting keyword'
      };
      const result = {};
      _autocompleteAdapter2.default.applyCompletionItemToSuggestion(completionItem, result);
      (0, _chai.expect)(result.text).equals('insert');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('detail');
      (0, _chai.expect)(result.description).equals('a very exciting keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a very exciting keyword');
    });

    it('converts LSP CompletionItem without insertText or filterText to AutoComplete Suggestion', () => {
      const completionItem = {
        label: 'label',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'detail',
        documentation: 'A very useful keyword'
      };
      const result = {};
      _autocompleteAdapter2.default.applyCompletionItemToSuggestion(completionItem, result);
      (0, _chai.expect)(result.text).equals('label');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('detail');
      (0, _chai.expect)(result.description).equals('A very useful keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('A very useful keyword');
    });
  });

  describe('applyTextEditToSuggestion', () => {
    const basicCompletionItem = {
      label: 'label',
      kind: ls.CompletionItemKind.Keyword,
      detail: 'detail',
      documentation: 'An incredible keyword'
    };

    it('does not do anything if there is no textEdit', () => {
      const completionItem = _extends({}, basicCompletionItem);
      _autocompleteAdapter2.default.applyTextEditToSuggestion(null, new _atom.TextEditor(), completionItem);
      (0, _chai.expect)(completionItem).deep.equals(basicCompletionItem);
    });

    it('applies changes from TextEdit to replacementPrefix and text', () => {
      const textEdit = {
        range: {
          start: { line: 1, character: 2 },
          end: { line: 3, character: 4 }
        },
        newText: 'newText'
      };
      const editor = new _atom.TextEditor();
      _sinon2.default.stub(editor, 'getTextInBufferRange').returns('replacementPrefix');

      const completionItem = _extends({}, basicCompletionItem);
      _autocompleteAdapter2.default.applyTextEditToSuggestion(textEdit, editor, completionItem);
      (0, _chai.expect)(completionItem.replacementPrefix).equals('replacementPrefix');
      (0, _chai.expect)(completionItem.text).equals('newText');
      (0, _chai.expect)(editor.getTextInBufferRange.calledOnce).equals(true);
      (0, _chai.expect)(editor.getTextInBufferRange.getCall(0).args).deep.equals([new _atom.Range(new _atom.Point(1, 2), new _atom.Point(3, 4))]);
    });
  });

  describe('completionKindToSuggestionType', () => {
    it('converts LSP CompletionKinds to AutoComplete SuggestionTypes', () => {
      const variable = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Variable);
      const constructor = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Constructor);
      const module = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Module);
      (0, _chai.expect)(variable).equals('variable');
      (0, _chai.expect)(constructor).equals('function');
      (0, _chai.expect)(module).equals('module');
    });

    it('defaults to "value"', () => {
      const result = _autocompleteAdapter2.default.completionKindToSuggestionType(null);
      (0, _chai.expect)(result).equals('value');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJscyIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsImdsb2JhbCIsInNpbm9uIiwic2FuZGJveCIsImNyZWF0ZSIsImFmdGVyRWFjaCIsInJlc3RvcmUiLCJyZXF1ZXN0IiwiZWRpdG9yIiwiYnVmZmVyUG9zaXRpb24iLCJwcmVmaXgiLCJzY29wZURlc2NyaXB0b3IiLCJjb21wbGV0aW9uSXRlbXMiLCJsYWJlbCIsImtpbmQiLCJDb21wbGV0aW9uSXRlbUtpbmQiLCJLZXl3b3JkIiwiZGV0YWlsIiwiZG9jdW1lbnRhdGlvbiIsInNvcnRUZXh0IiwiRmllbGQiLCJWYXJpYWJsZSIsImZha2VMYW5ndWFnZUNsaWVudCIsIkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiIsInN0dWIiLCJyZXNvbHZlcyIsIml0IiwiYXV0b0NvbXBsZXRlQWRhcHRlciIsInJlc3VsdHMiLCJnZXRTdWdnZXN0aW9ucyIsImxlbmd0aCIsImVxdWFscyIsInRleHQiLCJkZXNjcmlwdGlvbiIsInR5cGUiLCJwYXJ0aWFsSXRlbXMiLCJ1bmRlZmluZWQiLCJyZXNvbHZlZEl0ZW0iLCJjb21wbGV0ZVN1Z2dlc3Rpb24iLCJyZXN1bHQiLCJyZXF1ZXN0VG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyIsInRleHREb2N1bWVudCIsInVyaSIsInBvc2l0aW9uIiwiZGVlcCIsImxpbmUiLCJjaGFyYWN0ZXIiLCJBcnJheSIsImZyb20iLCJjb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zIiwiY29tcGxldGlvbkxpc3QiLCJpdGVtcyIsImlzSW5jb21wbGV0ZSIsImMiLCJhIiwiciIsImRpc3BsYXlUZXh0IiwiY29tcGxldGlvbkl0ZW0iLCJpbnNlcnRUZXh0IiwiZmlsdGVyVGV4dCIsImNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uIiwicmlnaHRMYWJlbCIsImRlc2NyaXB0aW9uTWFya2Rvd24iLCJ0ZXh0RWRpdCIsInJhbmdlIiwic3RhcnQiLCJlbmQiLCJuZXdUZXh0IiwiYXV0b2NvbXBsZXRlUmVxdWVzdCIsInJldHVybnMiLCJyZXBsYWNlbWVudFByZWZpeCIsImdldFRleHRJbkJ1ZmZlclJhbmdlIiwiY2FsbGVkT25jZSIsImdldENhbGwiLCJhcmdzIiwiYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbiIsImJhc2ljQ29tcGxldGlvbkl0ZW0iLCJhcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uIiwidmFyaWFibGUiLCJjb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUiLCJjb25zdHJ1Y3RvciIsIkNvbnN0cnVjdG9yIiwibW9kdWxlIiwiTW9kdWxlIl0sIm1hcHBpbmdzIjoiOztBQUVBOzs7O0FBQ0E7O0lBQVlBLEU7O0FBQ1o7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBRUFDLFNBQVMscUJBQVQsRUFBZ0MsTUFBTTtBQUNwQ0MsYUFBVyxNQUFNO0FBQ2ZDLFdBQU9DLEtBQVAsR0FBZSxnQkFBTUMsT0FBTixDQUFjQyxNQUFkLEVBQWY7QUFDRCxHQUZEO0FBR0FDLFlBQVUsTUFBTTtBQUNkSixXQUFPQyxLQUFQLENBQWFJLE9BQWI7QUFDRCxHQUZEOztBQUlBLFFBQU1DLFVBQW9DO0FBQ3hDQyxZQUFRLGdDQURnQztBQUV4Q0Msb0JBQWdCLGdCQUFVLEdBQVYsRUFBZSxHQUFmLENBRndCO0FBR3hDQyxZQUFRLEtBSGdDO0FBSXhDQyxxQkFBaUI7QUFKdUIsR0FBMUM7O0FBT0EsUUFBTUMsa0JBQWtCLENBQ3RCO0FBQ0VDLFdBQU8sUUFEVDtBQUVFQyxVQUFNaEIsR0FBR2lCLGtCQUFILENBQXNCQyxPQUY5QjtBQUdFQyxZQUFRLGNBSFY7QUFJRUMsbUJBQWUseUJBSmpCO0FBS0VDLGNBQVU7QUFMWixHQURzQixFQVF0QjtBQUNFTixXQUFPLFFBRFQ7QUFFRUMsVUFBTWhCLEdBQUdpQixrQkFBSCxDQUFzQkssS0FGOUI7QUFHRUgsWUFBUSxjQUhWO0FBSUVD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QVMsOEJBQW9Cd0MsOEJBQXBCLENBQW1ELElBQW5ELENBQWY7QUFDQSx3QkFBT3hDLE1BQVAsRUFBZVIsTUFBZixDQUFzQixPQUF0QjtBQUNELEtBSEQ7QUFJRCxHQWREO0FBZUQsQ0F4UkQiLCJmaWxlIjoiYXV0b2NvbXBsZXRlLWFkYXB0ZXIudGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XHJcblxyXG5pbXBvcnQgQXV0b0NvbXBsZXRlQWRhcHRlciBmcm9tICcuLi8uLi9saWIvYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXInO1xyXG5pbXBvcnQgKiBhcyBscyBmcm9tICcuLi8uLi9saWIvbGFuZ3VhZ2VjbGllbnQnO1xyXG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xyXG5pbXBvcnQge1BvaW50LCBSYW5nZSwgVGV4dEVkaXRvcn0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJztcclxuaW1wb3J0IHtjcmVhdGVTcHlDb25uZWN0aW9uLCBjcmVhdGVGYWtlRWRpdG9yfSBmcm9tICcuLi9oZWxwZXJzLmpzJztcclxuXHJcbmRlc2NyaWJlKCdBdXRvQ29tcGxldGVBZGFwdGVyJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgZ2xvYmFsLnNpbm9uID0gc2lub24uc2FuZGJveC5jcmVhdGUoKTtcclxuICB9KTtcclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgZ2xvYmFsLnNpbm9uLnJlc3RvcmUoKTtcclxuICB9KTtcclxuXHJcbiAgY29uc3QgcmVxdWVzdDogYXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0ID0ge1xyXG4gICAgZWRpdG9yOiBjcmVhdGVGYWtlRWRpdG9yKCksXHJcbiAgICBidWZmZXJQb3NpdGlvbjogbmV3IFBvaW50KDEyMywgNDU2KSxcclxuICAgIHByZWZpeDogJ2RlZicsXHJcbiAgICBzY29wZURlc2NyaXB0b3I6ICdzb21lLnNjb3BlJyxcclxuICB9O1xyXG5cclxuICBjb25zdCBjb21wbGV0aW9uSXRlbXMgPSBbXHJcbiAgICB7XHJcbiAgICAgIGxhYmVsOiAnbGFiZWwxJyxcclxuICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLktleXdvcmQsXHJcbiAgICAgIGRldGFpbDogJ2Rlc2NyaXB0aW9uMScsXHJcbiAgICAgIGRvY3VtZW50YXRpb246ICdhIHZlcnkgZXhjaXRpbmcga2V5d29yZCcsXHJcbiAgICAgIHNvcnRUZXh0OiAneicsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBsYWJlbDogJ2xhYmVsMicsXHJcbiAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5GaWVsZCxcclxuICAgICAgZGV0YWlsOiAnZGVzY3JpcHRpb24yJyxcclxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyBmaWVsZCcsXHJcbiAgICAgIHNvcnRUZXh0OiAnYScsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBsYWJlbDogJ2xhYmVsMycsXHJcbiAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5WYXJpYWJsZSxcclxuICAgICAgZGV0YWlsOiAnZGVzY3JpcHRpb24zJyxcclxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScsXHJcbiAgICB9LFxyXG4gIF07XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRTdWdnZXN0aW9ucycsICgpID0+IHtcclxuICAgIGNvbnN0IGZha2VMYW5ndWFnZUNsaWVudCA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24oY3JlYXRlU3B5Q29ubmVjdGlvbigpKTtcclxuICAgIHNpbm9uLnN0dWIoZmFrZUxhbmd1YWdlQ2xpZW50LCAnY29tcGxldGlvbicpLnJlc29sdmVzKGNvbXBsZXRpb25JdGVtcyk7XHJcblxyXG4gICAgaXQoJ2dldHMgQXV0b0NvbXBsZXRlIHN1Z2dlc3Rpb25zIHZpYSBMU1AgZ2l2ZW4gYW4gQXV0b0NvbXBsZXRlUmVxdWVzdCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgYXV0b0NvbXBsZXRlQWRhcHRlciA9IG5ldyBBdXRvQ29tcGxldGVBZGFwdGVyKCk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBhdXRvQ29tcGxldGVBZGFwdGVyLmdldFN1Z2dlc3Rpb25zKGZha2VMYW5ndWFnZUNsaWVudCwgcmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzLmxlbmd0aCkuZXF1YWxzKDMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0c1swXS50ZXh0KS5lcXVhbHMoJ2xhYmVsMicpO1xyXG4gICAgICBleHBlY3QocmVzdWx0c1sxXS5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHZlcnkgZXhjaXRpbmcgdmFyaWFibGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMl0udHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NvbXBsZXRlU3VnZ2VzdGlvbicsICgpID0+IHtcclxuICAgIGNvbnN0IHBhcnRpYWxJdGVtcyA9IFtcclxuICAgICAge1xyXG4gICAgICAgIGxhYmVsOiAnbGFiZWwxJyxcclxuICAgICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuS2V5d29yZCxcclxuICAgICAgICBzb3J0VGV4dDogJ3onLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbGFiZWw6ICdsYWJlbDInLFxyXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5GaWVsZCxcclxuICAgICAgICBzb3J0VGV4dDogJ2EnLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbGFiZWw6ICdsYWJlbDMnLFxyXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5WYXJpYWJsZSxcclxuICAgICAgfSxcclxuICAgIF07XHJcblxyXG4gICAgY29uc3QgZmFrZUxhbmd1YWdlQ2xpZW50ID0gbmV3IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbihjcmVhdGVTcHlDb25uZWN0aW9uKCkpO1xyXG4gICAgc2lub24uc3R1YihmYWtlTGFuZ3VhZ2VDbGllbnQsICdjb21wbGV0aW9uJykucmVzb2x2ZXMocGFydGlhbEl0ZW1zKTtcclxuICAgIHNpbm9uLnN0dWIoZmFrZUxhbmd1YWdlQ2xpZW50LCAnY29tcGxldGlvbkl0ZW1SZXNvbHZlJykucmVzb2x2ZXMoe1xyXG4gICAgICBsYWJlbDogJ2xhYmVsMycsXHJcbiAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5WYXJpYWJsZSxcclxuICAgICAgZGV0YWlsOiAnZGVzY3JpcHRpb24zJyxcclxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScsXHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmVzb2x2ZXMgc3VnZ2VzdGlvbnMgdmlhIExTUCBnaXZlbiBhbiBBdXRvQ29tcGxldGVSZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBhdXRvQ29tcGxldGVBZGFwdGVyID0gbmV3IEF1dG9Db21wbGV0ZUFkYXB0ZXIoKTtcclxuICAgICAgY29uc3QgcmVzdWx0czogQXJyYXk8YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uPiA9IGF3YWl0IGF1dG9Db21wbGV0ZUFkYXB0ZXIuZ2V0U3VnZ2VzdGlvbnMoZmFrZUxhbmd1YWdlQ2xpZW50LCByZXF1ZXN0KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMl0uZGVzY3JpcHRpb24pLmVxdWFscyh1bmRlZmluZWQpO1xyXG4gICAgICBjb25zdCByZXNvbHZlZEl0ZW0gPSBhd2FpdCBhdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRlU3VnZ2VzdGlvbihmYWtlTGFuZ3VhZ2VDbGllbnQsIHJlc3VsdHNbMl0sIHJlcXVlc3QpO1xyXG4gICAgICBleHBlY3QocmVzb2x2ZWRJdGVtLmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdyZXF1ZXN0VG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcycsICgpID0+IHtcclxuICAgIGl0KCdjcmVhdGVzIGEgVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMgZnJvbSBhbiBBdXRvY29tcGxldGVSZXF1ZXN0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBBdXRvQ29tcGxldGVBZGFwdGVyLnJlcXVlc3RUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zKHJlcXVlc3QpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRleHREb2N1bWVudC51cmkpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLmpzJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQucG9zaXRpb24pLmRlZXAuZXF1YWxzKHtsaW5lOiAxMjMsIGNoYXJhY3RlcjogNDU2fSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25JdGVtIGFycmF5IHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9ucyBhcnJheScsICgpID0+IHtcclxuICAgICAgY29uc3QgYXV0b0NvbXBsZXRlQWRhcHRlciA9IG5ldyBBdXRvQ29tcGxldGVBZGFwdGVyKCk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBcnJheS5mcm9tKGF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhjb21wbGV0aW9uSXRlbXMsIHJlcXVlc3QpKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHMubGVuZ3RoKS5lcXVhbHMoMyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzWzBdWzBdLnRleHQpLmVxdWFscygnbGFiZWwyJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdWzBdLmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScpO1xyXG4gICAgICBleHBlY3QocmVzdWx0c1syXVswXS50eXBlKS5lcXVhbHMoJ2tleXdvcmQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBMU1AgQ29tcGxldGlvbkxpc3QgdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb25zIGFycmF5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb21wbGV0aW9uTGlzdCA9IHtpdGVtczogY29tcGxldGlvbkl0ZW1zLCBpc0luY29tcGxldGU6IGZhbHNlfTtcclxuICAgICAgY29uc3QgYXV0b0NvbXBsZXRlQWRhcHRlciA9IG5ldyBBdXRvQ29tcGxldGVBZGFwdGVyKCk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBcnJheS5mcm9tKGF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhjb21wbGV0aW9uTGlzdCwgcmVxdWVzdCkpO1xyXG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLmVxdWFscygzKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMF1bMF0uZGVzY3JpcHRpb24pLmVxdWFscygnYSB2ZXJ5IGV4Y2l0aW5nIGZpZWxkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdWzBdLnRleHQpLmVxdWFscygnbGFiZWwzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25MaXN0IHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9ucyBhcnJheSB1c2luZyB0aGUgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW0nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25MaXN0ID0ge2l0ZW1zOiBjb21wbGV0aW9uSXRlbXMsIGlzSW5jb21wbGV0ZTogZmFsc2V9O1xyXG4gICAgICBjb25zdCBhdXRvQ29tcGxldGVBZGFwdGVyID0gbmV3IEF1dG9Db21wbGV0ZUFkYXB0ZXIoKTtcclxuICAgICAgY29uc3QgcmVzdWx0cyA9IEFycmF5LmZyb20oYXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zKGNvbXBsZXRpb25MaXN0LCByZXF1ZXN0LCAoYywgYSwgcikgPT4ge1xyXG4gICAgICAgIGEudGV4dCA9IGMubGFiZWwgKyAnIG9rJztcclxuICAgICAgICBhLmRpc3BsYXlUZXh0ID0gci5zY29wZURlc2NyaXB0b3I7XHJcbiAgICAgIH0pKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHMubGVuZ3RoKS5lcXVhbHMoMyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzWzBdWzBdLmRpc3BsYXlUZXh0KS5lcXVhbHMoJ3NvbWUuc2NvcGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMV1bMF0udGV4dCkuZXF1YWxzKCdsYWJlbDMgb2snKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBlbXB0eSBhcnJheSBpbnRvIGFuIGVtcHR5IEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9ucyBhcnJheScsICgpID0+IHtcclxuICAgICAgY29uc3QgYXV0b0NvbXBsZXRlQWRhcHRlciA9IG5ldyBBdXRvQ29tcGxldGVBZGFwdGVyKCk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBcnJheS5mcm9tKGF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhbXSwgcmVxdWVzdCkpO1xyXG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLmVxdWFscygwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25JdGVtIHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9uIHdpdGhvdXQgdGV4dEVkaXQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25JdGVtID0ge1xyXG4gICAgICAgIGluc2VydFRleHQ6ICdpbnNlcnQnLFxyXG4gICAgICAgIGxhYmVsOiAnbGFiZWwnLFxyXG4gICAgICAgIGZpbHRlclRleHQ6ICdmaWx0ZXInLFxyXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxyXG4gICAgICAgIGRldGFpbDogJ2tleXdvcmQnLFxyXG4gICAgICAgIGRvY3VtZW50YXRpb246ICdhIHRydWx5IHVzZWZ1bCBrZXl3b3JkJyxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0geyB9O1xyXG4gICAgICBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKGNvbXBsZXRpb25JdGVtLCByZXN1bHQsIHJlcXVlc3QpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRleHQpLmVxdWFscygnaW5zZXJ0Jyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGlzcGxheVRleHQpLmVxdWFscygnbGFiZWwnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50eXBlKS5lcXVhbHMoJ2tleXdvcmQnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5yaWdodExhYmVsKS5lcXVhbHMoJ2tleXdvcmQnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHRydWx5IHVzZWZ1bCBrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb25NYXJrZG93bikuZXF1YWxzKCdhIHRydWx5IHVzZWZ1bCBrZXl3b3JkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25JdGVtIHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9uIHdpdGggdGV4dEVkaXQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25JdGVtOiBscy5Db21wbGV0aW9uSXRlbSA9IHtcclxuICAgICAgICBpbnNlcnRUZXh0OiAnaW5zZXJ0JyxcclxuICAgICAgICBsYWJlbDogJ2xhYmVsJyxcclxuICAgICAgICBmaWx0ZXJUZXh0OiAnZmlsdGVyJyxcclxuICAgICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGUsXHJcbiAgICAgICAgZGV0YWlsOiAnbnVtYmVyJyxcclxuICAgICAgICBkb2N1bWVudGF0aW9uOiAnYSB0cnVseSB1c2VmdWwgdmFyaWFibGUnLFxyXG4gICAgICAgIHRleHRFZGl0OiB7XHJcbiAgICAgICAgICByYW5nZToge1xyXG4gICAgICAgICAgICBzdGFydDoge2xpbmU6IDEwLCBjaGFyYWN0ZXI6IDIwfSxcclxuICAgICAgICAgICAgZW5kOiB7bGluZTogMzAsIGNoYXJhY3RlcjogNDB9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG5ld1RleHQ6ICduZXdUZXh0JyxcclxuICAgICAgICB9LFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBhdXRvY29tcGxldGVSZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QgPSB7XHJcbiAgICAgICAgZWRpdG9yOiBjcmVhdGVGYWtlRWRpdG9yKCksXHJcbiAgICAgICAgYnVmZmVyUG9zaXRpb246IG5ldyBQb2ludCgxMjMsIDQ1NiksXHJcbiAgICAgICAgcHJlZml4OiAnZGVmJyxcclxuICAgICAgICBzY29wZURlc2NyaXB0b3I6ICdzb21lLnNjb3BlJyxcclxuICAgICAgfTtcclxuICAgICAgc2lub24uc3R1YihhdXRvY29tcGxldGVSZXF1ZXN0LmVkaXRvciwgJ2dldFRleHRJbkJ1ZmZlclJhbmdlJykucmV0dXJucygncmVwbGFjZW1lbnRQcmVmaXgnKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0geyB9O1xyXG4gICAgICBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKGNvbXBsZXRpb25JdGVtLCByZXN1bHQsIGF1dG9jb21wbGV0ZVJlcXVlc3QpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRpc3BsYXlUZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCd2YXJpYWJsZScpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJpZ2h0TGFiZWwpLmVxdWFscygnbnVtYmVyJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb24pLmVxdWFscygnYSB0cnVseSB1c2VmdWwgdmFyaWFibGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbk1hcmtkb3duKS5lcXVhbHMoJ2EgdHJ1bHkgdXNlZnVsIHZhcmlhYmxlJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQucmVwbGFjZW1lbnRQcmVmaXgpLmVxdWFscygncmVwbGFjZW1lbnRQcmVmaXgnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS5lcXVhbHMoJ25ld1RleHQnKTtcclxuICAgICAgZXhwZWN0KGF1dG9jb21wbGV0ZVJlcXVlc3QuZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlLmNhbGxlZE9uY2UpLmVxdWFscyh0cnVlKTtcclxuICAgICAgZXhwZWN0KGF1dG9jb21wbGV0ZVJlcXVlc3QuZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlLmdldENhbGwoMCkuYXJncykuZGVlcC5lcXVhbHMoW1xyXG4gICAgICAgIG5ldyBSYW5nZShuZXcgUG9pbnQoMTAsIDIwKSwgbmV3IFBvaW50KDMwLCA0MCkpLFxyXG4gICAgICBdKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnYmFzaWNDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBMU1AgQ29tcGxldGlvbkl0ZW0gd2l0aCBpbnNlcnRUZXh0IGFuZCBmaWx0ZXJUZXh0IHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9uJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb21wbGV0aW9uSXRlbTogbHMuQ29tcGxldGlvbkl0ZW0gPSB7XHJcbiAgICAgICAgaW5zZXJ0VGV4dDogJ2luc2VydCcsXHJcbiAgICAgICAgbGFiZWw6ICdsYWJlbCcsXHJcbiAgICAgICAgZmlsdGVyVGV4dDogJ2ZpbHRlcicsXHJcbiAgICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLktleXdvcmQsXHJcbiAgICAgICAgZGV0YWlsOiAnZGV0YWlsJyxcclxuICAgICAgICBkb2N1bWVudGF0aW9uOiAnYSB2ZXJ5IGV4Y2l0aW5nIGtleXdvcmQnLFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCByZXN1bHQgPSB7IH07XHJcbiAgICAgIEF1dG9Db21wbGV0ZUFkYXB0ZXIuYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihjb21wbGV0aW9uSXRlbSwgcmVzdWx0KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS5lcXVhbHMoJ2luc2VydCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRpc3BsYXlUZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQucmlnaHRMYWJlbCkuZXF1YWxzKCdkZXRhaWwnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHZlcnkgZXhjaXRpbmcga2V5d29yZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uTWFya2Rvd24pLmVxdWFscygnYSB2ZXJ5IGV4Y2l0aW5nIGtleXdvcmQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBMU1AgQ29tcGxldGlvbkl0ZW0gd2l0aG91dCBpbnNlcnRUZXh0IG9yIGZpbHRlclRleHQgdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb24nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25JdGVtOiBscy5Db21wbGV0aW9uSXRlbSA9IHtcclxuICAgICAgICBsYWJlbDogJ2xhYmVsJyxcclxuICAgICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuS2V5d29yZCxcclxuICAgICAgICBkZXRhaWw6ICdkZXRhaWwnLFxyXG4gICAgICAgIGRvY3VtZW50YXRpb246ICdBIHZlcnkgdXNlZnVsIGtleXdvcmQnLFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCByZXN1bHQgPSB7IH07XHJcbiAgICAgIEF1dG9Db21wbGV0ZUFkYXB0ZXIuYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihjb21wbGV0aW9uSXRlbSwgcmVzdWx0KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGlzcGxheVRleHQpLmVxdWFscygnbGFiZWwnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50eXBlKS5lcXVhbHMoJ2tleXdvcmQnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5yaWdodExhYmVsKS5lcXVhbHMoJ2RldGFpbCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS5lcXVhbHMoJ0EgdmVyeSB1c2VmdWwga2V5d29yZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uTWFya2Rvd24pLmVxdWFscygnQSB2ZXJ5IHVzZWZ1bCBrZXl3b3JkJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2FwcGx5VGV4dEVkaXRUb1N1Z2dlc3Rpb24nLCAoKSA9PiB7XHJcbiAgICBjb25zdCBiYXNpY0NvbXBsZXRpb25JdGVtOiBscy5Db21wbGV0aW9uSXRlbSA9IHtcclxuICAgICAgbGFiZWw6ICdsYWJlbCcsXHJcbiAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxyXG4gICAgICBkZXRhaWw6ICdkZXRhaWwnLFxyXG4gICAgICBkb2N1bWVudGF0aW9uOiAnQW4gaW5jcmVkaWJsZSBrZXl3b3JkJyxcclxuICAgIH07XHJcblxyXG4gICAgaXQoJ2RvZXMgbm90IGRvIGFueXRoaW5nIGlmIHRoZXJlIGlzIG5vIHRleHRFZGl0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb21wbGV0aW9uSXRlbSA9IHsuLi5iYXNpY0NvbXBsZXRpb25JdGVtfTtcclxuICAgICAgQXV0b0NvbXBsZXRlQWRhcHRlci5hcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uKG51bGwsIG5ldyBUZXh0RWRpdG9yKCksIGNvbXBsZXRpb25JdGVtKTtcclxuICAgICAgZXhwZWN0KGNvbXBsZXRpb25JdGVtKS5kZWVwLmVxdWFscyhiYXNpY0NvbXBsZXRpb25JdGVtKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdhcHBsaWVzIGNoYW5nZXMgZnJvbSBUZXh0RWRpdCB0byByZXBsYWNlbWVudFByZWZpeCBhbmQgdGV4dCcsICgpID0+IHtcclxuICAgICAgY29uc3QgdGV4dEVkaXQgPSB7XHJcbiAgICAgICAgcmFuZ2U6IHtcclxuICAgICAgICAgIHN0YXJ0OiB7bGluZTogMSwgY2hhcmFjdGVyOiAyfSxcclxuICAgICAgICAgIGVuZDoge2xpbmU6IDMsIGNoYXJhY3RlcjogNH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBuZXdUZXh0OiAnbmV3VGV4dCcsXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IGVkaXRvciA9IG5ldyBUZXh0RWRpdG9yKCk7XHJcbiAgICAgIHNpbm9uLnN0dWIoZWRpdG9yLCAnZ2V0VGV4dEluQnVmZmVyUmFuZ2UnKS5yZXR1cm5zKCdyZXBsYWNlbWVudFByZWZpeCcpO1xyXG5cclxuICAgICAgY29uc3QgY29tcGxldGlvbkl0ZW0gPSB7Li4uYmFzaWNDb21wbGV0aW9uSXRlbX07XHJcbiAgICAgIEF1dG9Db21wbGV0ZUFkYXB0ZXIuYXBwbHlUZXh0RWRpdFRvU3VnZ2VzdGlvbih0ZXh0RWRpdCwgZWRpdG9yLCBjb21wbGV0aW9uSXRlbSk7XHJcbiAgICAgIGV4cGVjdChjb21wbGV0aW9uSXRlbS5yZXBsYWNlbWVudFByZWZpeCkuZXF1YWxzKCdyZXBsYWNlbWVudFByZWZpeCcpO1xyXG4gICAgICBleHBlY3QoY29tcGxldGlvbkl0ZW0udGV4dCkuZXF1YWxzKCduZXdUZXh0Jyk7XHJcbiAgICAgIGV4cGVjdChlZGl0b3IuZ2V0VGV4dEluQnVmZmVyUmFuZ2UuY2FsbGVkT25jZSkuZXF1YWxzKHRydWUpO1xyXG4gICAgICBleHBlY3QoZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlLmdldENhbGwoMCkuYXJncykuZGVlcC5lcXVhbHMoW25ldyBSYW5nZShuZXcgUG9pbnQoMSwgMiksIG5ldyBQb2ludCgzLCA0KSldKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIExTUCBDb21wbGV0aW9uS2luZHMgdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb25UeXBlcycsICgpID0+IHtcclxuICAgICAgY29uc3QgdmFyaWFibGUgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShscy5Db21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGUpO1xyXG4gICAgICBjb25zdCBjb25zdHJ1Y3RvciA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlKGxzLkNvbXBsZXRpb25JdGVtS2luZC5Db25zdHJ1Y3Rvcik7XHJcbiAgICAgIGNvbnN0IG1vZHVsZSA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlKGxzLkNvbXBsZXRpb25JdGVtS2luZC5Nb2R1bGUpO1xyXG4gICAgICBleHBlY3QodmFyaWFibGUpLmVxdWFscygndmFyaWFibGUnKTtcclxuICAgICAgZXhwZWN0KGNvbnN0cnVjdG9yKS5lcXVhbHMoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgIGV4cGVjdChtb2R1bGUpLmVxdWFscygnbW9kdWxlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGVmYXVsdHMgdG8gXCJ2YWx1ZVwiJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShudWxsKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkuZXF1YWxzKCd2YWx1ZScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=